-- Bytecode analysis - calling DebugLog from within functions

glSelf = obj.find('self')

function testCombined()
   local guest = nil
   local result = guest?.profile?.name ? "Guest"

   -- Get bytecode from within the function
   local err, log = glSelf.mtDebugLog('disasm')
   print("\n=== BYTECODE: testCombined (safe nav + if-empty COMBINED) ===")
   print(log or "No bytecode")

   return result
end

function testSplit()
   local guest = nil
   local step1 = guest?.profile?.name
   local step2 = step1 ? "Guest"

   -- Get bytecode from within the function
   local err, log = glSelf.mtDebugLog('disasm')
   print("\n=== BYTECODE: testSplit (safe nav + if-empty SPLIT) ===")
   print(log or "No bytecode")

   return step2
end

function testSimpleIfEmpty()
   local val = nil
   local result = val ? "Default"

   -- Get bytecode from within the function
   local err, log = glSelf.mtDebugLog('disasm')
   print("\n=== BYTECODE: testSimpleIfEmpty ===")
   print(log or "No bytecode")

   return result
end

-- Run tests
print("=== RUNTIME RESULTS ===")
print("Test 1 (combined): " .. tostring(testCombined()))
print("\nTest 2 (split): " .. tostring(testSplit()))
print("\nTest 3 (simple): " .. tostring(testSimpleIfEmpty()))
