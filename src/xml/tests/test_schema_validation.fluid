-- Schema validation tests for XML module

function testLoadSchema()
   local err = glXML.mtLoadSchema(glScriptFolder .. "schema_inventory.xsd")
   assert(err == ERR_Okay, "LoadSchema() failed: " .. mSys.GetErrorMsg(err))

   local errHas, has = glXML.mtHasSchema()
   assert(errHas == ERR_Okay, "HasSchema() returned error: " .. mSys.GetErrorMsg(errHas))
   assert(has == 1, "Schema not detected after loading")
end

function testValidateDocumentPass()
   local err, result = glXML.mtValidateDocument()
   assert(err == ERR_Okay, "ValidateDocument() returned error: " .. mSys.GetErrorMsg(err))
   assert(result == 1, "Expected document to validate successfully")
end

function testValidateDocumentFail()
   local invalid = obj.new("xml", { path = glScriptFolder .. "schema_inventory_invalid.xml" })
   local err = invalid.mtLoadSchema(glScriptFolder .. "schema_inventory.xsd")
   assert(err == ERR_Okay, "Failed to load schema for invalid document: " .. mSys.GetErrorMsg(err))

   local errValidate, result = invalid.mtValidateDocument()
   assert(errValidate == ERR_Okay, "ValidateDocument() returned error: " .. mSys.GetErrorMsg(errValidate))
   assert(result == 0, "Expected invalid document to fail validation")
end

return {
   tests = { 'testLoadSchema', 'testValidateDocumentPass', 'testValidateDocumentFail' },
   init = function(ScriptFolder)
      glScriptFolder = ScriptFolder
      glXML = obj.new("xml", { path = ScriptFolder .. "schema_inventory.xml" })
   end,
   cleanup = function()
      glXML = nil
      glScriptFolder = nil
   end
}
