-- Error handling and resilience edge cases

@Test function InvalidEscapeRaises()
   try
      regex.new("\\x")
   success
      error("Invalid escape should trigger compilation error")
   end
end

@Test function MismatchedBracketRaises()
   try
      regex.new("[abc")
   success
      error("Mismatched bracket should raise error")
   end
end

@Test function UnknownUnicodeProperty()
   try
      regex.new("\\p{NotAProperty}")
   success
      error("Unknown Unicode property should be rejected")
   end
end

@Test function RegexObjectsSurviveGarbageCollection()
   for index = 1, 50 do
      matcher = regex.new("item" .. index)
      assert(matcher.test("item" .. index), "Compiled regex should operate before GC")
   end
   processing.collect()
   matcher = regex.new("final")
   assert(matcher.test("final"), "Regex creation should remain stable after GC cycle")
end

@Test function EmptyPatternMatch()
   matcher = regex.new("")
   assert(matcher.test("anything"), "Empty pattern should match any string")
   replaced = matcher.replace("abc", "-")
   assert(replaced:sub(0, 1) is "-", "Replacement on empty pattern should insert replacement at start")
end
