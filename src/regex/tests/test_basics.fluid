-- Core construction and metadata behaviour for Fluid regex bindings

function testConstructionMetadata()
   local matcher = regex.new("abc")
   assert(matcher.pattern == "abc", "Pattern property should mirror constructor input")
   assert(matcher.flags == 0, "Flags should default to zero when omitted")
   assert(matcher.error == nil, "Error property should be nil on successful compilation")
end

function testFlagPersistence()
   local combined = regex.new("abc", regex.ICASE + regex.MULTILINE)
   assert(combined.flags == (regex.ICASE + regex.MULTILINE), "Combined flags should be preserved")
   assert(combined.test("A\nB\nABC"), "Case insensitive test should succeed")
end

function testToStringOutput()
   local matcher = regex.new("words?", regex.ICASE)
   local description = tostring(matcher)
   assert(description:startsWith("regex(words?"), "Description should contain pattern, got: " .. description)
   assert(description:find("flags="), "Description should include flag summary when flags are set")
end

function testInvalidPatternRaises()
   local ex = catch(function() return regex.new("(broken") end)
   assert(ex != nil, "Invalid pattern should raise an exception")
   assert(ex.message:find("Regex compilation failed"), "Error message should mention compilation failure, got: " .. ex.message)
end

return {
   tests = {
      'testConstructionMetadata',
      'testFlagPersistence',
      'testToStringOutput',
      'testInvalidPatternRaises'
   }
}
