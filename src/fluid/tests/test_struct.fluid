--[[
Flute tests for the struct interface.
--]]

@BeforeEach(hotpath=true) 
function enforce_hotpath() end

   ex, mFont = catch(function() return mod.load("font") end)

   if ex then
      logOutput("Font module is disabled in this build, skipping test")
      return
   end

-----------------------------------------------------------------------------------------------------------------------
-- Retrieve a known struct from a function and then list its field values.  GetList() is chosen in particular because
-- it features a null-terminated array in the Points field.

@Test function testFontList()
   err, list = mFont.GetList()
   assert(list, "Failed to retrieve list of fonts, error: " .. mSys.GetErrorMsg(err))

   font = list
   while font do
      if not font.hidden then
         if font.scalable is 1 then
            logOutput("Scalable: " .. font.name)
         else
            logOutput("Bitmap: " .. font.name)
         end
         logOutput("Styles: " .. font.styles)

         points = ""
         for _, p in ipairs(font.points) do
            if points?? then points ..= ", " end
            points ..= p
         end
         if points?? then logOutput("Available in fixed sizes: " .. points) end
         logOutput("")
      end

      font = font.next
   end
end
