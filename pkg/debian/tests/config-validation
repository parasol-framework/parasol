#!/bin/bash
# Configuration validation test for Parasol package

set -e

echo "Testing Parasol configuration validation..."

# Check if configuration files are readable
CONFIG_DIR="/usr/share/parasol/config"

if [ -d "$CONFIG_DIR" ]; then
    echo "Checking configuration directory permissions..."
    
    # Check directory is readable
    if [ ! -r "$CONFIG_DIR" ]; then
        echo "FAIL: Configuration directory not readable"
        exit 1
    fi
    
    # Check if there are any config files and they're readable
    config_files_found=0
    for config_file in "$CONFIG_DIR"/*; do
        if [ -f "$config_file" ]; then
            config_files_found=1
            if [ ! -r "$config_file" ]; then
                echo "FAIL: Configuration file $config_file not readable"
                exit 1
            fi
        fi
    done
    
    if [ $config_files_found -ge 1 ]; then
        echo "Configuration files found and readable"
    else
        echo "Note: No configuration files found (may be normal)"
    fi
else
    echo "WARNING: Configuration directory not found"
fi

# Check scripts directory
SCRIPTS_DIR="/usr/share/parasol/scripts"

if [ -d "$SCRIPTS_DIR" ]; then
    echo "Checking scripts directory permissions..."
    
    if [ ! -r "$SCRIPTS_DIR" ]; then
        echo "FAIL: Scripts directory not readable"
        exit 1
    fi
    
    echo "Scripts directory accessible"
else
    echo "WARNING: Scripts directory not found"
fi

echo "PASS: Configuration validation completed successfully"