# A few words on upgrading Freetype to new versions:
# Freetype definitions in ftoption.h that are turned off: FT_CONFIG_OPTION_USE_LZW  FT_CONFIG_OPTION_MAC_FONTS FT_CONFIG_OPTION_INCREMENTAL TT_CONFIG_OPTION_BDF FT_CONFIG_OPTION_USE_ZLIB TT_CONFIG_OPTION_GX_VAR_SUPPORT
# base/ftsystem.c is modified to support our file system.
# Change config/ftmodule.h and config/ftoption.h to match the current version.
# ./configure --without-png --without-zlib --without-bzip2 --without-png
# Do a standard compile and then look in objs/ to see what .o files were created.

include ../../core.mk

FT:= freetype-2.7/

#CFLAGS+= -DFT_DEBUG_LEVEL_ERROR -DFT_DEBUG_LEVEL_TRACE
CFLAGS+= -I$(FT)builds/unix "-DFT_CONFIG_CONFIG_H=<ftconfig.h>" -DFT2_BUILD_LIBRARY "-DFT_CONFIG_MODULES_H=<ftmodule.h>" -I$(FT)src/base -I$(FT)include -I$(FT)include/freetype/config

# A bug in (MinGW?) GCC requires the following flag is applied to ensure that __packed__ works correctly.
CFLAGS += -mno-ms-bitfields
CFLAGS += -DMOD_NAME=font

OBJECTS= font.o \
 $(FT)src/autofit/autofit.o    $(FT)src/psnames/psnames.o $(FT)src/raster/raster.o \
 $(FT)src/cff/cff.o            $(FT)src/base/ftglyph.o    $(FT)src/sfnt/sfnt.o \
 $(FT)src/base/ftbase.o        $(FT)src/base/ftsystem.o   $(FT)src/smooth/smooth.o \
 $(FT)src/truetype/truetype.o  $(FT)src/base/ftinit.o     $(FT)src/base/ftstroke.o \
 $(FT)src/base/ftbitmap.o      $(FT)src/base/ftdebug.o       $(FT)src/pshinter/pshinter.o

SOURCES := $(subst .o,.c,$(OBJECTS))
-include deps-$(OSTYPE).mak

compile: $(OBJECTS) deps-$(OSTYPE).mak

$(OBJECTS): %.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $<

deps-$(OSTYPE).mak:
	$(CC) -MM $(CFLAGS) $(SOURCES) >deps-$(OSTYPE).mak

# Unused freetype code:
# $(FT)src/bzip2/ftbzip2.o $(FT)src/base/ftgasp.o   $(FT)src/base/ftcid.o    $(FT)src/base/ftbdf.o
# $(FT)src/base/ftpfr.o    $(FT)src/pfr/pfr.o       $(FT)src/psaux/psaux.o   $(FT)src/base/ftlcdfil.o
# $(FT)src/gzip/ftgzip.o   $(FT)src/base/fttype1.o  $(FT)src/base/ftwinfnt.o $(FT)src/winfonts/winfnt.o
# $(FT)src/type1/type1.o   $(FT)src/pcf/pcf.o       $(FT)src/bdf/bdf.o       $(FT)src/cid/type1cid.o
# $(FT)src/lzw/ftlzw.o     $(FT)src/type42/type42.o  $(FT)src/base/ftsynth.o
# $(FT)src/base/ftgxval.o  $(FT)src/base/ftxf86.o   $(FT)src/base/ftbbox.o   $(FT)src/base/ftfstype.o
# $(FT)src/base/ftpatent.o $(FT)src/base/ftmm.o     $(FT)src/base/ftotval.o  $(FT)src/cache/ftcache.o
