<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-8254DG7MT6"> </script><script>
	   window.dataLayer = window.dataLayer || [];
	   function gtag(){dataLayer.push(arguments);}
	   gtag('js', new Date());
      gtag('config', 'G-8254DG7MT6');</script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Parasol Framework documentation, machine generated from source">
<meta name="author" content="Paul Manias">
<link rel="icon" href="/favicon.ico">
<title>Parasol Wiki - Fluid Reference Manual</title>
<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="../css/module-template.css" rel="stylesheet">
<link href="../css/github-markdown.css" rel="stylesheet">
</head>

<body>
<nav class="navbar navbar-expand-sm navbar-dark bg-dark">
  <div class="container-fluid">
    <div class="navbar-header"><a class="navbar-brand" href="../index.html">Parasol Framework</a></div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav"><li class="nav-item">
        <li class="nav-item"><a class="nav-link" href="../gallery.html">Gallery</a></li>
        <li class="nav-item"><a class="nav-link" href="../modules/api.html">API</a></li>
        <li class="nav-item"><a class="nav-link" href="Home.html">Wiki</a></li>
        <li class="nav-item"><a class="nav-link" href="https://github.com/parasol-framework/parasol">GitHub</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid">
  <div class="row">
    <div class="d-sm-block d-none col-3 sidebar" style="max-width: 230px;">
      <div class="flex-shrink-1 pt-2 pe-2 sticky-top overflow-auto vh-100 b-shadow">

<ul class="list-unstyled">
  <li>
    <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#wiki-collapse" aria-expanded="true">Wiki</button>
    <div class="collapse show" id="wiki-collapse">
      <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 ps-3">
         <li><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#bp-collapse" aria-expanded="false">Build Process</button>
         <div class="collapse" id="bp-collapse">
            <ul class="btn-toggle-nav list-unstyled pb-1">
              <li class="api-ref"><a class="rounded" href="Linux-Builds.html">Linux Builds</a></li>
              <li class="api-ref"><a class="rounded" href="Windows-Builds.html">Windows Builds</a></li>
              <li class="api-ref"><a class="rounded" href="Customising-Your-Build.html">Customising Your Build</a></li>
            </ul>
         </div></li>

         <li><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#tm-collapse" aria-expanded="false">Technical Manuals</button>
         <div class="collapse" id="tm-collapse">
            <ul class="btn-toggle-nav list-unstyled pb-1">
             <li class="api-ref"><a class="rounded" href="Parasol-Objects.html">Parasol Objects</a></li>
             <li class="api-ref"><a class="rounded" href="Parasol-In-Depth.html">Parasol In Depth</a></li>
             <li class="api-ref"><a class="rounded" href="Coding-With-AI.html">Coding With AI</a></li>
           </ul>
         </div></li>

         <li><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#fg-collapse" aria-expanded="false">Fluid</button>
         <div class="collapse" id="fg-collapse">
            <ul class="btn-toggle-nav list-unstyled pb-1">
            <li class="api-ref"><a class="rounded" href="Fluid-Reference-Manual.html">Fluid Reference Manual</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-Common-API.html">Common API</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-GUI-API.html">GUI API</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-HTTPServer-API.html">HTTPServer API</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-IO-API.html">I/O API</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-JSON-API.html">JSON API</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-URL-API.html">URL API</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-VFX-API.html">VFX API</a></li>
            <li class="api-ref"><a class="rounded" href="Fluid-Widgets.html">Widgets</a></li>
           </ul>
         </div></li>

         <li><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#rrm-collapse" aria-expanded="false">RIPL</button>
         <div class="collapse" id="rrm-collapse">
            <ul class="btn-toggle-nav list-unstyled pb-1">
              <li class="api-ref"><a class="rounded" href="RIPL-Reference-Manual.html">RIPL Reference Manual</a></li>
           </ul>
         </div></li>

         <li><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#tools-collapse" aria-expanded="false">Tools</button>
         <div class="collapse" id="tools-collapse">
            <ul class="btn-toggle-nav list-unstyled pb-1">
              <li class="api-ref"><a class="rounded" href="Parasol-Cmd-Tool.html">Parasol Cmd Tool</a></li>
              <li class="api-ref"><a class="rounded" href="Unit-Testing.html">Flute / Unit Testing</a></li>
           </ul>
         </div></li>

         <li><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#doc-collapse" aria-expanded="false">Doc Generation</button>
         <div class="collapse" id="doc-collapse">
            <ul class="btn-toggle-nav list-unstyled pb-1">
              <li class="api-ref"><a class="rounded" href="Embedded-Document-Formatting.html">Embedded Document Format</a></li>
              <li class="api-ref"><a class="rounded" href="FDL-Reference-Manual.html">FDL Reference Manual</a></li>
              <li class="api-ref"><a class="rounded" href="FDL-Tools.html">FDL Tools</a></li>
           </ul>
         </div></li>

         <li><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#app-collapse" aria-expanded="false">Appendix</button>
         <div class="collapse" id="app-collapse">
            <ul class="btn-toggle-nav list-unstyled pb-1">
             <li class="api-ref"><a class="rounded" href="Action-Reference-Manual.html">Action Reference Manual</a></li>
             <li class="api-ref"><a class="rounded" href="System-Error-Codes.html">System Error Codes</a></li>
           </ul>
         </div></li>
      </ul>
    </div>
  </li>
</ul>

<ul class="list-unstyled">
  <li class="border-top my-3"></li>
  <li>
    <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#mod-collapse" aria-expanded="false">Modules</button>
    <div class="collapse" id="mod-collapse">
      <ul class="btn-toggle-nav list-unstyled fw-normal">
      <li class="api-ref"><a href="../modules/audio.html" class="rounded">Audio</a></li>
      <li class="api-ref"><a href="../modules/core.html" class="rounded">Core</a></li>
      <li class="api-ref"><a href="../modules/display.html" class="rounded">Display</a></li>
      <li class="api-ref"><a href="../modules/fluid.html" class="rounded">Fluid</a></li>
      <li class="api-ref"><a href="../modules/font.html" class="rounded">Font</a></li>
      <li class="api-ref"><a href="../modules/network.html" class="rounded">Network</a></li>
      <li class="api-ref"><a href="../modules/regex.html" class="rounded">Regex</a></li>
      <li class="api-ref"><a href="../modules/vector.html" class="rounded">Vector</a></li>
      <li class="api-ref"><a href="../modules/xml.html" class="rounded">XML</a></li>
      <li class="api-ref"><a href="../modules/xpath.html" class="rounded">XPath</a></li>
      </ul>
    </div>
  </li>
</ul>

<ul class="list-unstyled">
  <li class="border-top my-3"></li>
  <li>
    <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#class-collapse" aria-expanded="false">Classes</button>
    <div class="collapse" id="class-collapse">
      <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 ps-3">
        <li>
          <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#audio-collapse" aria-expanded="false">Audio</button>
          <div class="collapse" id="audio-collapse">
            <ul class="btn-toggle-nav list-unstyled fw-normal pb-1">
            <li><a href="../modules/classes/audio.html" class="rounded">Audio</a></li>
            <li><a href="../modules/classes/sound.html" class="rounded">Sound</a></li>
            </ul>
          </div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#core-collapse" aria-expanded="false">Core</button><div class="collapse" id="core-collapse"><ul class="btn-toggle-nav list-unstyled pb-1">
        <li><a href="../modules/classes/file.html" class="rounded">File</a></li>
        <li><a href="../modules/classes/metaclass.html" class="rounded">MetaClass</a></li>
        <li><a href="../modules/classes/module.html" class="rounded">Module</a></li>
        <li><a href="../modules/classes/storagedevice.html" class="rounded">StorageDevice</a></li>
        <li><a href="../modules/classes/task.html" class="rounded">Task</a></li>
        <li><a href="../modules/classes/thread.html" class="rounded">Thread</a></li>
        <li><a href="../modules/classes/time.html" class="rounded">Time</a></li>
        </ul></div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#data-collapse" aria-expanded="false">Data</button><div class="collapse" id="data-collapse"><ul class="btn-toggle-nav list-unstyled pb-1">
        <li><a href="../modules/classes/compression.html" class="rounded">Compression</a></li>
        <li><a href="../modules/classes/compressedstream.html" class="rounded">CompressedStream</a></li>
        <li><a href="../modules/classes/config.html" class="rounded">Config</a></li>
        <li><a href="../modules/classes/script.html" class="rounded">Script</a></li>
        <li><a href="../modules/classes/xml.html" class="rounded">XML</a></li>
        </ul></div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#devices-collapse" aria-expanded="false">Devices</button><div class="collapse" id="devices-collapse"><ul class="btn-toggle-nav list-unstyled pb-1"><li><a href="../modules/classes/controller.html" class="rounded">Controller</a></li></ul></div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#effects-collapse" aria-expanded="false">Effects</button><div class="collapse" id="effects-collapse"><ul class="btn-toggle-nav list-unstyled pb-1">
        <li><a class="rounded" href="../modules/classes/blurfx.html">BlurFX</a></li>
        <li><a class="rounded" href="../modules/classes/colourfx.html">ColourFX</a></li>
        <li><a class="rounded" href="../modules/classes/compositefx.html">CompositeFX</a></li>
        <li><a class="rounded" href="../modules/classes/convolvefx.html">ConvolveFX</a></li>
        <li><a class="rounded" href="../modules/classes/displacementfx.html">DisplacementFX</a></li>
        <li><a class="rounded" href="../modules/classes/filtereffect.html">FilterEffect</a></li>
        <li><a class="rounded" href="../modules/classes/floodfx.html">FloodFX</a></li>
        <li><a class="rounded" href="../modules/classes/imagefx.html">ImageFX</a></li>
        <li><a class="rounded" href="../modules/classes/lightingfx.html">LightingFX</a></li>
        <li><a class="rounded" href="../modules/classes/mergefx.html">MergeFX</a></li>
        <li><a class="rounded" href="../modules/classes/morphologyfx.html">MorphologyFX</a></li>
        <li><a class="rounded" href="../modules/classes/offsetfx.html">OffsetFX</a></li>
        <li><a class="rounded" href="../modules/classes/remapfx.html">RemapFX</a></li>
        <li><a class="rounded" href="../modules/classes/sourcefx.html">SourceFX</a></li>
        <li><a class="rounded" href="../modules/classes/turbulencefx.html">TurbulenceFX</a></li>
        <li><a class="rounded" href="../modules/classes/wavefunctionfx.html">WaveFunctionFX</a></li>
        </ul></div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#ext-collapse" aria-expanded="false">Extensions</button><div class="collapse" id="ext-collapse"><ul class="btn-toggle-nav list-unstyled pb-1">
        <li><a class="rounded" href="../modules/classes/scintilla.html">Scintilla</a></li>
        <li><a class="rounded" href="../modules/classes/scintillasearch.html">ScintillaSearch</a></li>
        </ul></div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#gfx-collapse" aria-expanded="false">Graphics</button><div class="collapse" id="gfx-collapse"><ul class="btn-toggle-nav list-unstyled pb-1">
        <li><a class="rounded" href="../modules/classes/bitmap.html">Bitmap</a></li>
        <li><a class="rounded" href="../modules/classes/clipboard.html">Clipboard</a></li>
        <li><a class="rounded" href="../modules/classes/display.html">Display</a></li>
        <li><a class="rounded" href="../modules/classes/document.html">Document</a></li>
        <li><a class="rounded" href="../modules/classes/font.html">Font</a></li>
        <li><a class="rounded" href="../modules/classes/picture.html">Picture</a></li>
        <li><a class="rounded" href="../modules/classes/pointer.html">Pointer</a></li>
        <li><a class="rounded" href="../modules/classes/surface.html">Surface</a></li>
        <li><a class="rounded" href="../modules/classes/svg.html">SVG</a></li>
        </ul></div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#net-collapse" aria-expanded="false">Network</button><div class="collapse" id="net-collapse"><ul class="btn-toggle-nav list-unstyled pb-1">
        <li><a class="rounded" href="../modules/classes/clientsocket.html">ClientSocket</a></li>
        <li><a class="rounded" href="../modules/classes/http.html">HTTP</a></li>
        <li><a class="rounded" href="../modules/classes/netclient.html">NetClient</a></li>
        <li><a class="rounded" href="../modules/classes/netlookup.html">NetLookup</a></li>
        <li><a class="rounded" href="../modules/classes/netsocket.html">NetSocket</a></li>
        <li><a class="rounded" href="../modules/classes/proxy.html">Proxy</a></li>
        </ul></div>
        </li>
        <li>
        <button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle="collapse" data-bs-target="#vectors-collapse" aria-expanded="false">Vectors</button><div class="collapse" id="vectors-collapse"><ul class="btn-toggle-nav list-unstyled pb-1">
        <li><a class="rounded" href="../modules/classes/vector.html">Vector</a></li>
        <li><a class="rounded" href="../modules/classes/vectorclip.html">VectorClip</a></li>
        <li><a class="rounded" href="../modules/classes/vectorcolour.html">VectorColour</a></li>
        <li><a class="rounded" href="../modules/classes/vectorellipse.html">VectorEllipse</a></li>
        <li><a class="rounded" href="../modules/classes/vectorfilter.html">VectorFilter</a></li>
        <li><a class="rounded" href="../modules/classes/vectorgradient.html">VectorGradient</a></li>
        <li><a class="rounded" href="../modules/classes/vectorgroup.html">VectorGroup</a></li>
        <li><a class="rounded" href="../modules/classes/vectorimage.html">VectorImage</a></li>
        <li><a class="rounded" href="../modules/classes/vectorpath.html">VectorPath</a></li>
        <li><a class="rounded" href="../modules/classes/vectorpattern.html">VectorPattern</a></li>
        <li><a class="rounded" href="../modules/classes/vectorpolygon.html">VectorPolygon</a></li>
        <li><a class="rounded" href="../modules/classes/vectorrectangle.html">VectorRectangle</a></li>
        <li><a class="rounded" href="../modules/classes/vectorscene.html">VectorScene</a></li>
        <li><a class="rounded" href="../modules/classes/vectorshape.html">VectorShape</a></li>
        <li><a class="rounded" href="../modules/classes/vectorspiral.html">VectorSpiral</a></li>
        <li><a class="rounded" href="../modules/classes/vectortext.html">VectorText</a></li>
        <li><a class="rounded" href="../modules/classes/vectortransition.html">VectorTransition</a></li>
        <li><a class="rounded" href="../modules/classes/vectorviewport.html">VectorViewport</a></li>
        <li><a class="rounded" href="../modules/classes/vectorwave.html">VectorWave</a></li>
        </ul></div>
        </li>
      </ul>
    </div>
  </li>
</ul>

</div>
</div>

<div class="col-sm-9" style="max-width: 1200px;">
<div class="docs-content" id="default-page">
<h1>Fluid Reference Manual</h1>
<h2 id="introduction">Introduction</h2>
<p>Fluid is a <a href="https://lua.org">Lua-based</a> scripting language built on top of <a href="https://luajit.org">LuaJIT</a>. Lua was chosen as our preferred programming language due to its extensive popularity amongst game developers, a testament to its low overhead, speed and lightweight processing when compared to common scripting languages. We have heavily customised our Lua implementation for full integration with the Parasol Framework, as well as extending it with many new language features that are often requested by Lua developers. This approach is known as a &#39;hard fork&#39;, meaning we do not maintain compatibility with Lua as a language.</p>
<p>Fluid is fully interoperable with Parasol&#39;s C++ APIs due to a requirement that all interfaces are fully described. You can therefore read our online API documentation with confidence that the interfaces are universal, irrespective of language.</p>
<p>This manual expands on the information in the existing <a href="http://www.lua.org">Lua Reference Manual</a>, and covers features that are exclusive to Fluid. The official Lua 5.1 Reference Manual is required reading if you are unfamiliar with the language, and a working knowledge of Lua is assumed from this point onward.</p>
<h3 id="goals">Goals</h3>
<p>Fluid was designed with the following goals in mind:</p>
<ul>
<li><strong>Laziness</strong>: We want developers to be able to write code quickly and with minimal boilerplate. For instance, our type-inference-by-default approach allows variables to type-cast without explicit declarations. Features like safe navigation and short-hand operators are available to reduce verbosity.</li>
<li><strong>Simplicity</strong>: The language should be easy to learn and understand, with a minimal set of core concepts. Operator tokens and keywords have been carefully chosen to maximise readability and keep the parsing process simplified.</li>
<li><strong>Intuitiveness</strong>: The syntax and semantics should be logical and consistent. Lua features that weren&#39;t aligned with our changes have been removed.</li>
<li><strong>Interoperability</strong>: It must work seamlessly with existing C++ APIs and libraries to leverage the power of the Parasol Framework.</li>
<li><strong>Performance</strong>: Many of our changes to the LuaJIT base code have been made to maximise the efficiency of code produced by the compiler and JIT recorder. Some language features like the introduction of arrays allow for faster processing of sequential data. The new type system enables more optimised code paths to be generated in conjunction with the added type safety guarantees. Some of Fluid&#39;s best features are under the hood and out of sight - but they can be felt in day to day usage and are clear in performance comparisons to other scripting languages.</li>
</ul>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#resources">Resources</a></li>
<li><a href="#usage">Usage</a>
<ul>
<li><a href="#file-recognition">File Recognition</a></li>
</ul></li>
<li><a href="#lua-extensions">Lua Extensions</a>
<ul>
<li><a href="#breaking-changes">Breaking Changes</a></li>
<li><a href="#bitwise-operations">Bitwise Operations</a></li>
<li><a href="#bitshift-operators">Bitshift Operators</a></li>
<li><a href="#unicode-operators">Unicode Operators</a></li>
<li><a href="#script-parameters">Script Parameters</a></li>
<li><a href="#compound-assignment-operators">Compound Assignment Operators</a></li>
<li><a href="#concatenation-assignment">Concatenation Assignment</a></li>
<li><a href="#string-interpolation">String Interpolation</a></li>
<li><a href="#postfix-increment">Postfix Increment</a></li>
<li><a href="#arrow-functions">Arrow Functions</a></li>
<li><a href="#continue-statement">Continue Statement</a></li>
<li><a href="#to-be-closed-variables">To-Be-Closed Variables</a></li>
<li><a href="#constant-variables">Constant Variables</a></li>
<li><a href="#safe-navigation-operator">Safe Navigation Operator</a></li>
<li><a href="#type-annotations">Type Annotations</a></li>
</ul></li>
<li><a href="#sticky-types-type-inference">Sticky Types (Type Inference)</a>
<ul>
<li><a href="#implicit-type-fixing">Implicit Type Fixing</a></li>
<li><a href="#explicit-type-annotations">Explicit Type Annotations</a></li>
<li><a href="#the-any-type">The Any Type</a></li>
<li><a href="#nil-semantics">Nil Semantics</a></li>
<li><a href="#function-parameters">Function Parameters</a></li>
<li><a href="#function-return-types">Function Return Types</a></li>
</ul></li>
<li><a href="#variable-scoping">Variable Scoping</a>
<ul>
<li><a href="#local-variables">Local Variables</a></li>
<li><a href="#global-variables">Global Variables</a></li>
<li><a href="#migration-from-standard-lua">Migration from Standard Lua</a></li>
</ul></li>
<li><a href="#result-management">Result Management</a>
<ul>
<li><a href="#blank-identifier">Blank Identifier</a></li>
<li><a href="#pipe-operator">Pipe Operator</a>
<ul>
<li><a href="#pipe-iteration-with-ranges">Pipe Iteration with Ranges</a></li>
</ul></li>
<li><a href="#result-filter-operator">Result Filter Operator</a></li>
</ul></li>
<li><a href="#exception-handling">Exception Handling</a>
<ul>
<li><a href="#try-except-statement">Try-Except Statement</a></li>
<li><a href="#raising-exceptions">Raising Exceptions</a></li>
</ul></li>
<li><a href="#deference">Deference</a>
<ul>
<li><a href="#defer-statement">Defer Statement</a></li>
<li><a href="#deferred-expressions">Deferred Expressions</a></li>
<li><a href="#thunks">Thunks</a></li>
</ul></li>
<li><a href="#equality-operators">Equality Operators</a>
<ul>
<li><a href="#if-empty-logical-operator">If-Empty Logical Operator</a></li>
<li><a href="#if-empty-postfix-operator">If-Empty Postfix Operator</a></li>
<li><a href="#ternary-operator">Ternary Operator</a></li>
</ul></li>
<li><a href="#ranges">Ranges</a>
<ul>
<li><a href="#range-constructor">Range Constructor</a></li>
<li><a href="#range-literals">Range Literals</a></li>
<li><a href="#iteration-with-ranges">Iteration with Ranges</a></li>
<li><a href="#rangeslice">range.slice()</a></li>
<li><a href="#functional-iteration-with-each">Functional Iteration with each()</a></li>
<li><a href="#functional-range-methods">Functional Range Methods</a></li>
<li><a href="#string-slicing-with-ranges">String Slicing with Ranges</a></li>
<li><a href="#table-slicing-with-ranges">Table Slicing with Ranges</a></li>
<li><a href="#membership-testing">Membership Testing</a></li>
</ul></li>
<li><a href="#choose-expressions">Choose Expressions</a></li>
<li><a href="#script-management">Script Management</a>
<ul>
<li><a href="#include">include</a></li>
<li><a href="#import">import</a></li>
</ul></li>
<li><a href="#module-interface">Module Interface</a>
<ul>
<li><a href="#type-conversion">Type Conversion</a></li>
<li><a href="#buffer-handling">Buffer Handling</a></li>
<li><a href="#multiple-result-values">Multiple Result Values</a></li>
</ul></li>
<li><a href="#object-interface">Object Interface</a>
<ul>
<li><a href="#object-creation">Object Creation</a></li>
<li><a href="#object-relationships">Object Relationships</a></li>
<li><a href="#accessing-objects">Accessing Objects</a></li>
<li><a href="#garbage-collection">Garbage Collection</a></li>
<li><a href="#action-and-method-calls">Action and Method Calls</a></li>
<li><a href="#field-interface">Field Interface</a></li>
<li><a href="#bit-fields">Bit Fields</a></li>
</ul></li>
<li><a href="#action--method-subscriptions">Action &amp; Method Subscriptions</a></li>
<li><a href="#processing-interface">Processing Interface</a>
<ul>
<li><a href="#signals">Signals</a></li>
<li><a href="#garbage-collector">Garbage Collector</a></li>
</ul></li>
<li><a href="#math-interface">Math Interface</a></li>
<li><a href="#strings-interface">Strings Interface</a></li>
<li><a href="#thread-interface">Thread Interface</a></li>
<li><a href="#structure-interface">Structure Interface</a>
<ul>
<li><a href="#creating-a-structure">Creating a Structure</a></li>
<li><a href="#additional-functionality">Additional Functionality</a></li>
<li><a href="#custom-structures">Custom Structures</a></li>
</ul></li>
<li><a href="#regular-expression-interface">Regular Expression Interface</a>
<ul>
<li><a href="#creating-a-regex">Creating a Regex</a></li>
<li><a href="#flag-constants">Flag Constants</a></li>
<li><a href="#pattern-testing">Pattern Testing</a></li>
<li><a href="#pattern-matching-with-capture-groups">Pattern Matching with Capture Groups</a></li>
<li><a href="#global-matching">Global Matching</a></li>
<li><a href="#string-replacement">String Replacement</a></li>
<li><a href="#pattern-based-splitting">Pattern-Based Splitting</a></li>
<li><a href="#regex-properties">Regex Properties</a></li>
<li><a href="#performance-considerations">Performance Considerations</a></li>
</ul></li>
<li><a href="#array-interface">Array Interface</a>
<ul>
<li><a href="#array-manipulation-methods">Array Manipulation Methods</a></li>
<li><a href="#array-navigation-methods">Array Navigation Methods</a></li>
<li><a href="#array-data-extraction-methods">Array Data Extraction Methods</a></li>
<li><a href="#array-functional-methods">Array Functional Methods</a></li>
</ul></li>
<li><a href="#logging">Logging</a></li>
<li><a href="#annotations">Annotations</a>
<ul>
<li><a href="#annotation-syntax">Annotation Syntax</a></li>
<li><a href="#compile-time-pre-processor">Compile-Time Pre-Processor</a></li>
<li><a href="#standard-annotations">Standard Annotations</a></li>
<li><a href="#test-framework-annotations">Test Framework Annotations</a></li>
<li><a href="#debugfilesources-interface">debug.fileSources Interface</a></li>
<li><a href="#debuganno-interface">debug.anno Interface</a></li>
</ul></li>
<li><a href="#event-subsystem">Event Subsystem</a></li>
<li><a href="#credits">Credits</a></li>
</ul>
<h2 id="resources">Resources</h2>
<p>For more information on the usage of available classes and modules, please refer to the Parasol API at <a href="https://www.parasol.ws"><span>www.parasol.ws</span></a>.</p>
<p>For general information on the syntax provided by Lua, please read the following online manuals:</p>
<ul>
<li><a href="http://www.lua.org/manual/"><span>www.lua.org/manual/</span></a></li>
<li><a href="http://www.lua.org/pil/"><span>www.lua.org/pil/</span></a></li>
<li><a href="http://lua-users.org/wiki/SampleCode">lua-users.org/wiki/SampleCode</a></li>
</ul>
<hr>
<h2 id="usage">Usage</h2>
<p>To run a Fluid script, use the parasol executable:</p>
<p><code>parasol myfile.fluid</code></p>
<p>Named arguments can be passed to the Fluid script by following the script location with a series of variable values:</p>
<p><code>parasol myfile.fluid name=&#39;John&#39; surname=Bloggs</code></p>
<p>To debug a Fluid script, use the <code>--log-api</code> parameter.</p>
<p>For further information on available options, execute parasol with the <code>--help</code> parameter.</p>
<h3 id="file-recognition">File Recognition</h3>
<p>Fluid files can use the file extension <code>.lua</code> or <code>.fluid</code> for identification. Ideally, scripts should start with the comment <code>-- $FLUID</code> near the start of the document so that they can be correctly identified by the Fluid parser.</p>
<hr>
<h2 id="lua-extensions">Lua Extensions</h2>
<p>A number of extensions have been added (and some features removed) to Lua 5.2 in order to add value to the Fluid language. This section examines the major changes in regards to the published Lua Reference Manual.</p>
<h3 id="breaking-changes">Breaking Changes</h3>
<p>The Package and OS libraries normally found in Lua are removed as they duplicate features already found in Parasol&#39;s Script, File and Time classes. The introspective debug library is also removed for the purpose of reducing size.</p>
<p>The following Lua/LuaJIT features are unsupported or modified:</p>
<ul>
<li><code>~=</code> not equal operator; replaced with <code>!=</code></li>
<li><code>==</code> equality operator; replaced with <code>is</code></li>
<li><code>goto</code> and <code>::label::</code> statements; superceded by <code>continue</code>, <code>break</code>, <code>defer</code></li>
<li><code>bit.*</code> library; replaced with native bitwise operators</li>
<li><code>select()</code>; replaced with result masks <code>[_*]</code></li>
<li><code>loadstring()</code>; replaced with <code>load()</code></li>
<li><code>dofile()</code>; replaced with <code>loadFile()</code></li>
<li><code>pcall()</code> and <code>xpcall()</code>; replaced with <code>try … except</code></li>
<li><code>getfenv()</code>, <code>setfenv()</code>, <code>gcinfo()</code>, <code>table.maxn()</code>, <code>unpack()</code></li>
<li><code>io.*</code> interfaces now throw exceptions on error</li>
<li>One-based indexing for tables, strings and arrays; replaced with zero-based indexing</li>
<li>Variables are local by default; use the <code>global</code> keyword for globals</li>
<li>Arrays are a distinct and performance enhanced type; avoid using tables for sequential data storage</li>
</ul>
<h3 id="bitwise-operations">Bitwise Operations</h3>
<p>Fluid supports C-style bitwise operators on 32-bit integers:</p>
<ul>
<li><code>~x</code> bitwise NOT</li>
<li><code>a &amp; b</code> bitwise AND</li>
<li><code>a | b</code> bitwise OR</li>
</ul>
<p>Results follow two’s-complement 32-bit integer behaviour.</p>
<p>Compound assignment variants are not supported: <code>&amp;=</code>, <code>|=</code>, <code>~=</code> (bitwise) do not exist. Use <code>x = x &amp; y</code> and <code>x = x | y</code>.</p>
<p>Examples:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Bitwise NOT, shifts left by 2</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="op">~</span><span class="va">a</span> <span class="op">&lt;&lt;</span> <span class="dv">2</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Bitwise AND, then shifts right logical by 1</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="op">(</span><span class="va">a</span> <span class="op">&amp;</span> <span class="va">b</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Masks out the lower 8 bits</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">a</span> <span class="op">&amp;</span> <span class="dv">0xFF</span></span></code></pre></div>
<h3 id="bitshift-operators">Bitshift Operators</h3>
<p>Fluid adds infix bitshift operators for convenience:</p>
<ul>
<li><code>&lt;&lt;</code> left shift</li>
<li><code>&gt;&gt;</code> right shift</li>
</ul>
<p>Precedence and associativity:</p>
<ul>
<li>Shifts bind tighter than addition and subtraction, e.g. <code>1 + 1 &lt;&lt; 3</code> evaluates as <code>1 + (1 &lt;&lt; 3)</code> producing <code>9</code>.</li>
<li>The right-hand side of a shift is parsed as a full expression. For example, <code>8 &gt;&gt; 1 + 1</code> produces <code>2</code>.</li>
<li>Shifts are left-associative when chained: <code>x &lt;&lt; y &lt;&lt; z</code> parses as <code>(x &lt;&lt; y) &lt;&lt; z</code>.</li>
</ul>
<h3 id="unicode-operators">Unicode Operators</h3>
<p>Fluid supports Unicode alternatives for multi-character ASCII operators as well as Unicode arithmetic operators. These provide a cleaner visual appearance in editors with good Unicode font support.</p>
<h4 id="comparison-and-logical-operators">Comparison and Logical Operators</h4>
<table>
<thead>
<tr>
<th>Unicode</th>
<th>ASCII</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>≠</code></td>
<td><code>!=</code></td>
<td>Not equal</td>
</tr>
<tr>
<td><code>≤</code></td>
<td><code>&lt;=</code></td>
<td>Less than or equal</td>
</tr>
<tr>
<td><code>≥</code></td>
<td><code>&gt;=</code></td>
<td>Greater than or equal</td>
</tr>
<tr>
<td><code>«</code></td>
<td><code>&lt;&lt;</code></td>
<td>Left shift</td>
</tr>
<tr>
<td><code>»</code></td>
<td><code>&gt;&gt;</code></td>
<td>Right shift</td>
</tr>
<tr>
<td><code>‥</code></td>
<td><code>..</code></td>
<td>Concatenation</td>
</tr>
<tr>
<td><code>…</code></td>
<td><code>...</code></td>
<td>Varargs (horizontal ellipsis)</td>
</tr>
<tr>
<td><code>⁇</code></td>
<td><code>??</code></td>
<td>Null coalescing (if-empty)</td>
</tr>
<tr>
<td><code>▷</code></td>
<td><code>:&gt;</code></td>
<td>Ternary separator</td>
</tr>
<tr>
<td><code>⧺</code></td>
<td><code>++</code></td>
<td>Increment</td>
</tr>
</tbody>
</table>
<h4 id="arithmetic-operators">Arithmetic Operators</h4>
<table>
<thead>
<tr>
<th>Unicode</th>
<th>ASCII</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>×</code></td>
<td><code>*</code></td>
<td>Multiplication</td>
</tr>
<tr>
<td><code>÷</code></td>
<td><code>/</code></td>
<td>Division</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Comparison and logical operators</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="va">x</span> <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="va">x</span>⧺                          <span class="co">-- increment</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="va">name</span>  <span class="op">=</span> <span class="va">user</span> ⁇ <span class="st">&#39;Anonymous&#39;</span>  <span class="co">-- null coalescing</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="va">max</span>   <span class="op">=</span> <span class="va">a</span> ≥ <span class="va">b</span> ? <span class="va">a</span> ▷ <span class="va">b</span>       <span class="co">-- comparison with ternary</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="va">msg</span>   <span class="op">=</span> <span class="st">&#39;Hello&#39;</span> ‥ <span class="st">&#39; World&#39;</span>  <span class="co">-- concatenation</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="va">flags</span> <span class="op">=</span> <span class="dv">1</span> « <span class="dv">4</span>               <span class="co">-- left shift</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Varargs</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> process<span class="op">(</span>…<span class="op">)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="op">{</span>…<span class="op">}</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Arithmetic operators</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="dv">10</span> × <span class="dv">5</span> ÷ <span class="dv">2</span>         <span class="co">-- 25 (multiplication and division)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="va">area</span> <span class="op">=</span> <span class="va">radius</span> × <span class="va">radius</span> × <span class="cn">PI</span> <span class="co">-- circle area</span></span></code></pre></div>
<p>Both ASCII and Unicode forms can be mixed freely in the same source file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="va">x</span> <span class="op">=</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">3</span> × <span class="dv">2</span> ÷ <span class="dv">1</span> <span class="op">/</span> <span class="dv">2</span>     <span class="co">-- All forms work together</span></span></code></pre></div>
<h3 id="script-parameters">Script Parameters</h3>
<p>Arguments passed to the Fluid script can be accessed via the <code>arg()</code> function. In the following example either &#39;width&#39; is returned or <code>1024</code> otherwise:</p>
<p><code>width = arg(&#39;width&#39;, 1024)</code></p>
<p>All arguments are managed as strings regardless of the type of the value.</p>
<h3 id="compound-assignment-operators">Compound Assignment Operators</h3>
<p>Fluid adds C-style compound assignment operators for convenience:</p>
<ul>
<li><code>+=</code>, <code>-=</code>, <code>*=</code>, <code>/=</code>, <code>%=</code> on numeric values</li>
<li><code>..=</code> for string concatenation</li>
</ul>
<p>RHS behaviour:</p>
<ul>
<li>The right-hand side is evaluated exactly once.</li>
<li>If the RHS is a function call or vararg, only the first return value is used.</li>
</ul>
<p>Errors and types:</p>
<ul>
<li>Using a non-assignable left-hand side (e.g. a constant or a function call result) is an error.</li>
</ul>
<h3 id="concatenation-assignment">Concatenation Assignment</h3>
<p>The <code>..=</code> operator appends to an existing string:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">s</span> <span class="op">=</span> <span class="st">&#39;a&#39;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="va">s</span> <span class="op">.</span><span class="er">.=</span> <span class="st">&#39;bc&#39;</span>        <span class="co">-- s is &#39;abc&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="va">s</span> <span class="op">.</span><span class="er">.=</span> <span class="fu">tostring</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="co">-- s is &#39;abc1&#39;</span></span></code></pre></div>
<p>Semantics mirror <code>s = s .. rhs</code>. The left-hand side is evaluated once and the RHS uses only its first return value.</p>
<h3 id="string-interpolation">String Interpolation</h3>
<p>Fluid supports Python-style f-strings for embedding expressions directly within string literals. F-strings are prefixed with <code>f</code> and use curly braces <code>{}</code> to delimit expressions.</p>
<p><strong>Basic Syntax:</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="st">&quot;World&quot;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="va">greeting</span> <span class="op">=</span> f<span class="st">&quot;Hello {name}&quot;</span>    <span class="co">-- &quot;Hello World&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">a</span> <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="va">b</span> <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> f<span class="st">&#39;{a} + {b} = {a + b}&#39;</span>  <span class="co">-- &#39;10 + 20 = 30&#39;</span></span></code></pre></div>
<p>Both single and double quotes are supported.</p>
<p><strong>Expression Support:</strong></p>
<p>Any valid Fluid expression can be used inside the braces:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Arithmetic</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;Result: {1 + 2 * 3}&quot;</span>           <span class="co">-- &quot;Result: 7&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Function calls</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;Upper: {string.upper(&#39;hello&#39;)}&quot;</span>  <span class="co">-- &quot;Upper: HELLO&quot;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Table field access</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="va">user</span> <span class="op">=</span> <span class="op">{</span><span class="va">name</span> <span class="op">=</span> <span class="st">&quot;Alice&quot;</span><span class="op">,</span> <span class="va">age</span> <span class="op">=</span> <span class="dv">30</span><span class="op">}</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;{user.name} is {user.age}&quot;</span>     <span class="co">-- &quot;Alice is 30&quot;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Method calls</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;Name: {obj:getName()}&quot;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Nested tables in expressions</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;Point: {point.x}, {point.y}&quot;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">-- Nil handling with ??</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;Your name is {user.name ?? &#39;unknown&#39;}&quot;</span></span></code></pre></div>
<p>It is strongly recommended that nil handling is always employed with the <code>??</code> operator if the data originates from outside the script.</p>
<p><strong>Automatic Type Conversion:</strong></p>
<p>All interpolated expressions are automatically wrapped in <code>tostring()</code>, ensuring proper conversion of any value type:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;{nil}&quot;</span>      <span class="co">-- &quot;nil&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;{true}&quot;</span>     <span class="co">-- &quot;true&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;{42}&quot;</span>       <span class="co">-- &quot;42&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;{3.14}&quot;</span>     <span class="co">-- &quot;3.14&quot;</span></span></code></pre></div>
<p><strong>Escaping Braces:</strong></p>
<p>To include literal braces in the output, double them:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>f<span class="st">&quot;Use {{braces}} for interpolation&quot;</span>  <span class="co">-- &quot;Use {braces} for interpolation&quot;</span></span></code></pre></div>
<p><strong>Restrictions:</strong></p>
<ul>
<li>Long string syntax is not supported: <code>f[[...]]</code> is invalid</li>
<li>Empty expressions <code>{}</code> or whitespace-only expressions <code>{   }</code> are syntax errors</li>
</ul>
<h3 id="postfix-increment">Postfix Increment</h3>
<p>Fluid supports a postfix increment operator for convenience:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="va">counter</span><span class="er">++</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="va">obj</span><span class="op">.</span><span class="va">field</span><span class="er">++</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="er">++</span></span></code></pre></div>
<p>Notes:</p>
<ul>
<li>Postfix only; there is no prefix form.</li>
<li>The operator mutates the target by adding 1. Use only on assignable values (locals, upvalues, globals, fields, indexed elements).</li>
<li>Intended for statement use. The value of the <code>x++</code> expression itself is unspecified and should not be relied upon in expressions.</li>
</ul>
<h3 id="arrow-functions">Arrow Functions</h3>
<p><code>=&gt;</code> provides concise anonymous function syntax. Single-expression bodies are implicitly returned; multi-statement bodies use <code>do ... end</code> with an explicit <code>return</code>.</p>
<ul>
<li>Single identifiers do not need parentheses: <code>value =&gt; value * 2</code></li>
<li>Multiple parameters must be parenthesised: <code>(left, right) =&gt; left + right</code></li>
<li>Use empty parentheses for no parameters: <code>() =&gt; 42</code></li>
<li>Varargs are not supported; use <code>function(...)</code> when needed.</li>
</ul>
<p>Examples:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="va">double</span> <span class="op">=</span> <span class="va">n</span> <span class="op">=&gt;</span> <span class="va">n</span> <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="va">adder</span> <span class="op">=</span> <span class="op">(</span><span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="va">on_click</span> <span class="op">=</span> <span class="op">()</span> <span class="op">=&gt;</span> <span class="cf">do</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Clicked&#39;</span><span class="op">)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="kw">true</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="va">numbers</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}</span> <span class="op">|&gt;</span> map<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">*</span> <span class="dv">3</span><span class="op">)</span> <span class="op">|&gt;</span> filter<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&gt;</span> <span class="dv">10</span><span class="op">)</span></span></code></pre></div>
<p>Arrow bodies bind loosely, so the expression after <code>=&gt;</code> extends as far right as possible.</p>
<h3 id="continue-statement">Continue Statement</h3>
<p>Fluid adds a <code>continue</code> statement for all loop forms:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}</span> <span class="cf">do</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="va">i</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span> <span class="cf">then</span> <span class="va">continue</span> <span class="cf">end</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- odd numbers only</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">cond</span> <span class="cf">do</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> skip<span class="op">()</span> <span class="cf">then</span> <span class="va">continue</span> <span class="cf">end</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  work<span class="op">()</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="kw">not</span> ready<span class="op">()</span> <span class="cf">then</span> <span class="va">continue</span> <span class="cf">end</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="cf">until</span> <span class="va">done</span></span></code></pre></div>
<p><code>continue</code> skips the remainder of the current loop body and advances to the next iteration. In <code>repeat … until</code>, it jumps to the condition check.</p>
<h3 id="to-be-closed-variables">To-Be-Closed Variables</h3>
<p>The <code>&lt;close&gt;</code> attribute marks local variables for automatic cleanup via the <code>__close</code> metamethod when scope exits. This is more optimal than manually calling the garbage collector.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="va">resource</span> <span class="op">&lt;</span><span class="fu">close</span><span class="op">&gt;</span> <span class="op">=</span> acquire_resource<span class="op">()</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- resource.__close(resource, nil) called automatically when scope ends</span></span></code></pre></div>
<p>The <code>__close</code> metamethod receives two arguments: the object being closed and an error value (<code>nil</code> for normal exit, the error object during error unwinding).</p>
<p><strong>Execution order:</strong></p>
<ul>
<li>Close handlers run before <code>defer</code> blocks (both in LIFO order)</li>
<li>Triggered on normal scope exit, <code>return</code>, <code>break</code>, <code>continue</code>, and error unwinding</li>
</ul>
<p><strong>Error propagation:</strong></p>
<p>When an error is thrown and caught by <code>try</code>, the <code>__close</code> handler receives the error as its second argument, enabling proper error-aware cleanup.</p>
<p><strong>Primitive values:</strong></p>
<p>Values without metatables (<code>nil</code>, <code>false</code>, strings, numbers) are safely ignored.</p>
<p><strong>Error handling:</strong></p>
<p>For cleanup that needs to know about errors, check the second argument:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">file</span> <span class="op">&lt;</span><span class="fu">close</span><span class="op">&gt;</span> <span class="op">=</span> open_file<span class="op">()</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>   risky_operation<span class="op">()</span>  <span class="co">-- If this throws, file.__close still runs</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h3 id="constant-variables">Constant Variables</h3>
<p>The <code>&lt;const&gt;</code> attribute marks local or global variables as constant, preventing reassignment after initialisation. This provides compile-time enforcement of immutability for variable bindings.</p>
<p><strong>Syntax:</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">max_size</span> <span class="at">&lt;const&gt;</span> <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">prefix</span> <span class="at">&lt;const&gt;</span><span class="op">:</span><span class="va">str</span> <span class="op">=</span> <span class="st">&quot;test_&quot;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="cn">DEBUG_MODE</span> <span class="op">&lt;</span><span class="va">const</span><span class="op">&gt;</span> <span class="op">=</span> <span class="kw">true</span></span></code></pre></div>
<p>The <code>&lt;const&gt;</code> attribute can appear before or after a type annotation:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">value</span> <span class="at">&lt;const&gt;</span><span class="op">:</span><span class="va">num</span> <span class="op">=</span> <span class="dv">42</span>    <span class="co">-- Attribute before type</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">value</span><span class="op">:</span><span class="va">num</span> <span class="op">&lt;</span><span class="va">const</span><span class="op">&gt;</span> <span class="op">=</span> <span class="dv">42</span>    <span class="co">-- Type before attribute (also valid)</span></span></code></pre></div>
<p><strong>Initialiser requirement:</strong></p>
<p>Const variables must be initialised at declaration. Declaring a const without an initialiser is a compile-time error:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">x</span> <span class="at">&lt;const&gt;</span>           <span class="co">-- Error: const local &#39;x&#39; requires an initialiser</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="va">glY</span> <span class="op">&lt;</span><span class="va">const</span><span class="op">&gt;</span>          <span class="co">-- Error: const global &#39;glY&#39; requires an initialiser</span></span></code></pre></div>
<p><strong>Reassignment prevention:</strong></p>
<p>Attempting to reassign a const variable produces a compile-time error:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">x</span> <span class="at">&lt;const&gt;</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="va">x</span> <span class="op">=</span> <span class="dv">2</span>                     <span class="co">-- Error: cannot assign to const local &#39;x&#39;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="cn">CONFIG</span> <span class="op">&lt;</span><span class="va">const</span><span class="op">&gt;</span> <span class="op">=</span> <span class="op">{}</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cn">CONFIG</span> <span class="op">=</span> <span class="op">{}</span>               <span class="co">-- Error: cannot assign to const global &#39;CONFIG&#39;</span></span></code></pre></div>
<p><strong>Table contents are mutable:</strong></p>
<p>The <code>&lt;const&gt;</code> attribute protects the variable binding, not the contents of the value. Table and object contents can still be modified:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">data</span> <span class="at">&lt;const&gt;</span> <span class="op">=</span> <span class="op">{</span> <span class="va">x</span> <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="va">y</span> <span class="op">=</span> <span class="dv">2</span> <span class="op">}</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="va">data</span><span class="op">.</span><span class="va">x</span> <span class="op">=</span> <span class="dv">999</span>              <span class="co">-- Valid: modifying table contents</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="va">data</span><span class="op">.</span><span class="va">z</span> <span class="op">=</span> <span class="dv">3</span>                <span class="co">-- Valid: adding new fields</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="va">data</span> <span class="op">=</span> <span class="op">{}</span>                 <span class="co">-- Error: cannot reassign the binding</span></span></code></pre></div>
<p><strong>Multiple declarations:</strong></p>
<p>In multiple variable declarations, each variable can independently have the <code>&lt;const&gt;</code> attribute:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span> <span class="at">&lt;const&gt;</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span> <span class="at">&lt;const&gt;</span> <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- a and c are const, b is mutable</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="va">b</span> <span class="op">=</span> <span class="dv">20</span>                    <span class="co">-- Valid</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="va">a</span> <span class="op">=</span> <span class="dv">10</span>                    <span class="co">-- Error: cannot assign to const local &#39;a&#39;</span></span></code></pre></div>
<p><strong>Scope behaviour:</strong></p>
<p>Const variables follow normal scoping rules. A const in an outer scope can be shadowed by a new variable in an inner scope:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">x</span> <span class="at">&lt;const&gt;</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> <span class="va">x</span> <span class="op">=</span> <span class="dv">2</span>            <span class="co">-- Valid: shadows outer const</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   <span class="va">x</span> <span class="op">=</span> <span class="dv">3</span>                  <span class="co">-- Valid: inner x is not const</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Outer x is still 1 and still const</span></span></code></pre></div>
<h2 id="safe-navigation-operator">Safe Navigation Operator</h2>
<p>The safe navigation operator (<code>?.</code>) provides null-safe access to object fields, methods, and indexes.</p>
<h3 id="syntax">Syntax</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="va">obj</span>?<span class="op">.</span><span class="va">field</span>      <span class="co">-- Safe field access</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="va">obj</span>?<span class="op">.</span>method<span class="op">()</span>   <span class="co">-- Safe method call</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="va">obj</span>?<span class="op">[</span><span class="va">key</span><span class="op">]</span>       <span class="co">-- Safe index access</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="va">obj</span>?<span class="op">.</span><span class="va">a</span>?<span class="op">.</span><span class="va">b</span>?<span class="op">.</span><span class="va">c</span>    <span class="co">-- Chaining</span></span></code></pre></div>
<h3 id="behaviour">Behaviour</h3>
<p>If the object is <code>nil</code>, the safe navigation operator returns <code>nil</code> without attempting to access the field/method/index. This prevents &quot;attempt to index a nil value&quot; errors.</p>
<p><strong>Important:</strong> The safe navigation operator only checks for <code>nil</code>. Other falsey values like <code>false</code>, <code>0</code>, or <code>&quot;&quot;</code> are treated as valid objects and field access proceeds normally.</p>
<h3 id="examples">Examples</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Safe field access</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="va">user</span> <span class="op">=</span> <span class="kw">nil</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="va">user</span>?<span class="op">.</span><span class="va">name</span>  <span class="co">-- Returns nil instead of error</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="va">user2</span> <span class="op">=</span> <span class="op">{</span> <span class="va">name</span> <span class="op">=</span> <span class="st">&quot;Alice&quot;</span> <span class="op">}</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="va">name2</span> <span class="op">=</span> <span class="va">user2</span>?<span class="op">.</span><span class="va">name</span>  <span class="co">-- Returns &quot;Alice&quot;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Chaining</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="va">city</span> <span class="op">=</span> <span class="va">user</span>?<span class="op">.</span><span class="va">profile</span>?<span class="op">.</span><span class="va">address</span>?<span class="op">.</span><span class="va">city</span>  <span class="co">-- Returns nil if any level is nil</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- With default values using if-empty operator</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="va">displayName</span> <span class="op">=</span> <span class="va">user</span>?<span class="op">.</span><span class="va">name</span> ?? <span class="st">&quot;Guest&quot;</span>  <span class="co">-- &quot;Guest&quot; if user or name is nil</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Safe method calls</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">obj</span>?<span class="op">.</span>calculate<span class="op">()</span>  <span class="co">-- Returns nil if obj or calculate() is nil</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">-- Multiple return values preserved</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">,</span> <span class="va">b</span> <span class="op">=</span> <span class="va">obj</span>?<span class="op">.</span>getTwoValues<span class="op">()</span>  <span class="co">-- Both a and b will be nil if obj or getTwoValues() is nil</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">-- Safe index access</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="va">value</span> <span class="op">=</span> <span class="va">table</span>?<span class="op">[</span><span class="va">key</span><span class="op">]</span>  <span class="co">-- Returns nil if table is nil</span></span></code></pre></div>
<h2 id="type-annotations">Type Annotations</h2>
<p>Fluid supports optional type annotations on function parameters to surface static analysis diagnostics during parsing.
Annotations follow the parameter name after a colon and constrain the expected argument type.</p>
<h3 id="syntax-1">Syntax</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> process<span class="op">(</span><span class="va">Path</span><span class="op">:</span><span class="va">str</span><span class="op">,</span> <span class="va">Count</span><span class="op">:</span><span class="va">num</span><span class="op">,</span> <span class="va">Options</span><span class="op">:</span><span class="va">table</span><span class="op">)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Path must be a string</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Count must be a number</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Options must be a table</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Untyped parameters omit the annotation:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> mixed<span class="op">(</span><span class="va">Untyped</span><span class="op">,</span> <span class="va">Typed</span><span class="op">:</span><span class="va">bool</span><span class="op">):</span> <span class="op">&lt;</span><span class="va">any</span><span class="op">,</span><span class="va">bool</span><span class="op">&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">Untyped</span><span class="op">,</span> <span class="va">Typed</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h3 id="supported-type-names">Supported Type Names</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>any</code></td>
<td>Accepts any type</td>
</tr>
<tr>
<td><code>nil</code></td>
<td>Explicit nil</td>
</tr>
<tr>
<td><code>num</code></td>
<td>Numeric values</td>
</tr>
<tr>
<td><code>str</code></td>
<td>Text strings</td>
</tr>
<tr>
<td><code>bool</code></td>
<td>Boolean values</td>
</tr>
<tr>
<td><code>table</code></td>
<td>Tables and dictionaries</td>
</tr>
<tr>
<td><code>func</code></td>
<td>Callable values</td>
</tr>
<tr>
<td><code>thread</code></td>
<td>Coroutines</td>
</tr>
<tr>
<td><code>obj</code></td>
<td>Parasol objects (userdata)</td>
</tr>
</tbody>
</table>
<p>Unknown type names raise diagnostics during parsing with the <code>UnknownTypeName</code> error code.</p>
<hr>
<h2 id="sticky-types-type-inference">Sticky Types (Type Inference)</h2>
<p>Fluid employs a lazy type inference system that commits local variables to a specific type upon their first meaningful assignment. This approach balances the convenience of dynamic typing with the safety and performance benefits of static type knowledge.</p>
<p>Unlike traditional static type systems that require explicit annotations, sticky types work transparently:</p>
<ul>
<li>Typeless variables are automatically fixed to the type of their first non-nil value.</li>
<li>The <code>nil</code> value acts as a placeholder that does not commit the type.</li>
<li>Explicit type annotations are optional, primarily useful for pre-declarations or guarding function parameters.</li>
<li>The <code>any</code> type annotation opts out of type fixing for variables that genuinely need variant behaviour.</li>
</ul>
<p><strong>Benefits:</strong></p>
<ol type="1">
<li><strong>Error detection</strong>: Type mismatches are reported as compile-time errors, catching bugs before execution</li>
<li><strong>Code clarity</strong>: Reading code becomes easier when variables maintain consistent types</li>
<li><strong>Optimisation potential</strong>: The JIT can generate more efficient code when variable types are known to be stable</li>
</ol>
<h3 id="implicit-type-fixing">Implicit Type Fixing</h3>
<p>When a local variable is assigned a non-nil value, its type becomes fixed to that value&#39;s type:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">count</span> <span class="op">=</span> <span class="dv">0</span>      <span class="co">-- count is fixed to &#39;number&#39;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="va">count</span> <span class="op">=</span> <span class="dv">10</span>           <span class="co">-- Valid</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="va">count</span> <span class="op">=</span> <span class="st">&quot;ten&quot;</span>        <span class="co">-- Error: cannot assign &#39;string&#39; to variable of type &#39;number&#39;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="st">&quot;Alice&quot;</span>       <span class="co">-- name is fixed to &#39;string&#39;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="st">&quot;Bob&quot;</span>         <span class="co">-- Valid</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="dv">42</span>            <span class="co">-- Error: cannot assign &#39;number&#39; to variable of type &#39;string&#39;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="va">glItems</span> <span class="op">=</span> <span class="op">{}</span>    <span class="co">-- glItems is fixed to &#39;table&#39;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="va">glItems</span> <span class="op">=</span> <span class="op">{</span> <span class="va">a</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">}</span>    <span class="co">-- Valid</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="va">glItems</span> <span class="op">=</span> <span class="st">&quot;list&quot;</span>       <span class="co">-- Error: cannot assign &#39;string&#39; to variable of type &#39;table&#39;</span></span></code></pre></div>
<p>This behaviour is automatic and requires no additional syntax. The compiler infers the type from the first assignment
and enforces consistency thereafter.</p>
<h3 id="explicit-type-annotations">Explicit Type Annotations</h3>
<p>Type annotations can be added to local variable declarations using the <code>:type</code> syntax. This is useful for
pre-declaring variables or documenting intent:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">limit</span><span class="op">:</span> <span class="va">num</span>          <span class="co">-- pre-declared as number, starts as nil</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="va">limit</span> <span class="op">=</span> <span class="dv">100</span>               <span class="co">-- Valid</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="va">limit</span> <span class="op">=</span> <span class="st">&quot;high&quot;</span>            <span class="co">-- Error: cannot assign &#39;string&#39; to variable of type &#39;number&#39;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">message</span><span class="op">:</span> <span class="va">str</span> <span class="op">=</span> <span class="st">&quot;&quot;</span>   <span class="co">-- pre-declared as string with initial value</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="va">message</span> <span class="op">=</span> <span class="st">&quot;hello&quot;</span>         <span class="co">-- Valid</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="va">message</span> <span class="op">=</span> <span class="kw">nil</span>             <span class="co">-- Clears the value (type remains &#39;str&#39;)</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="va">message</span> <span class="op">=</span> <span class="dv">42</span>              <span class="co">-- Error: cannot assign &#39;number&#39; to variable of type &#39;string&#39;</span></span></code></pre></div>
<p>Explicit annotations also catch type mismatches in the initial value:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">count</span><span class="op">:</span> <span class="va">num</span> <span class="op">=</span> <span class="st">&quot;text&quot;</span> <span class="co">-- Error: cannot assign &#39;string&#39; to variable of type &#39;number&#39;</span></span></code></pre></div>
<p>The supported type names are: <code>any</code>, <code>nil</code>, <code>bool</code> (or <code>boolean</code>), <code>num</code> (or <code>number</code>), <code>str</code> (or <code>string</code>), <code>table</code>,
<code>array</code>, <code>func</code> (or <code>function</code>), <code>obj</code> (or <code>object</code>).</p>
<h3 id="the-any-type">The Any Type</h3>
<p>Use the <code>any</code> type annotation to preserve traditional dynamic typing for variables that genuinely need to hold different types:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="va">variant</span><span class="op">:</span> <span class="va">any</span> <span class="op">=</span> <span class="dv">0</span>    <span class="co">-- Explicitly variant, all further assignments are valid</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="va">variant</span> <span class="op">=</span> <span class="st">&quot;now a string&quot;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="va">variant</span> <span class="op">=</span> <span class="op">{</span> <span class="va">key</span> <span class="op">=</span> <span class="kw">true</span> <span class="op">}</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="va">variant</span> <span class="op">=</span> <span class="kw">nil</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="va">variant</span> <span class="op">=</span> load_json<span class="op">()</span></span></code></pre></div>
<p>The <code>any</code> type is the escape hatch when you need flexibility. However it does come with disadvantages: 1. It disables the type safety benefits for that variable; 2. The JIT compiler has fewer optimisation opportunities when dealing with variant types.</p>
<h3 id="nil-semantics">Nil Semantics</h3>
<p>The <code>nil</code> value has special status in the type system, allowing variables to be cleared to their empty state regardless of their type.</p>
<p><strong>Uninitialised variables</strong>: Variables declared without an initial value start as nil with no type commitment. The
type is fixed when the first non-nil value is assigned:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">result</span>              <span class="co">-- result is nil (type uncommitted)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="kw">nil</span>              <span class="co">-- still uncommitted</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> calculate<span class="op">()</span>      <span class="co">-- result is now fixed to whatever calculate() returns</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="st">&quot;fallback&quot;</span>       <span class="co">-- Error if calculate() returned a non-string type</span></span></code></pre></div>
<p><strong>Nil as a clear operation</strong>: Once a variable has a fixed type, assigning nil clears the value but preserves the type
constraint. The next non-nil assignment must still match the fixed type:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="st">&quot;Alice&quot;</span>     <span class="co">-- Assign a string to new variable &#39;name&#39;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="kw">nil</span>         <span class="co">-- Clear the value</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="st">&quot;Bob&quot;</span>       <span class="co">-- Valid</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="dv">42</span>          <span class="co">-- Error: Cannot assign &#39;number&#39; to variable of type &#39;string&#39;</span></span></code></pre></div>
<p>This design allows variables to represent &quot;optional&quot; or &quot;nullable&quot; values naturally without requiring a separate
nullable type annotation, while still enforcing type consistency for non-nil values.</p>
<h3 id="function-parameters">Function Parameters</h3>
<p>Function parameter type annotations serve as guards that validate incoming arguments. Unlike local variable type
fixing (which is lazy), parameter annotations are checked at call-time:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> greet<span class="op">(</span><span class="va">Name</span><span class="op">:</span> <span class="va">str</span><span class="op">,</span> <span class="va">Times</span><span class="op">:</span> <span class="va">num</span><span class="op">)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">1.</span><span class="op">..</span><span class="va">Times</span><span class="op">}</span> <span class="cf">do</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Hello, &quot;</span> <span class="op">..</span> <span class="va">Name</span><span class="op">)</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>greet<span class="op">(</span><span class="st">&quot;World&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">)</span>         <span class="co">-- OK</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>greet<span class="op">(</span><span class="dv">42</span><span class="op">,</span> <span class="dv">3</span><span class="op">)</span>              <span class="co">-- ERROR: expected &#39;string&#39; for parameter &#39;Name&#39;</span></span></code></pre></div>
<p>Parameter annotations are particularly important for public APIs and library functions where input validation is
critical. They provide documentation and runtime safety at the function boundary.</p>
<p><strong>Mixing typed and untyped parameters:</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> process<span class="op">(</span><span class="va">Data</span><span class="op">,</span> <span class="va">Count</span><span class="op">:</span> <span class="va">num</span><span class="op">,</span> <span class="va">Validate</span><span class="op">:</span> <span class="va">bool</span><span class="op">)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Data accepts any type (no annotation)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Count must be a number</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Validate must be a boolean</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Untyped parameters remain fully dynamic and accept any value, preserving flexibility where needed.</p>
<h3 id="function-return-types">Function Return Types</h3>
<p>Fluid supports optional return type declarations on functions to enable compile-time validation of returned values. Additionally, more optimal code can be generated through the narrowing of return types. Return types are declared after the parameter list using a colon followed by the type (or a tuple of types for multiple returns).</p>
<p><strong>Single return type:</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> calculate_area<span class="op">(</span><span class="va">Radius</span><span class="op">:</span> <span class="va">num</span><span class="op">):</span> <span class="va">num</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">math.pi</span> <span class="op">*</span> <span class="va">Radius</span> <span class="op">*</span> <span class="va">Radius</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> get_name<span class="op">():</span> <span class="va">str</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="st">&quot;Alice&quot;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><strong>Multiple return types:</strong></p>
<p>Functions that return multiple values can declare each type in angle brackets:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> divide<span class="op">(</span><span class="cn">A</span><span class="op">:</span> <span class="va">num</span><span class="op">,</span> <span class="cn">B</span><span class="op">:</span> <span class="va">num</span><span class="op">):&lt;</span><span class="va">num</span><span class="op">,</span> <span class="va">num</span><span class="op">&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="fu">math.floor</span><span class="op">(</span><span class="cn">A</span> <span class="op">/</span> <span class="cn">B</span><span class="op">),</span> <span class="cn">A</span> <span class="op">%</span> <span class="cn">B</span>  <span class="co">-- quotient and remainder</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> parse_header<span class="op">(</span><span class="va">Line</span><span class="op">:</span> <span class="va">str</span><span class="op">):&lt;</span><span class="va">str</span><span class="op">,</span> <span class="va">str</span><span class="op">,</span> <span class="va">num</span><span class="op">&gt;</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Returns name, value, and position</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">name</span><span class="op">,</span> <span class="va">value</span><span class="op">,</span> <span class="va">pos</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><strong>Variadic return types:</strong></p>
<p>When the last return value can repeat (e.g., returning variable numbers of values), use <code>...</code> after the last type:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> get_values<span class="op">():&lt;</span><span class="va">num</span><span class="op">,</span> <span class="op">...&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span>  <span class="co">-- First is num, rest are also num</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h4 id="return-type-inference">Return Type Inference</h4>
<p>When no explicit return type is declared, Fluid infers the return type from the function&#39;s <code>return</code> statements using a
&quot;first-wins&quot; rule:</p>
<ol type="1">
<li>The first <code>return</code> statement with a non-nil value establishes the expected type(s)</li>
<li>Subsequent <code>return</code> statements must be consistent with the established types</li>
<li>Returning <code>nil</code> is always permitted (it acts as &quot;no value&quot; and doesn&#39;t establish a type)</li>
</ol>
<div class="sourceCode" id="cb36"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> find_user<span class="op">(</span><span class="va">Id</span><span class="op">:</span> <span class="va">num</span><span class="op">)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">user</span> <span class="op">=</span> <span class="va">database</span><span class="op">.</span>lookup<span class="op">(</span><span class="va">Id</span><span class="op">)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="kw">not</span> <span class="va">user</span> <span class="cf">then</span> <span class="cf">return</span> <span class="kw">nil</span> <span class="cf">end</span>  <span class="co">-- nil doesn&#39;t establish a type</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">user</span>                       <span class="co">-- First non-nil return: fixes type to whatever user is</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> get_status<span class="op">(</span><span class="va">Code</span><span class="op">:</span> <span class="va">num</span><span class="op">)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">Code</span> <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">then</span> <span class="cf">return</span> <span class="kw">nil</span> <span class="cf">end</span>   <span class="co">-- nil is allowed</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">Code</span> <span class="va">is</span> <span class="dv">0</span> <span class="cf">then</span> <span class="cf">return</span> <span class="st">&quot;OK&quot;</span> <span class="cf">end</span> <span class="co">-- Establishes type as &#39;str&#39;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="st">&quot;Error&quot;</span>                     <span class="co">-- Must also be &#39;str&#39;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><strong>Type mismatch errors:</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> broken<span class="op">()</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">condition</span> <span class="cf">then</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">&quot;text&quot;</span>     <span class="co">-- Establishes type as &#39;str&#39;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">42</span>            <span class="co">-- Error: inconsistent return type, expected &#39;str&#39;, got &#39;num&#39;</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h4 id="the-any-return-type">The <code>any</code> Return Type</h4>
<p>Use <code>any</code> to opt out of return type checking for functions that genuinely return different types:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> json_decode<span class="op">(</span><span class="va">Text</span><span class="op">:</span> <span class="va">str</span><span class="op">):&lt;</span><span class="va">any</span><span class="op">,</span> <span class="va">num</span><span class="op">&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Returns decoded value (could be table, string, number, bool, or nil)</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- and the position after parsing</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">decoded_value</span><span class="op">,</span> <span class="va">pos</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> dynamic_result<span class="op">(</span><span class="va">Mode</span><span class="op">:</span> <span class="va">str</span><span class="op">):</span> <span class="va">any</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">Mode</span> is <span class="st">&quot;number&quot;</span> <span class="cf">then</span> <span class="cf">return</span> <span class="dv">42</span> <span class="cf">end</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">Mode</span> is <span class="st">&quot;string&quot;</span> <span class="cf">then</span> <span class="cf">return</span> <span class="st">&quot;hello&quot;</span> <span class="cf">end</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="op">{</span> <span class="va">key</span> <span class="op">=</span> <span class="st">&quot;value&quot;</span> <span class="op">}</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h4 id="recursive-functions">Recursive Functions</h4>
<p>Recursive functions (functions that call themselves) require explicit return type declarations. This is because the
type inference cannot determine the return type before analysing the function body, which contains the recursive call:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Error: recursive function &#39;factorial&#39; must have explicit return type declaration</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> factorial<span class="op">(</span><span class="cn">N</span><span class="op">:</span> <span class="va">num</span><span class="op">)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="cn">N</span> <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">then</span> <span class="cf">return</span> <span class="dv">1</span> <span class="cf">end</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="cn">N</span> <span class="op">*</span> factorial<span class="op">(</span><span class="cn">N</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Correct: explicit return type declared</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> factorial<span class="op">(</span><span class="cn">N</span><span class="op">:</span> <span class="va">num</span><span class="op">):</span> <span class="va">num</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="cn">N</span> <span class="op">&lt;=</span> <span class="dv">1</span> <span class="cf">then</span> <span class="cf">return</span> <span class="dv">1</span> <span class="cf">end</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="cn">N</span> <span class="op">*</span> factorial<span class="op">(</span><span class="cn">N</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>This requirement also applies to mutually recursive functions (function A calls function B, which calls function A).</p>
<h4 id="return-type-benefits">Return Type Benefits</h4>
<p>Declaring return types provides several advantages:</p>
<ol type="1">
<li><strong>Documentation</strong>: Return types serve as built-in documentation for function contracts</li>
<li><strong>Error detection</strong>: Type mismatches in return statements are caught at parse time</li>
<li><strong>Call-site inference</strong>: When a function has declared return types, variables assigned from calls can infer their types</li>
<li><strong>Optimisation</strong>: The compiler will generate faster code if the return types are narrower than <code>any</code>.</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> get_count<span class="op">():</span> <span class="va">num</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">42</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> get_count<span class="op">()</span>  <span class="co">-- &#39;result&#39; is automatically inferred as &#39;num&#39;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="st">&quot;text&quot;</span>       <span class="co">-- Error: cannot assign &#39;str&#39; to variable of type &#39;num&#39;</span></span></code></pre></div>
<hr>
<h2 id="variable-scoping">Variable Scoping</h2>
<p>Fluid enforces local-by-default variable scoping, a significant departure from standard Lua where undeclared variables are implicitly global. This design prevents accidental pollution of the global namespace and catches common programming errors at parse time.</p>
<h3 id="local-variables">Local Variables</h3>
<p>Variables and functions are local by default. Any assignment to an undeclared variable creates a new local in the current scope:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="va">counter</span> <span class="op">=</span> <span class="dv">0</span>              <span class="co">-- Creates local &#39;counter&#39;</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="va">name</span> <span class="op">=</span> <span class="st">&quot;Alice&quot;</span>           <span class="co">-- Creates local &#39;name&#39;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="va">bare_var</span>                 <span class="co">-- Invalid, results in an error from the parser</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span>                  <span class="co">-- Invalid: use &#39;local a, b, c&#39; or an assignment instead</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> example<span class="op">()</span>       <span class="co">-- Function is local</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>   <span class="va">total</span> <span class="op">=</span> <span class="dv">100</span>           <span class="co">-- Creates local &#39;total&#39; in function scope</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>   <span class="va">counter</span> <span class="er">+=</span> <span class="dv">1</span>          <span class="co">-- Modifies &#39;counter&#39; in the outer scope</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>The <code>local</code> keyword remains available for explicit declarations and is required when initialising multiple variables on one line:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span> <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">-- Multiple locals on one line</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">config</span>             <span class="co">-- Explicit nil initialisation</span></span></code></pre></div>
<h3 id="global-variables">Global Variables</h3>
<p>To create or access global variables, use the <code>global</code> keyword. It is recommended that global declarations appear before any reference to the variable:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="cn">DEBUG_MODE</span> <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="cn">APP_VERSION</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="kw">function</span> configure<span class="op">()</span>     <span class="co">-- Global function is accessible in the parent context</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>   <span class="cn">APP_VERSION</span> <span class="op">&lt;</span><span class="va">const</span><span class="op">&gt;</span> <span class="op">=</span> <span class="st">&quot;1.0&quot;</span>  <span class="co">-- Assigns to the global and makes it immutable</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>   <span class="va">global</span> <span class="cn">LATE_CREATION</span> <span class="op">=</span> <span class="kw">true</span>  <span class="co">-- Valid, but won&#39;t exist until this function runs</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>   <span class="va">global</span> <span class="cn">DEBUG_MODE</span> <span class="op">=</span> <span class="kw">false</span>    <span class="co">-- Modifies the original global without shadowing it</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> <span class="cn">DEBUG_MODE</span> <span class="op">=</span> <span class="kw">true</span>      <span class="co">-- Valid; this local shadows the global within this scope</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="cn">DEBUG_MODE</span><span class="op">)</span>            <span class="co">-- Prints local &#39;true&#39;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>It is recommended that global variables follow our naming conventions, which are UPPER_CASE for constants and <code>glCamelCase</code> for mutable globals. Exceptions may apply - but sticking to conventions helps with code readability.</p>
<p><strong>Global Functions:</strong></p>
<p>Declaring a function with the <code>global</code> keyword allows the parent scope to access it. This feature allows library scripts to expose functions and variables to the caller.</p>
<p><strong>Global Declaration Rules:</strong></p>
<ul>
<li><code>global</code> declarations must precede any use of the variable name</li>
<li>A local can shadow a global with the same name if explicitly marked <code>local</code></li>
<li>Global variables are accessible from nested functions without re-declaration</li>
<li>The <code>global</code> keyword can appear at any scope level, but the variable becomes globally visible</li>
</ul>
<hr>
<h2 id="result-management">Result Management</h2>
<h3 id="blank-identifier">Blank Identifier</h3>
<p>The blank identifier <code>_</code> allows you to explicitly ignore values in assignments and loop variables:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Ignore error from function call</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">,</span> <span class="cn">_</span> <span class="op">:=</span> openFile<span class="op">(</span><span class="st">&quot;data.txt&quot;</span><span class="op">)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Ignore multiple return values</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="cn">_</span><span class="op">,</span> <span class="cn">_</span><span class="op">,</span> <span class="va">result</span> <span class="op">:=</span> getValues<span class="op">()</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Loop without index</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="cn">_</span><span class="op">,</span> <span class="va">value</span> <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span><span class="va">items</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">value</span><span class="op">)</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- Works with pairs() too</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="cn">_</span><span class="op">,</span> <span class="va">v</span> <span class="kw">in</span> <span class="fu">pairs</span><span class="op">(</span><span class="va">table</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>   process<span class="op">(</span><span class="va">v</span><span class="op">)</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">-- Multiple positions</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">x</span><span class="op">,</span> <span class="cn">_</span><span class="op">,</span> <span class="va">y</span> <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">-- x=1, y=3</span></span></code></pre></div>
<p>Notes:</p>
<ul>
<li>The blank identifier does not allocate a variable or consume a register</li>
<li>Values are still consumed from the right-hand side for proper stack management</li>
<li>Can be used multiple times in the same statement</li>
<li>Cannot be read as a variable (e.g., <code>local x = _</code> is an error)</li>
</ul>
<h3 id="pipe-operator">Pipe Operator</h3>
<p>The pipe operator (<code>|&gt;</code>) provides a functional programming style for chaining function calls. It passes the result of the left-hand side expression as the first argument(s) to the right-hand side function call.</p>
<p><strong>Basic Syntax:</strong></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">expression</span> <span class="op">|&gt;</span> function_call<span class="op">()</span></span></code></pre></div>
<p>The expression on the left is evaluated first, and its result is prepended to the arguments of the function call on the right. This allows for readable left-to-right data flow instead of deeply nested function calls.</p>
<p><strong>Multi-Value Support:</strong></p>
<p>When the left-hand side returns multiple values (e.g., from a function call), all values are forwarded as arguments:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> get_bounds<span class="op">()</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">20</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">result</span> <span class="op">=</span> get_bounds<span class="op">()</span> <span class="op">|&gt;</span> <span class="fu">math.max</span><span class="op">()</span>  <span class="co">-- math.max(10, 20) = 20</span></span></code></pre></div>
<p><strong>Result Limiting:</strong></p>
<p>Use <code>|N&gt;</code> syntax to limit the number of return values forwarded from the left-hand side:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> get_many<span class="op">()</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">result</span> <span class="op">=</span> get_many<span class="op">()</span> <span class="op">|</span><span class="dv">2</span><span class="op">&gt;</span> <span class="fu">math.max</span><span class="op">()</span>  <span class="co">-- math.max(1, 2) = 2</span></span></code></pre></div>
<p><strong>Chaining:</strong></p>
<p>Pipes can be chained for multi-step transformations:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> double<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="cf">return</span> <span class="va">x</span> <span class="op">*</span> <span class="dv">2</span> <span class="kw">end</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> square<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="cf">return</span> <span class="va">x</span> <span class="op">*</span> <span class="va">x</span> <span class="kw">end</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">result</span> <span class="op">=</span> <span class="dv">3</span> <span class="op">|&gt;</span> double<span class="op">()</span> <span class="op">|&gt;</span> square<span class="op">()</span>  <span class="co">-- square(double(3)) = 36</span></span></code></pre></div>
<p><strong>Real-World Examples:</strong></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Data transformation pipeline</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> load_config<span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="op">[*</span><span class="cn">_</span><span class="op">]</span><span class="va">obj</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;file&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="va">path</span> <span class="op">=</span> <span class="va">path</span><span class="op">,</span> <span class="va">flags</span> <span class="op">=</span> <span class="st">&#39;!READ&#39;</span> <span class="op">})</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> parse_json<span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> <span class="va">content</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">*]</span><span class="va">file</span><span class="op">.</span>acRead<span class="op">()</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">json</span><span class="op">.</span>decode<span class="op">(</span><span class="va">content</span><span class="op">)</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> validate<span class="op">(</span><span class="va">config</span><span class="op">)</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">assert</span><span class="op">(</span><span class="va">config</span><span class="op">.</span><span class="va">version</span><span class="op">,</span> <span class="st">&quot;Missing version&quot;</span><span class="op">)</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">config</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">config</span> <span class="op">=</span> <span class="st">&quot;config.json&quot;</span> <span class="op">|&gt;</span> load_config<span class="op">()</span> <span class="op">|&gt;</span> parse_json<span class="op">()</span> <span class="op">|&gt;</span> validate<span class="op">()</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Processing user input with additional arguments</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">function</span> clamp<span class="op">(</span><span class="va">value</span><span class="op">,</span> <span class="va">min</span><span class="op">,</span> <span class="va">max</span><span class="op">)</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="fu">math.max</span><span class="op">(</span><span class="va">min</span><span class="op">,</span> <span class="fu">math.min</span><span class="op">(</span><span class="va">max</span><span class="op">,</span> <span class="va">value</span><span class="op">))</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">safe_value</span> <span class="op">=</span> <span class="fu">tonumber</span><span class="op">(</span>arg<span class="op">(</span><span class="st">&#39;value&#39;</span><span class="op">,</span> <span class="st">&#39;50&#39;</span><span class="op">))</span> <span class="op">|&gt;</span> clamp<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">)</span></span></code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>The right-hand side must be a function call; <code>x |&gt; 5</code> is a syntax error</li>
<li>Pipe has higher precedence than logical operators (<code>and</code>, <code>or</code>) but lower than comparison operators</li>
<li>Right-associative: <code>a |&gt; b() |&gt; c()</code> evaluates as <code>a |&gt; (b() |&gt; c())</code></li>
<li>For method calls, use full syntax: <code>obj |&gt; obj:method()</code> (not <code>obj |&gt; method()</code>)</li>
</ul>
<h4 id="pipe-iteration-with-ranges">Pipe Iteration with Ranges</h4>
<p>When the left-hand side of a pipe is a range literal, the pipe automatically iterates, calling the right-hand function for each value:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span><span class="dv">1..5</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="fu">print</span>           <span class="co">-- Prints 1, 2, 3, 4</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span><span class="dv">1.</span><span class="op">.</span><span class="dv">.5</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="fu">print</span>          <span class="co">-- Prints 1, 2, 3, 4, 5</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- With anonymous function</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span><span class="dv">0..10</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">i</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span> <span class="cf">then</span> <span class="fu">print</span><span class="op">(</span><span class="va">i</span><span class="op">,</span> <span class="st">&#39;is even&#39;</span><span class="op">)</span> <span class="cf">end</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>The pipe returns the original range, enabling chaining:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span><span class="dv">1..10</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="va">i</span> <span class="op">=&gt;</span> log<span class="op">(</span><span class="st">&#39;Processing&#39;</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> <span class="va">i</span> <span class="op">=&gt;</span> validate<span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> <span class="va">i</span> <span class="op">=&gt;</span> store<span class="op">(</span><span class="va">i</span><span class="op">)</span></span></code></pre></div>
<p>Return <code>false</code> from the callback to terminate early:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span><span class="dv">1..1000</span><span class="op">}</span> <span class="op">|&gt;</span> <span class="va">i</span> <span class="op">=&gt;</span> <span class="cf">do</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> found_target<span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="cf">then</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Found at&#39;</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span>  <span class="co">-- Stop iterating</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Pipe Iteration Notes:</strong></p>
<ul>
<li>Only range literals (<code>{start..stop}</code>) trigger automatic iteration at parse time</li>
<li>For ranges stored in variables, use the <code>:each()</code> method directly: <code>r:each(func)</code></li>
<li>Chained pipes continue iteration: <code>{1..5} |&gt; func1 |&gt; func2</code> calls both functions for each value</li>
</ul>
<h3 id="result-filter-operator">Result Filter Operator</h3>
<p>The result filter operator (<code>[mask]</code>) provides selective extraction of return values from multi-value function calls. It uses a prefix bracket syntax with a mask of <code>_</code> (drop) and <code>*</code> (keep) characters to specify which values to retain.</p>
<p><strong>Basic Syntax:</strong></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="op">[</span><span class="va">mask</span><span class="op">]</span>function_call<span class="op">()</span></span></code></pre></div>
<p>The mask is placed inside square brackets immediately before a function call. Each character in the mask corresponds to a return value position:</p>
<ul>
<li><code>_</code> drops the value at that position</li>
<li><code>*</code> keeps the value at that position</li>
<li>The last character determines the behaviour for any excess values beyond those explicitly specified</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> multi<span class="op">()</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Keep all values (default behaviour)</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span><span class="op">,</span> <span class="va">d</span><span class="op">,</span> <span class="va">e</span> <span class="op">=</span> <span class="op">[*]</span>multi<span class="op">()</span>      <span class="co">-- a=1, b=2, c=3, d=4, e=5</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Drop first value, keep the rest</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span><span class="op">,</span> <span class="va">d</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">*]</span>multi<span class="op">()</span>        <span class="co">-- a=2, b=3, c=4, d=5</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Drop first two values, keep the rest</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span> <span class="op">=</span> <span class="op">[</span><span class="cn">__</span><span class="op">*]</span>multi<span class="op">()</span>          <span class="co">-- a=3, b=4, c=5</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Keep first value only, drop all others</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span> <span class="op">=</span> <span class="op">[*</span><span class="cn">_</span><span class="op">]</span>multi<span class="op">()</span>              <span class="co">-- a=1, b=nil</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="co">-- Drop first, keep second, drop the rest</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">*</span><span class="cn">_</span><span class="op">]</span>multi<span class="op">()</span>             <span class="co">-- a=2, b=nil</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="co">-- Keep values at positions 2, 3, 4 only</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span><span class="op">,</span> <span class="va">d</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">***</span><span class="cn">_</span><span class="op">]</span>multi<span class="op">()</span>     <span class="co">-- a=2, b=3, c=4, d=nil</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="co">-- Keep second and fourth values onwards</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">*</span><span class="cn">_</span><span class="op">*]</span>multi<span class="op">()</span>         <span class="co">-- a=2, b=4, c=5</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="co">-- Empty filter drops all values</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">x</span> <span class="op">=</span> <span class="op">[]</span>multi<span class="op">()</span>                   <span class="co">-- x=nil</span></span></code></pre></div>
<p><strong>With Method Calls:</strong></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="va">obj</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">method</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span><span class="op">)</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="va">second</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">*]</span><span class="va">obj</span><span class="op">:</span>method<span class="op">()</span>       <span class="co">-- second=20</span></span></code></pre></div>
<p><strong>Use Cases:</strong></p>
<p>The result filter is particularly useful when:</p>
<ul>
<li>A function returns an error code as the first value that you want to ignore</li>
<li>You only need specific return values from a multi-value function</li>
<li>You want to skip metadata or status values and get directly to the data</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Skip error code, get file content directly</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="va">content</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">*]</span><span class="va">file</span><span class="op">.</span>acRead<span class="op">()</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get only the second and third return values</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">b</span><span class="op">,</span> <span class="va">c</span> <span class="op">=</span> <span class="op">[</span><span class="cn">_</span><span class="op">**</span><span class="cn">_</span><span class="op">]</span>get_stats<span class="op">()</span></span></code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>The mask must be followed by a function call; <code>[_*]variable</code> is a syntax error</li>
<li>Maximum mask length is 64 positions</li>
</ul>
<hr>
<h2 id="exception-handling">Exception Handling</h2>
<p>Fluid supports an exception handling mechanism that recognises that errors can come in one of two forms:</p>
<ul>
<li>Internal errors, as generated by the Fluid language and the runtime engine.</li>
<li>External errors, as generated by system API calls.</li>
</ul>
<p>In normal operation, these distinct patterns are handled differently, with external errors requiring manual handling. We designed the exception handling system to resolve this problem by unifying all error forms, providing a simple syntax for error management, and supporting exception handlers to deal with errors when they arise.</p>
<h3 id="try-except-statement">Try-Except Statement</h3>
<p>Structured exception handling is provided through the <code>try-except</code> syntax, and is the primary means offered for exception management.</p>
<p><strong>Features:</strong></p>
<ul>
<li>Lazy syntax is permitted.</li>
<li>Try blocks can be nested, with each level catching its own exceptions.</li>
<li>Multiple except handlers with their own filters for both system and user error codes.</li>
<li>Support for control flow statements (<code>return</code>, <code>break</code>, <code>continue</code>) within try blocks.</li>
<li>Optional stack trace capture for debugging.</li>
<li>Very fast performance compared to the Lua <code>pcall</code> approach, especially when JIT compiled.</li>
</ul>
<p><strong>Basic Syntax:</strong></p>
<div class="sourceCode" id="cb58"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>   risky_operation<span class="op">()</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> <span class="va">except</span> <span class="op">[</span><span class="va">e</span><span class="op">]</span> <span class="op">[</span> <span class="va">when</span> <span class="va">Exception</span><span class="op">,</span> <span class="op">...</span> <span class="op">]</span> <span class="op">]</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Error: &quot;</span> <span class="op">..</span> <span class="va">e</span><span class="op">.</span><span class="va">message</span><span class="op">)</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> <span class="va">except</span><span class="op">...</span> <span class="op">]</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> <span class="va">success</span> <span class="op">]</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The <code>except</code> blocks catch exceptions raised within the preceding <code>try</code> block. Multiple <code>except</code> handlers are permitted, each with their own optional filter using the <code>when</code> clause. An unfiltered handler is recommended at the end to catch unexpected errors. The exception parameter <code>e</code> (or any name of your choosing) is a table containing information about the error:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>code</code></td>
<td>The <code>ERR</code> code, e.g. <code>ERR_Failed</code>. <code>ERR_Exception</code> is the default for Lua errors.</td>
</tr>
<tr>
<td><code>message</code></td>
<td>Human-readable error description.</td>
</tr>
<tr>
<td><code>line</code></td>
<td>Line number where the error occurred.</td>
</tr>
<tr>
<td><code>trace</code></td>
<td>Native array of stack frames (only with <code>try&lt;trace&gt;</code> enabled).</td>
</tr>
<tr>
<td><code>stackTrace</code></td>
<td>Formatted traceback string (only with <code>try&lt;trace&gt;</code> enabled).</td>
</tr>
</tbody>
</table>
<p>The <code>success</code> block is optional and runs if no exception occurred in the <code>try</code> block. It runs only when all resources in the <code>try</code> block have been cleaned up.</p>
<p>There is no support for <code>finally</code> blocks; the standard pattern is to use <code>defer</code> statements or <code>__close</code> within the <code>try</code> block for cleanup actions instead.</p>
<p><strong>Exception Handling:</strong></p>
<p>Exceptions come in two flavours: Error codes (16-bit integer constants) and string messages.</p>
<ul>
<li>Error messages originate from <code>error()</code> or Fluid runtime errors. They have a default error code of <code>ERR_Exception</code>.</li>
<li>Error codes are returned by API calls and can be triggered by calling <code>raise</code> and <code>check</code>. Preset error codes are integer constants following the <code>ERR_</code> naming convention, e.g. <code>ERR_Okay</code>, <code>ERR_Failed</code> and <code>ERR_Args</code>. The full list of error codes are listed in the Parasol Appendix.</li>
</ul>
<p>A key benefit to the use of error codes is that they can be filtered in exception handlers, allowing for specific handling of known error conditions. For example:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">error</span><span class="op">(</span><span class="st">&quot;Lua error&quot;</span><span class="op">)</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">assert</span><span class="op">(</span><span class="va">e</span><span class="op">.</span><span class="va">code</span> <span class="va">is</span> <span class="va">ERR_Exception</span><span class="op">)</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="va">success</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;No error occurred&quot;</span><span class="op">)</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>   <span class="va">raise</span> <span class="va">ERR_Failed</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span> <span class="va">when</span> <span class="va">ERR_Failed</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Caught ERR_Failed&#39;</span><span class="op">)</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Lazy Exception Syntax:</strong></p>
<p>Suppressing exceptions is permitted with the simplest form of syntax:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>   potentially_failing_operation<span class="op">()</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Simple catch-alls are also possible:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>   risky_operation<span class="op">()</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="va">except</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;An error occurred&quot;</span><span class="op">)</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Re-throwing Exceptions:</strong></p>
<p>Call <code>error()</code> within an except block to propagate the exception to an outer handler:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">try</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">error</span><span class="op">(</span><span class="st">&quot;Original error&quot;</span><span class="op">)</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>   <span class="va">except</span> <span class="va">e</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>      <span class="co">-- Log and re-throw</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>      msg<span class="op">(</span><span class="va">e</span><span class="op">.</span><span class="va">message</span><span class="op">)</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">error</span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Catches the re-thrown exception</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Caught re-thrown error&quot;</span><span class="op">)</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Filtered Exception Handling:</strong></p>
<p>Use the <code>when</code> clause to catch specific <code>ERR</code> codes. Multiple codes are permitted per <code>when</code> clause, up to a limit of 4 per handler.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">raise</span> <span class="va">ERR_Args</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span> <span class="va">when</span> <span class="va">ERR_Args</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Invalid arguments&quot;</span><span class="op">)</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span> <span class="va">when</span> <span class="va">ERR_Read</span><span class="op">,</span> <span class="va">ERR_Write</span><span class="op">,</span> <span class="va">ERR_Seek</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Operation failed&quot;</span><span class="op">)</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Unexpected error: &quot;</span> <span class="op">..</span> <span class="va">e</span><span class="op">.</span><span class="va">message</span><span class="op">)</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Error codes are just constant integers, so custom codes can also be created and thrown through use of the <code>raise</code> function. To prevent namespace pollution, use codes in the range 8000 to 10000 for client code.</p>
<p><strong>Filter Ordering Rules:</strong></p>
<ul>
<li>Filtered handlers must appear before the catch-all handler</li>
<li>Multiple filtered handlers are checked in order; the first match wins</li>
<li>If no filter matches <em>and</em> no catch-all exists, the exception propagates</li>
</ul>
<div class="sourceCode" id="cb64"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Valid: filters before catch-all</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">raise</span> <span class="va">ERR_Failed</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span> <span class="va">when</span> <span class="va">ERR_Args</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- First filter</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span> <span class="va">when</span> <span class="va">ERR_Failed</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Second filter (matches)</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Catch-all (must be last)</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- Invalid: catch-all before filter (parse error)</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- try ... except e ... except e when ERR_Failed ... end</span></span></code></pre></div>
<p><strong>Control Flow in Try Blocks:</strong></p>
<p><code>return</code>, <code>break</code>, and <code>continue</code> work correctly within try blocks:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> find_value<span class="op">()</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">try</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>      <span class="va">result</span> <span class="op">=</span> search<span class="op">()</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="va">result</span>  <span class="co">-- Returns from function normally</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>   <span class="va">except</span> <span class="va">e</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">nil</span>     <span class="co">-- Returns nil on error</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">0..10</span><span class="op">}</span> <span class="cf">do</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>   <span class="va">try</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="va">i</span> <span class="va">is</span> <span class="dv">5</span> <span class="cf">then</span> <span class="cf">break</span> <span class="cf">end</span>      <span class="co">-- Exits loop</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="va">i</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span> <span class="cf">then</span> <span class="va">continue</span> <span class="cf">end</span>  <span class="co">-- Skips to next iteration</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>      process<span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>   <span class="va">except</span> <span class="va">e</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">-- Handle error and continue loop</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Stack Traces:</strong></p>
<p>By default, stack trace information is not captured for performance reasons. Use the <code>&lt;trace&gt;</code> attribute to enable stack trace capture when an exception occurs:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="va">try</span><span class="op">&lt;</span><span class="va">trace</span><span class="op">&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>   risky_operation<span class="op">()</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>   <span class="va">try</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">error</span><span class="op">(</span><span class="st">&quot;Inner error&quot;</span><span class="op">)</span>  <span class="co">-- No trace captured, missing &lt;trace&gt; from prior try statement</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>   <span class="va">except</span> <span class="va">e</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">assert</span><span class="op">(</span><span class="va">e</span><span class="op">.</span><span class="va">trace</span> <span class="va">is</span> <span class="kw">nil</span><span class="op">)</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">error</span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">e</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">e</span><span class="op">.</span><span class="va">stackTrace</span><span class="op">)</span>  <span class="co">-- Formatted traceback string</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Or access individual frames</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="va">i</span><span class="op">,</span> <span class="va">frame</span> <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span><span class="va">e</span><span class="op">.</span><span class="va">trace</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;{frame.source}:{frame.line}: in {frame.func ?? &#39;anonymous&#39;}&quot;</span><span class="op">)</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The <code>trace</code> field contains an array of frame tables, each with the following fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>source</code></td>
<td>Source file name (may be <code>nil</code>).</td>
</tr>
<tr>
<td><code>line</code></td>
<td>Line number (0 if unknown).</td>
</tr>
<tr>
<td><code>func</code></td>
<td>Function name (may be <code>nil</code> for anonymous functions).</td>
</tr>
</tbody>
</table>
<p>The <code>stackTrace</code> field provides a pre-formatted string in the standard &quot;stack traceback:&quot; format, suitable for logging or display.</p>
<h3 id="raising-exceptions">Raising Exceptions</h3>
<p>Exceptions can be raised at runtime by using the following features:</p>
<h4 id="assert">assert()</h4>
<p><code>assert()</code> is used to validate conditions and raise exceptions when the condition is false. It accepts two parameters - the first being the condition to evaluate, and the second an optional error message to include in the exception. Example:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">,</span> <span class="st">&#39;x must be greater than zero&#39;</span><span class="op">)</span></span></code></pre></div>
<p>The message parameter is not evaluated if the condition was true. This allows expensive computations (e.g. long string concatenation) to be written without incurring overhead during normal runtime operations.</p>
<h4 id="check-and-raise">check and raise</h4>
<p><code>check</code> is the equivalent of an <code>assert()</code> for <code>ERR</code> codes. Any non-safe error code passed to this function will raise an exception that includes a readable message matching the <code>ERR</code> code.</p>
<p>Incoming parameters are returned without modification, allowing <code>check</code> to operate seamlessly in function call chains. Example:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="va">err</span><span class="op">,</span> <span class="va">bytes_read</span> <span class="op">=</span> <span class="va">check</span> <span class="va">file</span><span class="op">.</span>acRead<span class="op">(</span><span class="va">file</span><span class="op">,</span> <span class="va">buffer</span><span class="op">)</span></span></code></pre></div>
<p>The following <code>ERR</code> codes will not raise an exception: <code>Okay</code>, <code>False</code>, <code>LimitedSuccess</code>, <code>Cancelled</code>, <code>NothingDone</code>, <code>Continue</code>, <code>Skip</code>, <code>Retry</code>, <code>DirEmpty</code></p>
<p><code>raise</code> will raise an exception immediately from an <code>ERR</code> code; for example <code>raise ERR_Failed</code>. Unlike <code>check</code>, all codes have coverage, including minor codes. The error code will also be propagated to the Script object&#39;s <code>Error</code> field for reporting back to the C/C++ client program.</p>
<p>Raise also accepts an optional second parameter for a custom error message, e.g. <code>raise ERR_Failed, &#39;Operation failed due to X&#39;</code>.</p>
<p>The raise and check keywords will work for custom error codes defined by the client, the only requirement is that they are integer constants. Use codes in the range 8000 to 10000 to avoid conflicts with Parasol system codes.</p>
<h4 id="error">error()</h4>
<p><code>error()</code> is the standard function for raising customised exceptions with the generic error code <code>ERR_Exception</code>. It should be used when raising an exception with a custom error message, e.g. <code>error(&#39;I have failed.&#39;)</code>.</p>
<p>Passing an exception table to <code>error()</code> causes it to rethrow the exception to the next capture block.</p>
<hr>
<h2 id="deference">Deference</h2>
<h3 id="defer-statement">Defer Statement</h3>
<p>The <code>defer</code> statement schedules a function to execute when the enclosing scope exits. Deferred functions execute in LIFO order (last deferred, first executed) and are guaranteed to run on normal scope exit, early <code>return</code>, <code>break</code>, or <code>continue</code>.</p>
<p><strong>Basic syntax (no arguments):</strong></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> example<span class="op">()</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">file</span> <span class="op">=</span> <span class="fu">io.open</span><span class="op">(</span><span class="st">&quot;data.txt&quot;</span><span class="op">)</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">defer</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>      <span class="va">file</span><span class="op">:</span><span class="fu">close</span><span class="op">()</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- ... use file ...</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span>  <span class="co">-- file:close() executes here</span></span></code></pre></div>
<p><strong>With argument snapshot:</strong></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> example<span class="op">()</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">status</span> <span class="op">=</span> <span class="st">&quot;initial&quot;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>   defer<span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Final status: &quot;</span> <span class="op">..</span> <span class="va">s</span><span class="op">)</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span><span class="op">(</span><span class="va">status</span><span class="op">)</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>   <span class="va">status</span> <span class="op">=</span> <span class="st">&quot;modified&quot;</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span>  <span class="co">-- prints &quot;Final status: initial&quot;</span></span></code></pre></div>
<p><strong>Multiple defers execute in reverse order:</strong></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="va">defer</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;third&quot;</span><span class="op">)</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="va">defer</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;second&quot;</span><span class="op">)</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="va">defer</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;first&quot;</span><span class="op">)</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- Output: &quot;first&quot;, &quot;second&quot;, &quot;third&quot;</span></span></code></pre></div>
<p><strong>Execution guarantees:</strong></p>
<ul>
<li>Defers execute when leaving scope via normal flow, <code>return</code>, <code>break</code>, or <code>continue</code></li>
<li>Deferred functions capture upvalues from the enclosing scope</li>
<li>Arguments passed via <code>end(...)</code> are snapshotted at registration time</li>
<li>Multiple defers in the same scope execute in LIFO order (last registered executes first)</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li>Error path execution during stack unwinding is not currently supported</li>
<li>Errors in deferred functions propagate normally</li>
</ul>
<h3 id="deferred-expressions">Deferred Expressions</h3>
<p>Deferred expressions provide lazy evaluation of expressions, delaying computation until the value is actually accessed. This is particularly useful for avoiding expensive computations in conditional parameters or logging statements that may not be executed.</p>
<p><strong>Basic syntax:</strong></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="fu">type</span><span class="op">{</span> <span class="va">expression</span> <span class="op">}&gt;</span> <span class="kw">or</span> <span class="op">&lt;{</span> <span class="va">expression</span> <span class="op">}&gt;</span></span></code></pre></div>
<p>The expression inside <code>&lt;{ }&gt;</code> is not evaluated immediately. Instead, evaluation is deferred until the value is accessed through standard API functions or explicitly resolved.</p>
<p>Consider this common pattern:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>some_function<span class="op">(</span><span class="va">conditional_value</span><span class="op">,</span> <span class="st">&quot;Error occurred: &quot;</span> <span class="op">..</span> expensive_debug_info<span class="op">())</span></span></code></pre></div>
<p>The string concatenation and <code>expensive_debug_info()</code> are processed immediately irrespective of whether <code>some_function()</code> will use the computed variable. With deferred expressions:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>some_function<span class="op">(</span><span class="va">conditional_value</span><span class="op">,</span> <span class="op">&lt;{</span> <span class="st">&quot;Error occurred: &quot;</span> <span class="op">..</span> expensive_debug_info<span class="op">()</span> <span class="op">}&gt;)</span></span></code></pre></div>
<p>The expensive computation only occurs if the assertion fails and the message is accessed.</p>
<p><strong>Type Inference:</strong></p>
<p>Fluid automatically infers types from deferred expressions:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="va">str</span> <span class="op">=</span> <span class="op">&lt;{</span> <span class="st">&#39;hello&#39;</span> <span class="op">}&gt;</span>        <span class="co">-- Inferred as string</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="va">num</span> <span class="op">=</span> <span class="op">&lt;{</span> <span class="dv">42</span> <span class="op">}&gt;</span>             <span class="co">-- Inferred as number</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="va">bool</span> <span class="op">=</span> <span class="op">&lt;{</span> <span class="kw">true</span> <span class="op">}&gt;</span>          <span class="co">-- Inferred as boolean</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="va">tbl</span> <span class="op">=</span> <span class="op">&lt;{</span> <span class="op">{}</span> <span class="op">}&gt;</span>             <span class="co">-- Inferred as table</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="op">&lt;{</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span> <span class="op">}&gt;</span>       <span class="co">-- Inferred as number (arithmetic)</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="va">msg</span> <span class="op">=</span> <span class="op">&lt;{</span> <span class="va">s</span> <span class="op">..</span> <span class="va">t</span> <span class="op">}&gt;</span>         <span class="co">-- Inferred as string (concatenation)</span></span></code></pre></div>
<p><strong>Explicit Type Annotation:</strong></p>
<p>When type cannot be inferred (such as function calls), use explicit type annotation:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>str<span class="op">{</span> getValue<span class="op">()</span> <span class="op">}&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>num<span class="op">{</span> compute<span class="op">()</span> <span class="op">}&gt;</span></span></code></pre></div>
<p><strong>The <code>resolve()</code> Function:</strong></p>
<p>Use <code>resolve()</code> to explicitly evaluate a deferred expression:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="va">lazy</span> <span class="op">=</span> <span class="op">&lt;{</span> expensive_computation<span class="op">()</span> <span class="op">}&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- Later, when you need the value:</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="va">value</span> <span class="op">=</span> resolve<span class="op">(</span><span class="va">lazy</span><span class="op">)</span></span></code></pre></div>
<p>The <code>resolve()</code> function returns non-deferred values unchanged, making it safe to call on any value.</p>
<p><strong>Single Evaluation:</strong></p>
<p>Once evaluated, the result is cached in the variable. Subsequent access returns the cached value without re-evaluation:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="va">count</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="va">x</span> <span class="op">=</span> <span class="op">&lt;{</span> <span class="va">count</span><span class="er">++</span><span class="op">;</span> <span class="va">count</span> <span class="op">}&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>resolve<span class="op">(</span><span class="va">x</span><span class="op">))</span>  <span class="co">-- Prints 1, increments count and caches result back in x</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>resolve<span class="op">(</span><span class="va">x</span><span class="op">))</span>  <span class="co">-- Prints 1 again, uses cached result</span></span></code></pre></div>
<p>Single-evaluation is a super-power for deferred expressions if used correctly, and offers creative programming opportunities. For instance:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="va">glSelf</span> <span class="op">=</span> <span class="op">&lt;</span>obj<span class="op">{</span> <span class="va">obj</span><span class="op">.</span>find<span class="op">(</span><span class="st">&#39;self&#39;</span><span class="op">)</span> <span class="op">}&gt;</span> <span class="co">-- Executes once, does nothing if never used.</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="va">activate_object</span> <span class="op">=</span> <span class="op">&lt;</span>num<span class="op">{</span> <span class="va">object</span><span class="op">.</span>acActivate<span class="op">()</span> <span class="op">}&gt;</span>  <span class="co">-- On resolution stores the ERR code permanently</span></span></code></pre></div>
<p><strong>Important Notes:</strong></p>
<ul>
<li>Calling <code>type()</code> on a deferred expression will return the type associated with the expression without evaluating it.</li>
<li>They capture upvalues from the enclosing scope</li>
<li>Error handling works naturally - errors during evaluation propagate normally</li>
<li>Deferred expressions can be nested, stored in tables, and passed as arguments</li>
<li>The type annotation or inference is required for correct behaviour with type-checking code</li>
</ul>
<h3 id="thunks">Thunks</h3>
<p>Thunk functions extend deferred expressions to support parameterised lazy evaluation. While deferred expressions wrap a single expression, thunk functions allow you to define reusable lazy computations with parameters.</p>
<p><strong>Syntax:</strong></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="va">thunk</span> name<span class="op">(</span><span class="va">params</span><span class="op">):</span><span class="fu">type</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- body</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">value</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The <code>thunk</code> keyword declares a function that, when called, is primed by capturing its arguments and returns a deferred value. The body is not executed until the result is accessed through a read operation or explicitly resolved.</p>
<p><strong>Example - Lazy Database Query:</strong></p>
<div class="sourceCode" id="cb81"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="va">thunk</span> fetch_user<span class="op">(</span><span class="va">id</span><span class="op">:</span><span class="va">num</span><span class="op">):</span><span class="va">table</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Fetching user &quot;</span> <span class="op">..</span> <span class="va">id</span><span class="op">)</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">database</span><span class="op">.</span>query<span class="op">(</span><span class="st">&quot;SELECT * FROM users WHERE id = ?&quot;</span><span class="op">,</span> <span class="va">id</span><span class="op">)</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="va">user</span> <span class="op">=</span> fetch_user<span class="op">(</span><span class="dv">123</span><span class="op">)</span>  <span class="co">-- Function primed in user and not executed yet</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">user</span><span class="op">.</span><span class="va">name</span><span class="op">)</span>        <span class="co">-- Query executes here, prints &quot;Fetching user 123&quot;</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">user</span><span class="op">.</span><span class="va">email</span><span class="op">)</span>       <span class="co">-- Uses cached result, no re-query</span></span></code></pre></div>
<p><strong>Example - Conditional Computation:</strong></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="va">thunk</span> expensive_report<span class="op">(</span><span class="va">year</span><span class="op">:</span><span class="va">num</span><span class="op">):</span><span class="va">str</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> generate_annual_report<span class="op">(</span><span class="va">year</span><span class="op">)</span>  <span class="co">-- Only runs if report is actually used</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="va">report</span> <span class="op">=</span> expensive_report<span class="op">(</span><span class="dv">2024</span><span class="op">)</span> <span class="co">-- Store reference to thunk with 2024 parameter value</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">user_requested_report</span> <span class="cf">then</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">report</span><span class="op">)</span>  <span class="co">-- Report generated only when needed</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Anonymous Thunks:</strong></p>
<p>Anonymous thunks can skip the invocation process if they are parameterless:</p>
<pre><code>local isAvailable = thunk():bool -- Prepare isAvailable without executing the body
   -- Do something --
   return true
end

print(isAvailable) -- Resolved and cached here, no need to prime with isAvailable()</code></pre>
<p>If one or more parameters are specified in the thunk signature then this feature does not apply.</p>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li>Parameters are captured at call time, not resolution time.</li>
<li>The body executes once on first access; the result is cached.</li>
<li><code>type()</code> returns the declared type without executing the body.</li>
<li>Use <code>resolve()</code> for explicit evaluation.</li>
<li>Thunks resolve automatically when used in operations, comparisons, or passed to API functions.</li>
</ul>
<hr>
<h2 id="equality-operators">Equality Operators</h2>
<h3 id="if-empty-logical-operator">If-Empty Logical Operator</h3>
<p>Fluid adds a <code>??</code> operator that extends the falsey semantics of the <code>or</code> operator. The <code>??</code> operator treats the following values as falsey: <code>nil</code>, <code>false</code>, <code>0</code>, and <code>&quot;&quot;</code> (empty string). This feature was introduced so that it would be easier to write shorthand for dealing with values that are empty. In addition, the right-hand side is not evaluated if the left-hand is true, leading to faster code.</p>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Standard &#39;or&#39; vs &#39;??&#39; with zero</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="va">a</span> <span class="op">=</span> <span class="dv">0</span> <span class="kw">or</span> <span class="st">&quot;default&quot;</span>      <span class="co">-- a is 0 (zero is truthy by default)</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="va">b</span> <span class="op">=</span> <span class="dv">0</span> ?? <span class="st">&quot;default&quot;</span>      <span class="co">-- b is &quot;default&quot; (zero is falsey in ??)</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Standard &#39;or&#39; vs &#39;??&#39; with empty string</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="va">c</span> <span class="op">=</span> <span class="st">&quot;&quot;</span> <span class="kw">or</span> <span class="st">&quot;fallback&quot;</span>     <span class="co">-- c is &quot;&quot; (empty string is truthy by default)</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="va">d</span> <span class="op">=</span> <span class="st">&quot;&quot;</span> ?? <span class="st">&quot;fallback&quot;</span>     <span class="co">-- d is &quot;fallback&quot; (empty string is falsey in ??)</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Chaining</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="va">value</span> <span class="op">=</span> <span class="st">&quot;&quot;</span> ?? <span class="dv">0</span> ?? <span class="st">&quot;final&quot;</span>  <span class="co">-- value is &quot;final&quot; (both &quot;&quot; and 0 are falsey)</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- Short-circuit evaluation</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> expensive<span class="op">()</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">error</span><span class="op">(</span><span class="st">&quot;Should not be called&quot;</span><span class="op">)</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="st">&quot;valid&quot;</span> ?? expensive<span class="op">()</span>  <span class="co">-- result is &quot;valid&quot;, expensive() is never called</span></span></code></pre></div>
<p><strong>If-Empty Conditional Shorthand</strong></p>
<p>The <code>??</code> operator can be used as a conditional operator for routines and control flow. For instance <code>if not value then error() end</code> can now be written as simply as:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="va">value</span> ?? <span class="fu">error</span><span class="op">(</span><span class="st">&#39;Value is empty&#39;</span><span class="op">)</span></span></code></pre></div>
<p>It also works as a guard for controlling program flow with <code>return</code>, <code>break</code> and <code>continue</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="va">user_input</span> ?? <span class="cf">return</span> <span class="va">ERR_InvalidInput</span></span></code></pre></div>
<p><strong>Notes</strong></p>
<ul>
<li>Standard <code>or</code> treats only <code>nil</code> and <code>false</code> as falsey. Values like <code>0</code> and <code>&quot;&quot;</code> are considered truthy.</li>
<li>The <code>??</code> operator treats <code>0</code> and <code>&quot;&quot;</code> as falsey.</li>
<li>The <code>??</code> operator has the same precedence as <code>or</code> and <code>and</code> (lowest priority).</li>
<li>It is left-associative, like <code>or</code> and <code>and</code>.</li>
<li>Line splits immediately following <code>??</code> are intentionally forbidden.</li>
</ul>
<h3 id="if-empty-postfix-operator">If-Empty Postfix Operator</h3>
<p>If the <code>??</code> operator is used in the absence of a value to its right-hand-side, it is treated as a postfix operator. In this mode it will return a boolean indicating whether a value is present, using extended falsey semantics. It returns <code>false</code> for <code>nil</code>, <code>false</code>, <code>0</code>, and <code>&quot;&quot;</code> (empty string), and <code>true</code> for all other values.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Basic usage</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">comment</span>?? <span class="cf">then</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Comment exists&quot;</span><span class="op">)</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- In expressions</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="va">greeting</span> <span class="op">=</span> <span class="va">name</span>?? <span class="kw">and</span> <span class="st">&quot;Hello, &quot;</span> <span class="op">..</span> <span class="va">name</span> <span class="kw">or</span> <span class="st">&quot;Hello, Guest&quot;</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- With field access and expressions</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">config</span><span class="op">.</span><span class="va">timeout</span>?? <span class="cf">then</span> <span class="op">...</span> <span class="cf">end</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span><span class="op">)</span>?? <span class="cf">then</span> <span class="op">...</span> <span class="cf">end</span></span></code></pre></div>
<p>As a postfix operator, <code>??</code> has high precedence and evaluates before logical operators.</p>
<h3 id="ternary-operator">Ternary Operator</h3>
<p>The use of a single <code>?</code> can be complemented with a C-style ternary conditional operator <code>:&gt;</code> that creates an expression equivalent to an if-then-else statement.</p>
<p><code>result = condition ? true_expr :&gt; false_expr</code></p>
<p>The full ternary evaluates <code>condition</code> using falsey semantics. If truthy, it returns <code>true_expr</code>; if falsey, it returns <code>false_expr</code>. Only one branch is evaluated to ensure run-time efficiency.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="va">status</span> <span class="op">=</span> <span class="va">user</span> ? <span class="st">&quot;logged in&quot;</span> <span class="op">:&gt;</span> <span class="st">&quot;guest&quot;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="va">max</span> <span class="op">=</span> <span class="va">a</span> <span class="op">&gt;</span> <span class="va">b</span> ? <span class="va">a</span> <span class="op">:&gt;</span> <span class="va">b</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="va">msg</span> <span class="op">=</span> <span class="fu">error</span> ? <span class="st">&quot;Error: &quot;</span> <span class="op">..</span> <span class="fu">error</span> <span class="op">:&gt;</span> <span class="st">&quot;Success&quot;</span></span></code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>Short-circuit evaluation: only the selected branch is evaluated</li>
<li>Precedence: same as <code>or</code>, <code>and</code>, <code>?</code> (lowest priority)</li>
<li>Right-associative: <code>a ? b :&gt; c ? d :&gt; e</code> parses as <code>a ? b :&gt; (c ? d :&gt; e)</code></li>
<li>Use parentheses in expression lists: <code>local a, b = (cond ? x :&gt; y), z</code></li>
</ul>
<hr>
<h2 id="ranges">Ranges</h2>
<p>Fluid provides a dedicated <code>range</code> type, implemented as userdata, for expressing numeric intervals. Ranges are
primarily used for iteration, slicing and membership tests, and integrate with the language via both constructor
functions and literal syntax.</p>
<p>Ranges are immutable. Once created, a range&#39;s <code>start</code>, <code>stop</code>, <code>step</code> and <code>inclusive</code> properties cannot be modified.</p>
<h3 id="range-constructor">Range Constructor</h3>
<p>The <code>range()</code> constructor function creates a range object:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="va">r1</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">)</span>                <span class="co">-- Exclusive: 0,1,2,3,4</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="va">r2</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="kw">true</span><span class="op">)</span>          <span class="co">-- Inclusive: 0,1,2,3,4,5</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="va">r3</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span>     <span class="co">-- Exclusive with step: 0,2,4,6,8</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="va">r4</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span>               <span class="co">-- Reverse: 10,9,8,...,1 (step inferred as -1)</span></span></code></pre></div>
<p>Constructor parameters:</p>
<ul>
<li><code>range(Start, Stop)</code>
<ul>
<li>Creates an exclusive range from <code>Start</code> up to, but not including, <code>Stop</code>.</li>
</ul></li>
<li><code>range(Start, Stop, Inclusive)</code>
<ul>
<li>When <code>Inclusive</code> is <code>true</code>, the <code>Stop</code> value is included.</li>
</ul></li>
<li><code>range(Start, Stop, Inclusive, Step)</code>
<ul>
<li>Explicit step value (positive or negative). <code>Step</code> must be a non‑zero integer.</li>
</ul></li>
</ul>
<p>All arguments must be integers (or integer‑valued numbers). Passing non‑integer or <code>nil</code> values will raise an error.</p>
<p>Range properties and helpers:</p>
<ul>
<li><code>r.start</code> / <code>r.stop</code> / <code>r.step</code> / <code>r.inclusive</code> — access range parameters.</li>
<li><code>#r</code> or <code>r.length</code> — number of elements in the range.</li>
<li><code>range.check(Value)</code> — returns <code>true</code> when <code>Value</code> is a range; <code>false</code> otherwise.</li>
</ul>
<p>Ranges report their type as userdata:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="fu">type</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> is <span class="st">&quot;userdata&quot;</span><span class="op">)</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="va">range</span><span class="op">.</span>check<span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="va">is</span> <span class="kw">true</span><span class="op">)</span></span></code></pre></div>
<h3 id="range-literals">Range Literals</h3>
<p>Fluid adds literal syntax for constructing ranges using braces and dot notation:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="va">r1</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0..5</span><span class="op">}</span>          <span class="co">-- Exclusive: 0,1,2,3,4</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="va">r2</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0.</span><span class="op">.</span><span class="dv">.5</span><span class="op">}</span>         <span class="co">-- Inclusive: 0,1,2,3,4,5</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="va">r3</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10..1</span><span class="op">}</span>         <span class="co">-- Reverse exclusive: 10,9,8,...,2</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="va">r4</span> <span class="op">=</span> <span class="op">{</span><span class="dv">5.</span><span class="op">.</span><span class="dv">.1</span><span class="op">}</span>         <span class="co">-- Reverse inclusive: 5,4,3,2,1</span></span></code></pre></div>
<p>Rules:</p>
<ul>
<li><code>{Start..Stop}</code> creates an exclusive range.</li>
<li><code>{Start...Stop}</code> creates an inclusive range.</li>
<li>Reverse ranges (where <code>Start &gt; Stop</code>) automatically infer a negative <code>step</code>.</li>
<li>Negative indices are supported and behave as expected for interval math.</li>
<li>Variable references are supported.</li>
<li>Expressions are not supported, e.g. <code>{x+1..y*2}</code> is invalid.</li>
</ul>
<p>Literal ranges are fully compatible with the constructor:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">({</span><span class="dv">0..5</span><span class="op">}</span> <span class="va">is</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">))</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">({</span><span class="dv">0.</span><span class="op">.</span><span class="dv">.5</span><span class="op">}</span> <span class="va">is</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="kw">true</span><span class="op">))</span></span></code></pre></div>
<p>Invalid literal operands (non‑numeric or <code>nil</code>) will raise an error at runtime when the underlying <code>range()</code> call is evaluated.</p>
<h3 id="iteration-with-ranges">Iteration with Ranges</h3>
<p>Ranges support Fluid&#39;s generic <code>for</code> loops via a special iterator protocol. The recommended style is to use range literals directly in the loop header:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">1..6</span><span class="op">}</span> <span class="cf">do</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>       <span class="co">-- 1,2,3,4,5</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">1.</span><span class="op">.</span><span class="dv">.5</span><span class="op">}</span> <span class="cf">do</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>       <span class="co">-- 1,2,3,4,5</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">5..1</span><span class="op">}</span> <span class="cf">do</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>       <span class="co">-- 5,4,3,2   (exclusive)</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">5.</span><span class="op">.</span><span class="dv">.1</span><span class="op">}</span> <span class="cf">do</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">i</span><span class="op">)</span>       <span class="co">-- 5,4,3,2,1 (inclusive)</span></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Anonymous loops omit the need for a variable store:</p>
<pre><code>for {0..10} do
   count++
end</code></pre>
<p>You can also iterate using a range stored in a variable by calling it to obtain the iterator triple:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0..5</span><span class="op">}</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="va">sum</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> r<span class="op">()</span> <span class="cf">do</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>   <span class="va">sum</span> <span class="er">+=</span> <span class="va">i</span>      <span class="co">-- 0+1+2+3+4</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>For constructor‑based ranges, the iterator is obtained in the same way:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="dv">2</span><span class="op">)()</span> <span class="cf">do</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- i = 0,2,4,6,8</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h3 id="rangetoarray">range.toArray()</h3>
<p>Returns the range as an array of integers that match its sequencing and step attributes.</p>
<h3 id="rangeslice">range.slice()</h3>
<p><code>result = range.slice(Object, Range)</code></p>
<p>The <code>range.slice()</code> function provides a unified API for slicing arrays, tables and strings. It is the underlying
implementation used by the <code>t[{range}]</code> and <code>s[{range}]</code> index syntax, as well as <code>table.slice()</code>.</p>
<p><code>Object</code> is an an array, table or string to slice. <code>Range</code> is a range object (literal or constructed) specifying the slice bounds.</p>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Table slicing</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">}</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">range</span><span class="op">.</span>slice<span class="op">(</span><span class="va">t</span><span class="op">,</span> <span class="op">{</span><span class="dv">1..4</span><span class="op">})</span>      <span class="co">-- {20, 30, 40}</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">range</span><span class="op">.</span>slice<span class="op">(</span><span class="va">t</span><span class="op">,</span> <span class="op">{</span><span class="dv">0.</span><span class="op">.</span><span class="dv">.4</span><span class="op">})</span>     <span class="co">-- {10, 20, 30, 40, 50}</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- String slicing</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="va">s</span> <span class="op">=</span> <span class="st">&quot;Hello, World!&quot;</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">range</span><span class="op">.</span>slice<span class="op">(</span><span class="va">s</span><span class="op">,</span> <span class="op">{</span><span class="dv">0..5</span><span class="op">})</span>      <span class="co">-- &quot;Hello&quot;</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">range</span><span class="op">.</span>slice<span class="op">(</span><span class="va">s</span><span class="op">,</span> <span class="op">{-</span><span class="dv">6.</span><span class="op">..-</span><span class="dv">1</span><span class="op">})</span>   <span class="co">-- &quot;World!&quot;</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- With stepped ranges (requires constructor)</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">}</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">range</span><span class="op">.</span>slice<span class="op">(</span><span class="va">t</span><span class="op">,</span> <span class="va">r</span><span class="op">)</span>           <span class="co">-- {0, 2, 4, 6, 8}</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a><span class="co">-- Reverse slicing</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">range</span><span class="op">.</span>slice<span class="op">(</span><span class="va">t</span><span class="op">,</span> <span class="op">{</span><span class="dv">9.</span><span class="op">.</span><span class="dv">.0</span><span class="op">})</span>     <span class="co">-- {9, 8, 7, 6, 5, 4, 3, 2, 1, 0}</span></span></code></pre></div>
<h3 id="functional-iteration-with-each">Functional Iteration with each()</h3>
<p>Ranges provide an <code>each()</code> method for functional-style iteration. The method accepts a callback function that is
invoked once for each value in the range:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="va">sum</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span><span class="dv">1..6</span><span class="op">}:</span>each<span class="op">(</span><span class="va">Value</span> <span class="op">=&gt;</span> <span class="va">sum</span> <span class="er">+=</span> <span class="va">Value</span><span class="op">)</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- sum is now 15 (1+2+3+4+5)</span></span></code></pre></div>
<p>The callback receives a single argument: the current value in the iteration sequence.</p>
<p><strong>Early Termination</strong></p>
<p>The callback can return <code>false</code> to terminate iteration early:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="va">sum</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..100</span><span class="op">}</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="va">r</span><span class="op">:</span>each<span class="op">(</span><span class="va">Value</span> <span class="op">=&gt;</span> <span class="cf">do</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">Value</span> <span class="op">&gt;</span> <span class="dv">5</span> <span class="cf">then</span> <span class="cf">return</span> <span class="kw">false</span> <span class="cf">end</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>   <span class="va">sum</span> <span class="er">+=</span> <span class="va">Value</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span><span class="op">)</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- sum is 15 (iteration stopped after 5)</span></span></code></pre></div>
<p>Returning <code>true</code> or <code>nil</code> (no return) continues iteration normally.</p>
<p><strong>Method Chaining</strong></p>
<p>The <code>each()</code> method returns the original range object, enabling method chaining:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..6</span><span class="op">}</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="va">r</span><span class="op">:</span>each<span class="op">(</span><span class="va">Value</span> <span class="op">=&gt;</span> <span class="fu">print</span><span class="op">(</span><span class="va">Value</span><span class="op">))</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a> <span class="op">:</span>each<span class="op">(</span><span class="va">Value</span> <span class="op">=&gt;</span> process<span class="op">(</span><span class="va">Value</span><span class="op">))</span></span></code></pre></div>
<p><strong>Usage with Constructor and Literals</strong></p>
<p>The <code>each()</code> method works with both range literals and constructor-based ranges:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- With constructor (can chain directly)</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="dv">2</span><span class="op">):</span>each<span class="op">(</span><span class="va">Value</span> <span class="op">=&gt;</span> <span class="fu">print</span><span class="op">(</span><span class="va">Value</span><span class="op">))</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- With literal (must store in variable first due to parser limitations)</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0..10</span><span class="op">}</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="va">r</span><span class="op">:</span>each<span class="op">(</span><span class="va">Value</span> <span class="op">=&gt;</span> <span class="fu">print</span><span class="op">(</span><span class="va">Value</span><span class="op">))</span></span></code></pre></div>
<h3 id="functional-range-methods">Functional Range Methods</h3>
<p>Ranges provide several functional programming methods for transforming, filtering, and querying data. These methods
offer a declarative style for working with numeric sequences.</p>
<h4 id="filterpredicate">filter(Predicate)</h4>
<p>Returns an array containing only values for which the predicate function returns <code>true</code>:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get even numbers from 1 to 10</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="va">evens</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..11</span><span class="op">}:</span>filter<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- evens = {2, 4, 6, 8, 10}</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Filter with more complex logic</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="va">scores</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0..100</span><span class="op">}:</span>filter<span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">score</span><span class="op">)</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">score</span> <span class="op">&gt;=</span> <span class="dv">60</span> <span class="kw">and</span> <span class="va">score</span> <span class="op">&lt;=</span> <span class="dv">80</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span><span class="op">)</span></span></code></pre></div>
<h4 id="reduceinitial-reducer">reduce(Initial, Reducer)</h4>
<p>Folds all values in the range into a single accumulated result:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sum numbers 1 through 5</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="va">sum</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1.</span><span class="op">.</span><span class="dv">.5</span><span class="op">}:</span>reduce<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">acc</span> <span class="op">+</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- sum = 15</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Calculate factorial of 5</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="va">factorial</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1.</span><span class="op">.</span><span class="dv">.5</span><span class="op">}:</span>reduce<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">acc</span> <span class="op">*</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- factorial = 120</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Build a comma-separated string</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="va">csv</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..4</span><span class="op">}:</span>reduce<span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">,</span> <span class="kw">function</span><span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">acc</span> is <span class="st">&quot;&quot;</span> <span class="cf">then</span> <span class="cf">return</span> <span class="fu">tostring</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="cf">end</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">acc</span> <span class="op">..</span> <span class="st">&quot;,&quot;</span> <span class="op">..</span> <span class="fu">tostring</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span><span class="op">)</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- csv = &quot;1,2,3&quot;</span></span></code></pre></div>
<h4 id="maptransform">map(Transform)</h4>
<p>Returns an array with each value transformed by the given function:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Double each value</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="va">doubled</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..6</span><span class="op">}:</span>map<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">*</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- doubled = {2, 4, 6, 8, 10}</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Convert to strings with formatting</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="va">labels</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..4</span><span class="op">}:</span>map<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="st">&quot;Item &quot;</span> <span class="op">..</span> <span class="fu">tostring</span><span class="op">(</span><span class="va">i</span><span class="op">))</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- labels = {&quot;Item 1&quot;, &quot;Item 2&quot;, &quot;Item 3&quot;}</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Calculate squares</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="va">squares</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1.</span><span class="op">.</span><span class="dv">.5</span><span class="op">}:</span>map<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">*</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- squares = {1, 4, 9, 16, 25}</span></span></code></pre></div>
<h4 id="takecount">take(Count)</h4>
<p>Returns a table containing the first <code>Count</code> values from the range:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Get first 3 values</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="va">first3</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..100</span><span class="op">}:</span>take<span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- first3 = {1, 2, 3}</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Works with reverse ranges</span></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="va">last3</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10..0</span><span class="op">}:</span>take<span class="op">(</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- last3 = {10, 9, 8}</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- If count exceeds range length, returns all available values</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="va">all</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..4</span><span class="op">}:</span>take<span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- all = {1, 2, 3}</span></span></code></pre></div>
<h4 id="anypredicate">any(Predicate)</h4>
<p>Returns <code>true</code> if any value in the range satisfies the predicate (short-circuits on first match):</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check if any value is greater than 5</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="va">hasLarge</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}:</span>any<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&gt;</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- hasLarge = true</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check if any value is negative</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="va">hasNegative</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0..100</span><span class="op">}:</span>any<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- hasNegative = false</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Efficient: stops at first match</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="va">found</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..1000000</span><span class="op">}:</span>any<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="va">is</span> <span class="dv">42</span><span class="op">)</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Only checks values 1 through 42</span></span></code></pre></div>
<h4 id="allpredicate">all(Predicate)</h4>
<p>Returns <code>true</code> if all values in the range satisfy the predicate (short-circuits on first failure):</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check if all values are positive</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="va">allPositive</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}:</span>all<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- allPositive = true</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check if all values are less than 5</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="va">allSmall</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}:</span>all<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&lt;</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- allSmall = false (fails at 5)</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Empty ranges return true (vacuous truth)</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="va">emptyCheck</span> <span class="op">=</span> <span class="op">{</span><span class="dv">5..5</span><span class="op">}:</span>all<span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="kw">false</span><span class="op">)</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- emptyCheck = true</span></span></code></pre></div>
<h4 id="findpredicate">find(Predicate)</h4>
<p>Returns the first value that satisfies the predicate, or <code>nil</code> if none found:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Find first value greater than 5</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="va">first</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}:</span><span class="fu">find</span><span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&gt;</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- first = 6</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Find first even number</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="va">firstEven</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}:</span><span class="fu">find</span><span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- firstEven = 2</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Returns nil when not found</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="va">notFound</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..10</span><span class="op">}:</span><span class="fu">find</span><span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&gt;</span> <span class="dv">100</span><span class="op">)</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- notFound = nil</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Works with reverse ranges</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a><span class="va">fromEnd</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10..0</span><span class="op">}:</span><span class="fu">find</span><span class="op">(</span><span class="va">i</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">&lt;</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- fromEnd = 4</span></span></code></pre></div>
<p><strong>Method Return Types:</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Returns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filter()</code></td>
<td>Table</td>
</tr>
<tr>
<td><code>reduce()</code></td>
<td>Single value (type depends on reducer)</td>
</tr>
<tr>
<td><code>map()</code></td>
<td>Table</td>
</tr>
<tr>
<td><code>take()</code></td>
<td>Table</td>
</tr>
<tr>
<td><code>any()</code></td>
<td>Boolean</td>
</tr>
<tr>
<td><code>all()</code></td>
<td>Boolean</td>
</tr>
<tr>
<td><code>find()</code></td>
<td>Value or <code>nil</code></td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Methods that return tables (<code>filter</code>, <code>map</code>, <code>take</code>) cannot be chained with other range methods since tables
are not ranges. Use <code>reduce()</code> directly on a range for aggregation, or store intermediate results:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sum of squares of even numbers from 1 to 20</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="va">sum</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1..21</span><span class="op">}:</span>reduce<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="kw">function</span><span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">i</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span> <span class="cf">then</span> <span class="cf">return</span> <span class="va">acc</span> <span class="op">+</span> <span class="op">(</span><span class="va">i</span> <span class="op">*</span> <span class="va">i</span><span class="op">)</span> <span class="cf">end</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">acc</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span><span class="op">)</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- sum = 2^2 + 4^2 + 6^2 + ... + 20^2 = 1540</span></span></code></pre></div>
<h3 id="string-slicing-with-ranges">String Slicing with Ranges</h3>
<p>Strings support range objects as indices to perform slicing. Indexing is zero‑based and inclusive of the start
position; the end index is interpreted according to the range&#39;s <code>inclusive</code> flag.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="va">s</span> <span class="op">=</span> <span class="st">&quot;Hello, World!&quot;</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="va">s</span><span class="op">[{</span><span class="dv">0..5</span><span class="op">}]</span>   is <span class="st">&quot;Hello&quot;</span><span class="op">)</span>   <span class="co">-- Exclusive: indices 0..4</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="va">s</span><span class="op">[{</span><span class="dv">7..12</span><span class="op">}]</span>  is <span class="st">&quot;World&quot;</span><span class="op">)</span>   <span class="co">-- Exclusive: indices 7..11</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="va">s</span><span class="op">[{</span><span class="dv">0.</span><span class="op">.</span><span class="dv">.4</span><span class="op">}]</span>  is <span class="st">&quot;Hello&quot;</span><span class="op">)</span>   <span class="co">-- Inclusive: indices 0..4</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="va">s</span><span class="op">[{-</span><span class="dv">6.</span><span class="op">.-</span><span class="dv">1</span><span class="op">}]</span> is <span class="st">&quot;World!&quot;</span><span class="op">)</span>  <span class="co">-- Negative indices (always inclusive)</span></span></code></pre></div>
<p>Out‑of‑bounds and empty ranges behave predictably:</p>
<ul>
<li>Ranges entirely beyond the string length return an empty string.</li>
<li>Exclusive ranges where <code>start</code> equals <code>stop</code> yield an empty string.</li>
<li>Inclusive single‑element ranges return the corresponding character.</li>
</ul>
<h3 id="table-slicing-with-ranges">Table Slicing with Ranges</h3>
<p>Tables support range objects as indices to extract subsequences. Indexing is zero‑based and follows the same
inclusive/exclusive semantics as string slicing. Table slices always return a new table containing copies of the
selected elements.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">}</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="va">subset</span> <span class="op">=</span> <span class="va">t</span><span class="op">[{</span><span class="dv">1..4</span><span class="op">}]</span>    <span class="co">-- Returns {20, 30, 40} (exclusive)</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="va">subset</span> <span class="op">=</span> <span class="va">t</span><span class="op">[{</span><span class="dv">1.</span><span class="op">.</span><span class="dv">.3</span><span class="op">}]</span>   <span class="co">-- Returns {20, 30, 40} (inclusive)</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="va">subset</span> <span class="op">=</span> <span class="va">t</span><span class="op">[{</span><span class="dv">0..5</span><span class="op">}]</span>    <span class="co">-- Returns {10, 20, 30, 40, 50} (full table)</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="va">subset</span> <span class="op">=</span> <span class="va">t</span><span class="op">[{-</span><span class="dv">3.</span><span class="op">.-</span><span class="dv">1</span><span class="op">}]</span>  <span class="co">-- Returns {30, 40, 50} (negative indices, always inclusive)</span></span></code></pre></div>
<p><strong>Negative Indices:</strong></p>
<p>When either the start or stop index is negative, the range is interpreted as inclusive regardless of the <code>..</code> or <code>...</code>
syntax used. Negative indices count backwards from the end of the table.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">}</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{-</span><span class="dv">2.</span><span class="op">.-</span><span class="dv">1</span><span class="op">}]</span>   <span class="co">-- Returns {40, 50} (inclusive due to negative indices)</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">1.</span><span class="op">..-</span><span class="dv">1</span><span class="op">}]</span>   <span class="co">-- Returns {20, 30, 40, 50} (inclusive due to negative stop)</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{-</span><span class="dv">3.</span><span class="op">.</span><span class="dv">.4</span><span class="op">}]</span>   <span class="co">-- Returns {30, 40, 50} (inclusive due to negative start)</span></span></code></pre></div>
<p><strong>Reverse Slicing:</strong></p>
<p>Ranges where the start index is greater than the stop index produce reversed subsequences. The direction is
auto-detected based on the resolved indices.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">}</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">4..0</span><span class="op">}]</span>    <span class="co">-- Returns {50, 40, 30, 20} (reverse exclusive)</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">4.</span><span class="op">.</span><span class="dv">.0</span><span class="op">}]</span>   <span class="co">-- Returns {50, 40, 30, 20, 10} (reverse inclusive)</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">3..1</span><span class="op">}]</span>    <span class="co">-- Returns {40, 30} (reverse partial)</span></span></code></pre></div>
<p><strong>Step Support:</strong></p>
<p>For stepped ranges, use the <code>range()</code> constructor. Range literals (<code>{start..stop}</code>) do not support the step parameter.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">60</span><span class="op">,</span> <span class="dv">70</span><span class="op">}</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span>    <span class="co">-- Every 2nd element</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[</span><span class="va">r</span><span class="op">]</span>                        <span class="co">-- Returns {10, 30, 50, 70}</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> range<span class="op">(</span><span class="dv">6</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="op">-</span><span class="dv">2</span><span class="op">)</span>   <span class="co">-- Reverse with step</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[</span><span class="va">r</span><span class="op">]</span>                        <span class="co">-- Returns {70, 50, 30, 10}</span></span></code></pre></div>
<p><strong>Out-of-Bounds and Empty Ranges:</strong></p>
<ul>
<li>Indices beyond the table length are clipped to valid bounds</li>
<li>Exclusive ranges where <code>start</code> equals <code>stop</code> return an empty table</li>
<li>Ranges entirely beyond the table length return an empty table</li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">}</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">0..10</span><span class="op">}]</span>   <span class="co">-- Returns {10, 20, 30} (end clipped)</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{-</span><span class="dv">10..3</span><span class="op">}]</span>  <span class="co">-- Returns {10, 20, 30} (start clipped to 0)</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">2..2</span><span class="op">}]</span>    <span class="co">-- Returns {} (empty exclusive range)</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">5..10</span><span class="op">}]</span>   <span class="co">-- Returns {} (beyond table length)</span></span></code></pre></div>
<p><strong>Metatable Interaction:</strong></p>
<p>Tables with custom <code>__index</code> metamethods will use the custom handler instead of the base table slicing. Tables with
other metamethods (like <code>__len</code>, <code>__tostring</code>, etc.) but no <code>__index</code> will still support range slicing through the
base metatable fallback.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">}</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setmetatable</span><span class="op">(</span><span class="va">t</span><span class="op">,</span> <span class="op">{</span> <span class="bu">__len</span> <span class="op">=</span> <span class="kw">function</span><span class="op">()</span> <span class="cf">return</span> <span class="dv">100</span> <span class="kw">end</span> <span class="op">})</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="va">t</span><span class="op">[{</span><span class="dv">0..3</span><span class="op">}]</span>    <span class="co">-- Returns {10, 20, 30} (slicing still works)</span></span></code></pre></div>
<h3 id="membership-testing">Membership Testing</h3>
<p>Fluid extends the <code>in</code> operator to work with ranges outside of <code>for</code> loops. Membership tests are implemented in terms
of the range&#39;s <code>contains</code> method, and always return a boolean.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="va">r</span>  <span class="op">=</span> <span class="op">{</span><span class="dv">0..10</span><span class="op">}</span>     <span class="co">-- Exclusive: 0–9</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="va">ri</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0.</span><span class="op">.</span><span class="dv">.10</span><span class="op">}</span>    <span class="co">-- Inclusive: 0–10</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="dv">5</span> <span class="kw">in</span> <span class="va">r</span><span class="op">)</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="kw">not</span> <span class="op">(</span><span class="dv">10</span> <span class="kw">in</span> <span class="va">r</span><span class="op">))</span>  <span class="co">-- 10 excluded</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="dv">10</span> <span class="kw">in</span> <span class="va">ri</span><span class="op">)</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="fu">assert</span><span class="op">(</span><span class="kw">not</span> <span class="op">(</span><span class="dv">11</span> <span class="kw">in</span> <span class="va">ri</span><span class="op">))</span></span></code></pre></div>
<p><code>in</code> can be used anywhere a boolean expression is expected, including conditionals:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="dv">5</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">0..10</span><span class="op">}</span> <span class="cf">then</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;in range&quot;</span><span class="op">)</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> <span class="op">(</span><span class="dv">11</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">0..10</span><span class="op">})</span> <span class="cf">then</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;out of range&quot;</span><span class="op">)</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Membership tests work with both literal ranges and ranges stored in variables. The semantics follow the <code>contains</code>
method exactly, including step handling and inclusive/exclusive behaviour.</p>
<hr>
<h3 id="choose-expressions">Choose Expressions</h3>
<p>The <code>choose ... from</code> syntax provides pattern matching for selecting a result value (or executing a branch) without
verbose <code>if</code>/<code>elseif</code> chains.</p>
<p>Basic form:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="va">status_text</span> <span class="op">=</span> <span class="va">choose</span> <span class="va">status</span> <span class="va">from</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>   <span class="dv">200</span> <span class="op">-&gt;</span> <span class="st">&#39;OK&#39;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>   <span class="dv">404</span> <span class="op">-&gt;</span> <span class="st">&#39;Not Found&#39;</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> <span class="op">-&gt;</span> <span class="st">&#39;Unknown&#39;</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Semantics:</strong></p>
<ul>
<li>The scrutinee expression (<code>status</code>) is evaluated exactly once.</li>
<li>Cases are tested in order; the first match wins.</li>
<li><code>else</code> is optional. If omitted and no case matches, the result is <code>nil</code> (expression context) and no action is taken
(statement context).</li>
<li><code>else</code> must be the final case. An <code>else</code>-only <code>choose</code> is valid and always matches.</li>
</ul>
<p><strong>Patterns:</strong></p>
<ul>
<li><strong>Literal patterns</strong>: numbers, strings, booleans, and <code>nil</code> match using <code>is</code> semantics (no implicit type coercion).</li>
<li><strong>Wildcard</strong>: <code>_</code> matches anything and is typically used as a catch-all.</li>
<li><strong>Relational patterns</strong>: <code>&lt; Expr</code>, <code>&lt;= Expr</code>, <code>&gt; Expr</code>, <code>&gt;= Expr</code> use normal relational operators.</li>
<li><strong>Table patterns</strong>: <code>{ key = value, ... }</code> match tables using open-record semantics:
<ul>
<li>Extra keys on the scrutinee are ignored</li>
<li>Matching is shallow and compares values using <code>is</code></li>
<li><code>{}</code> matches any table value (but does not match non-table values)</li>
</ul></li>
<li><strong>Tuple patterns</strong>: <code>(p0, p1, ...)</code> match tuples created from multiple scrutinee values:
<ul>
<li><code>choose (a, b) from ... end</code> evaluates <code>a</code> and <code>b</code> once and matches by arity</li>
<li>Tuple arity mismatches are compile-time errors</li>
<li><code>(x)</code> is a parenthesised expression; a tuple requires a comma</li>
</ul></li>
</ul>
<p><strong>Guards:</strong></p>
<p>Cases may include a <code>when</code> clause to add a conditional guard:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="va">icon</span> <span class="op">=</span> <span class="va">choose</span> <span class="va">notification</span> <span class="va">from</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span> <span class="fu">type</span> <span class="op">=</span> <span class="st">&#39;message&#39;</span><span class="op">,</span> <span class="va">unread</span> <span class="op">=</span> <span class="kw">true</span> <span class="op">}</span> <span class="op">-&gt;</span> <span class="st">&#39;icon-inbox-unread&#39;</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span> <span class="fu">type</span> <span class="op">=</span> <span class="st">&#39;message&#39;</span> <span class="op">}</span> <span class="va">when</span> <span class="va">notification</span><span class="op">.</span><span class="va">priority</span> <span class="op">&gt;</span> <span class="dv">5</span> <span class="op">-&gt;</span> <span class="st">&#39;icon-priority&#39;</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> <span class="op">-&gt;</span> <span class="st">&#39;icon-default&#39;</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The guard is evaluated only after the pattern has matched. Guard failure proceeds to the next case.</p>
<p><strong>Desugaring (conceptual):</strong></p>
<p><code>choose ... from</code> lowers to an <code>if</code>/<code>elseif</code> chain using a temporary to ensure the scrutinee is evaluated once. In
complex expression positions, the compiler may wrap the <code>choose</code> in a small function to yield a value.</p>
<p><strong>Examples:</strong></p>
<p>Tuple scrutinee with wildcard patterns:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="va">movement</span> <span class="op">=</span> choose <span class="op">(</span><span class="va">dx</span><span class="op">,</span> <span class="va">dy</span><span class="op">)</span> <span class="va">from</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="st">&#39;standing&#39;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="cn">_</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="st">&#39;vertical&#39;</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">(</span><span class="cn">_</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="st">&#39;horizontal&#39;</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> <span class="op">-&gt;</span> <span class="st">&#39;diagonal&#39;</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Wildcard as a catch-all (including <code>NaN</code>):</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="va">label</span> <span class="op">=</span> <span class="va">choose</span> <span class="va">value</span> <span class="va">from</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">nil</span> <span class="op">-&gt;</span> <span class="st">&#39;unset&#39;</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>   <span class="cn">_</span> <span class="op">-&gt;</span> <span class="st">&#39;set&#39;</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Nesting <code>choose</code> expressions:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="va">msg</span> <span class="op">=</span> <span class="va">choose</span> <span class="va">status</span> <span class="va">from</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>   <span class="dv">200</span> <span class="op">-&gt;</span> <span class="st">&#39;OK&#39;</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> <span class="op">-&gt;</span> <span class="va">choose</span> <span class="va">retry_count</span> <span class="va">from</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span> <span class="op">-&gt;</span> <span class="st">&#39;Failed (no retry)&#39;</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="op">-&gt;</span> <span class="st">&#39;Failed (will retry)&#39;</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Conditionals with <code>when</code> guards, against a table with pattern filtering:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="va">notification</span> <span class="op">=</span> <span class="op">{</span> <span class="fu">type</span> <span class="op">=</span> <span class="st">&#39;message&#39;</span><span class="op">,</span> <span class="va">unread</span> <span class="op">=</span> <span class="kw">true</span><span class="op">,</span> <span class="va">priority</span> <span class="op">=</span> <span class="dv">7</span> <span class="op">}</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="va">icon</span> <span class="op">=</span> <span class="va">choose</span> <span class="va">notification</span> <span class="va">from</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span> <span class="fu">type</span> <span class="op">=</span> <span class="st">&#39;message&#39;</span> <span class="op">}</span> <span class="va">when</span> <span class="va">notification</span><span class="op">.</span><span class="va">unread</span> <span class="op">-&gt;</span> <span class="st">&#39;icon-inbox-unread&#39;</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span> <span class="fu">type</span> <span class="op">=</span> <span class="st">&#39;message&#39;</span> <span class="op">}</span> <span class="op">-&gt;</span> <span class="op">(</span><span class="va">notification</span><span class="op">.</span><span class="va">priority</span> <span class="op">&gt;</span> <span class="dv">5</span> ? <span class="st">&#39;icon-priority&#39;</span> <span class="op">:&gt;</span> <span class="st">&#39;icon-inbox&#39;</span><span class="op">)</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> <span class="op">-&gt;</span> <span class="st">&#39;icon-default&#39;</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>Free-standing <code>choose</code> statements for flexible assignments and control flow:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="va">choose</span> <span class="va">state</span> <span class="va">from</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;save&#39;</span> <span class="op">-&gt;</span> <span class="va">result</span> <span class="op">=</span> <span class="st">&#39;saved&#39;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">&#39;load&#39;</span> <span class="op">-&gt;</span> <span class="va">result</span> <span class="op">=</span> <span class="st">&#39;loaded&#39;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> <span class="op">-&gt;</span> <span class="fu">error</span><span class="op">(</span><span class="st">&#39;Invalid state&#39;</span><span class="op">)</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Gotchas:</strong></p>
<ul>
<li>Order matters, especially with relational patterns: place more specific cases first (<code>&lt; 30</code> before <code>&lt; 60</code>).</li>
<li><code>NaN</code> never matches literal numeric patterns (<code>nan is nan</code> is false). Use <code>_</code> or a guard if you need to handle it.</li>
<li>Table patterns are shallow: nested tables must be checked via guards or nested <code>choose</code> expressions.</li>
</ul>
<hr>
<h2 id="script-management">Script Management</h2>
<h3 id="include">include</h3>
<p>The <code>include</code> statement is used to load the definitions for an API&#39;s functions and classes. It accepts a series of API names as input, and will load each in sequence, for example:</p>
<pre><code>include &#39;core&#39;,&#39;xml&#39;,&#39;display&#39;</code></pre>
<p>API interfaces are protected from being loaded more than once. Calls to <code>mod.load()</code> result in API definitions being loaded automatically, and may make a call to <code>include</code> being unnecessary in that case.</p>
<h3 id="import">import</h3>
<p><code>import &#39;name&#39; [as namespace]</code></p>
<p>The <code>import</code> statement loads and inlines a Fluid script file at parse time. Inlining means that the requested script is loaded directly into the call site during compilation, which in turn improves the parser&#39;s efficacy at producing optimised code. Scripts loaded via <code>import</code> are often referred to as &#39;libraries&#39; and are typically designed to be shared. In that spirit, if a library is imported more than once, all subsequent imports do not result in reloading.</p>
<p>Existing libraries are available in the <code>scripts:</code> volume, which is the default search location for the import process. For instance, <code>import &#39;gui&#39;</code> would load the script at <code>scripts:gui.fluid</code>. In order to ensure that libraries cannot be imported multiple times, import&#39;s naming conventions are strict. Do not include the file extension, nor prefix the file with a full path. Only alpha-numeric characters are allowed for naming.</p>
<p><strong>Namespaces:</strong></p>
<p>Libraries will typically declare a default namespace that matches the library name. For instance, the <code>gui</code> library declares a <code>gui</code> namespace. To use a custom namespace, add the <code>as namespace</code> clause. For example:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>import <span class="st">&#39;gui&#39;</span> <span class="va">as</span> <span class="va">myGui</span></span></code></pre></div>
<p><strong>Application Specific Libraries:</strong></p>
<p>Complex applications can benefit from using <code>import</code> to create custom libraries and split the code across multiple files. The <code>import</code> statement will search the local folder if the reference is prefixed with <code>./</code>. Standard path rules still apply, e.g. <code>./lib/customlib</code> would be valid, <code>./../../h4cklib!3.fluid</code> is not.</p>
<p><strong>Behavioural Notes:</strong></p>
<ul>
<li><strong>Top-level only</strong>: The <code>import</code> statement can only appear in the outside scope of a script, not inside functions. Attempting to use <code>import</code> inside a function results in a parse error.</li>
<li><strong>Parse-time inlining</strong>: The imported code becomes part of the importing script&#39;s bytecode. This means imported code executes in the same context as if it were written directly in the importing file.</li>
<li><strong>Global exports</strong>: Global variables and functions declared with the <code>global</code> keyword in the imported file become accessible to the importing script.</li>
<li><strong>Private locals</strong>: Local variables in the imported file remain private and do not pollute the importing script&#39;s namespace.</li>
</ul>
<p><strong>Example - Exporting Globals:</strong></p>
<div class="sourceCode" id="cb128"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- helpers.fluid</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="kw">function</span> formatDate<span class="op">(</span><span class="va">Timestamp</span><span class="op">)</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="fu">os.date</span><span class="op">(</span><span class="st">&#39;%Y-%m-%d&#39;</span><span class="op">,</span> <span class="va">Timestamp</span><span class="op">)</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="cn">HELPER_VERSION</span> <span class="op">=</span> <span class="st">&#39;1.0&#39;</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Private to helpers.fluid</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">internal_cache</span> <span class="op">=</span> <span class="op">{}</span></span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- main.fluid</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>import <span class="st">&#39;./helpers&#39;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>formatDate<span class="op">(</span><span class="fu">os.time</span><span class="op">()))</span>  <span class="co">-- Uses the imported global function</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="cn">HELPER_VERSION</span><span class="op">)</span>          <span class="co">-- Accesses the imported global variable</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- internal_cache is not accessible here</span></span></code></pre></div>
<p><strong>Conditional Pre-Processing:</strong></p>
<p>The <code>import</code> statement works seamlessly with compile-time conditionals. Imported files can use <code>@if(imported=true)</code> to include code only when being imported, or <code>@if(imported=false)</code> for code that runs only when executed directly:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- library.fluid</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="va">global</span> <span class="kw">function</span> doWork<span class="op">()</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Always available</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>@if<span class="op">(</span><span class="va">imported</span><span class="op">=</span><span class="kw">false</span><span class="op">)</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Only runs when library.fluid is executed directly</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Running library.fluid as main script&#39;</span><span class="op">)</span></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>   doWork<span class="op">()</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>@<span class="va">end</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>@if<span class="op">(</span><span class="va">imported</span><span class="op">=</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Only runs when imported</span></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;library.fluid loaded as import&#39;</span><span class="op">)</span></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>@<span class="va">end</span></span></code></pre></div>
<p><strong>Library Development Pattern:</strong></p>
<p>If developing a Fluid library, it is common to define a namespace and export global variables or functions under that namespace. This example based on the <code>gui</code> library shows a common pattern for defining a library with a namespace and exporting global variables:</p>
<pre><code>   namespace &#39;gui&#39;

   _LIB[_NS] = {
      theme = &#39;light&#39;,
      dpi = 160,
      ...
   }

   gui = _LIB[_NS]

gui.parseRGB = function(hex)
   ...
end</code></pre>
<p>Note that <code>_LIB</code> and <code>_NS</code> are special predefined variables available during import. <code>_LIB</code> is a table used to store library interfaces, and <code>_NS</code> contains the declared namespace string, in this case <code>gui</code>.</p>
<h3 id="loadfile">loadFile()</h3>
<p>Use <code>loadFile()</code> to load, parse and execute a Fluid script at runtime. This feature is useful for re-using code, or breaking a large project into multiple script files. Example:</p>
<p><code>loadFile(&#39;programs:tools/project/example.fluid&#39;)</code></p>
<p>If the path is not fully qualified, the current path of the process will be used to determine the location of the source file.</p>
<p>If the executed script ends with a <code>return</code> statement, the value(s) will be returned from <code>loadFile()</code> in their original form.</p>
<p>Note: Code loaded via <code>loadFile()</code> will lose the efficiency gains afforded to scripts loaded via <code>import</code>.</p>
<h3 id="exec">exec()</h3>
<p>Use <code>exec()</code> to parse a Fluid statement and execute it. <code>exec()</code> will raise an exception if the statement is unparseable or fails during execution. Example:</p>
<pre><code>exec([[
   print(&quot;Hello World&quot;)
]])</code></pre>
<hr>
<h2 id="module-interface">Module Interface</h2>
<p>The module interface provides a means for Fluid programs to communicate with Parasol&#39;s APIs. They are loaded using the <code>mod.load()</code> function, for instance:</p>
<p><code>mGfx = mod.load(&#39;display&#39;)</code></p>
<p>Calling <code>mod.load()</code> returns the function table for the requested module, allowing calls to be made to its functions. For instance:</p>
<p><code>err, x, y = mGfx.getCursorPos()</code></p>
<p>Notice that Fluid is capable of returning multiple results if a function has declared more than one return value. Typically the first value will be an <code>ERR</code> code.</p>
<p>For consistency, we use a set of commonly named global variables to store module function tables. This is because loading an API more than once is undesirable. The following table illustrates the global names that we use for the default set of APIs.</p>
<table>
<thead>
<tr>
<th>Module</th>
<th>Global Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>audio</td>
<td>mAudio</td>
</tr>
<tr>
<td>core</td>
<td>mSys</td>
</tr>
<tr>
<td>display</td>
<td>mGfx</td>
</tr>
<tr>
<td>font</td>
<td>mFont</td>
</tr>
<tr>
<td>network</td>
<td>mNet</td>
</tr>
<tr>
<td>vector</td>
<td>mVec</td>
</tr>
<tr>
<td>xml</td>
<td>mXML</td>
</tr>
</tbody>
</table>
<p>Taking the above into account, our first example should now be written as follows:</p>
<p><code>mGfx ?= mod.load(&#39;display&#39;)</code></p>
<p>Note that the Core module, identified by the <code>mSys</code> global variable is considered an essential API and is always available by default.</p>
<h3 id="type-conversion">Type Conversion</h3>
<p>When calling an API function, Fluid uses best efforts to convert function values to the types declared in the function definition. For instance, if a string value is used for a numeric argument, Fluid will automatically convert the string to an integer. If the type cannot be converted (for instance, an abstract pointer cannot be converted to a number) then a type mismatch occurs and an exception will be raised.</p>
<p>While type conversion is convenient, we recommend using the correct type whenever possible as this will ensure that your calls are being made efficiently.</p>
<h3 id="buffer-handling">Buffer Handling</h3>
<p>When calling functions that copy results to a user-supplied buffer, pass an array interface. The following example illustrates reading content from a file into an array buffer:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="va">buffer</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="fu">byte</span><span class="op">,</span> <span class="va">file</span><span class="op">.</span><span class="va">size</span><span class="op">&gt;</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="va">err</span><span class="op">,</span> <span class="va">result</span> <span class="op">=</span> <span class="va">file</span><span class="op">.</span>acRead<span class="op">(</span><span class="va">buffer</span><span class="op">)</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="fu">tostring</span><span class="op">(</span><span class="va">buffer</span><span class="op">))</span></span></code></pre></div>
<p>Notice that the <code>acRead()</code> call hasn&#39;t been given its second parameter (the amount of data to read). This is possible because Fluid knows the size of the buffer and will use it for the second parameter if not already defined.</p>
<h3 id="multiple-result-values">Multiple Result Values</h3>
<p>Some functions may return multiple result values. Here is an example of a module function that returns two results:</p>
<p><code>ERR ListMemory(INT Flags, ListMemory **Memory)</code></p>
<p>The first result is an <code>ERR</code> code. The <code>ListMemory</code> result is stored in the variable pointed to by the Memory argument. In a C program, this function would be used as follows:</p>
<p><code>if (!ListMemory(0, &amp;memory)) { ... }</code></p>
<p>In Fluid, pointer results are dropped from function specifications because writing to pointer buffers is risky. Instead, these parameters are handled internally and their values are returned as part of the result set. The following example shows how to call <code>ListMemory()</code> in Fluid:</p>
<p><code>err, list = mSys.ListMemory(0)</code></p>
<p>Some functions like the above can return allocated memory or some other form of temporary resource. These are normally marked as such in the function definition, which allows the garbage collector to automatically remove it once its references have been reduced to zero. Remember to use <code>local</code> wherever possible to clean up resources that have gone out of scope.</p>
<hr>
<h2 id="object-interface">Object Interface</h2>
<p>The object interface provides the necessary functionality to create and manage objects. It allows you to read and manipulate object fields, call methods and actions, manage subscriptions and connect to existing named objects.</p>
<h3 id="object-creation">Object Creation</h3>
<p>To create a new object, use the object interface&#39;s <code>new()</code> method with the name of the class that will be instantiated. Here&#39;s an example that creates an object, sets necessary field values and initialises it:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="va">file</span> <span class="op">=</span> <span class="va">obj</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;file&#39;</span><span class="op">)</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">.</span><span class="va">path</span>  <span class="op">=</span> <span class="st">&#39;readme.md&#39;</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="va">file</span><span class="op">.</span><span class="va">flags</span> <span class="op">=</span> <span class="st">&#39;!READ&#39;</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="va">err</span> <span class="op">=</span> <span class="va">file</span><span class="op">.</span>init<span class="op">()</span></span></code></pre></div>
<p>The first result from <code>new()</code> is the created object&#39;s interface and the second result is an <code>ERR</code> code if creation fails. Take note that an object must always be initialised before any real interaction occurs (anything beyond setting field values).</p>
<p>The above example can be simplified by defining key-values immediately after the class name:</p>
<p><code>file = obj.new(&#39;File&#39;, { path=&#39;readme.md&#39;, flags=&#39;!READ&#39; } )</code></p>
<p>In this case the <code>path</code> and <code>flags</code> values will be set on the new object and then initialised automatically (it is assumed <em>all</em> field settings are being defined up-front). The field values may be of any type and Fluid will use best efforts to convert them to the correct field type.</p>
<p>In the event of an error, <code>new()</code> will throw an exception. It <em>never</em> returns nil. We advise guarding your calls with <code>try</code>, particularly if using classes like <code>File</code> where error management is good practice.</p>
<h4 id="objectinit">object.init()</h4>
<p>Initialises the object if not already done so with <code>obj.new()</code>. Useful if you need to set field values after creation but before initialisation. Does not throw in normal operation, instead an <code>ERR</code> code is returned to indicate success or failure.</p>
<h3 id="object-relationships">Object Relationships</h3>
<p>Parasol enforces OO relationships so that an object will always have a parent, and consequently it may have siblings and its own children. By default, all objects created by <code>obj.new()</code> are owned by the Fluid script (which exists as a runtime object).</p>
<p>Sometimes a new object will need to be declared as the child of an existing object. Imagine for instance, that we have a window open and we want to draw a rectangle to it. This can be achieved with something like:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="va">viewport</span> <span class="op">=</span> <span class="va">glWindow</span><span class="op">:</span>clientViewport<span class="op">({</span> <span class="va">aspectRatio</span> <span class="op">=</span> <span class="cn">ARF_MEET</span> <span class="op">})</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="va">viewport</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;VectorRectangle&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="va">x</span><span class="op">=</span><span class="dv">0</span><span class="op">,</span> <span class="va">y</span><span class="op">=</span><span class="dv">0</span><span class="op">,</span> <span class="va">width</span><span class="op">=</span><span class="st">&#39;100%&#39;</span><span class="op">,</span> <span class="va">height</span><span class="op">=</span><span class="st">&#39;100%&#39;</span><span class="op">,</span> <span class="va">fill</span><span class="op">=</span><span class="st">&#39;rgb(255,0,0)&#39;</span> <span class="op">})</span></span></code></pre></div>
<p>Notice that the call to <code>viewport.new()</code> looks suspiciously like an <code>obj.new()</code> call. Functionally the creation process is identical, but the rectangle is now going to be a child of the <code>viewport</code> instead of our script. When the rectangle is initialised, it will determine that it is owned by the viewport and will appear in that context when displayed.</p>
<p>It is the case that <em>all</em> objects support the <code>new()</code> method for the purpose of supporting these complex hierarchies.</p>
<p>Be aware that object relationships have absolute priority over other factors in determining their lifetime. In the above example, if the viewport is destroyed (e.g. the user closes the window) then the rectangle will be destroyed with it because its state is linked to the parent. Objects created as children are weakly referenced.</p>
<h4 id="objectchildren">object.children()</h4>
<p>Obtain a list of the children that have been attached to an object by calling the <code>children()</code> method. It returns an <code>array</code> of UID&#39;s that can be converted to interfaces with <code>obj.find()</code>. The <code>children()</code> method also supports a class filter in the first parameter, e.g. <code>thing.children(&#39;VectorRectangle&#39;)</code> would return a list of all rectangles.</p>
<h3 id="accessing-objects">Accessing Objects</h3>
<p>Access the interface of an existing object by searching for its name or UID:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="va">window</span> <span class="op">=</span> <span class="va">obj</span><span class="op">.</span>find<span class="op">(</span><span class="st">&#39;my_window&#39;</span><span class="op">)</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="va">winsurface</span> <span class="op">=</span> <span class="va">obj</span><span class="op">.</span>find<span class="op">(</span><span class="va">window</span><span class="op">.</span><span class="va">surface</span><span class="op">)</span></span></code></pre></div>
<p>If the object is not found, <code>nil</code> is returned. If multiple objects exist with the same name, the most recently created object is returned first.</p>
<h4 id="objlock">obj:lock()</h4>
<p>If an object is being shared in a threaded program, locking may be necessary to prevent data corruption. This can be achieved by calling <code>lock()</code> and passing a function that will gain an exclusive lock on the object. The lock will remain until the function returns.</p>
<pre><code>obj:lock(function()
   --Code--
end)</code></pre>
<h4 id="objectexists">object.exists()</h4>
<p>If an object is loosely coupled to a script (a weak reference), the <code>exists()</code> method can be called at any time to confirm it is not destroyed. The result is a boolean value.</p>
<h4 id="objectdetach">object.detach()</h4>
<p>It is not uncommon that a script may need to create an object that outlives its scope. Calling <code>detach()</code> will unlink the object from the script and the garbage collector, demoting it to a weak reference. Once detached, the object can only be removed if its parent object is destroyed, or the <code>free()</code> method is called.</p>
<p>Note: If an object has been created as the child of another, e.g. <code>viewport.new(&#39;VectorRectangle&#39;, { ... })</code> then the object is already weakly referenced and detach() will do nothing.</p>
<h4 id="objectfree">object.free()</h4>
<p>Call <code>free()</code> to terminate an object resource immediately without removing the interface. If the object is weakly referenced then <code>free()</code> is the most practical means of removal.</p>
<p>Calling <code>free()</code> is discouraged in general usage - a safer pattern is to set object references to <code>nil</code> and either wait for garbage collection or call <code>collectgarbage()</code>.</p>
<h3 id="garbage-collection">Garbage Collection</h3>
<p>The garbage collector will automatically terminate an object once all references to that object are released or the script is terminated. If an object has a single reference, you can manually terminate it by setting the reference to <code>nil</code>, for example:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="va">file</span> <span class="op">=</span> <span class="va">obj</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;File&#39;</span><span class="op">)</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="va">file</span> <span class="op">=</span> <span class="kw">nil</span></span></code></pre></div>
<h3 id="action-and-method-calls">Action and Method Calls</h3>
<p>After successfully initialising an object interface, interaction with it is possible through actions, methods and fields. The following example illustrates how we could change the size of the VectorRectangle we created earlier:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="va">rect</span><span class="op">.</span>acRedimension<span class="op">(</span><span class="dv">20</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span></span></code></pre></div>
<p>Action calls are identified by their <code>ac</code> prefix. Method calls are prefixed by <code>mt</code>. Field references can be directly accessed without a prefix. The naming scheme for methods, actions and fields is case insensitive.</p>
<p>For information about the actions and methods supported by an object class, refer to its published API documentation on our website.</p>
<h3 id="field-interface">Field Interface</h3>
<p>Object fields are accessible by conventional means, i.e. <code>thing = my_object.field_name</code> and <code>my_object.field_name = thing</code> for get and set respectively. There are <code>get()</code> and <code>set()</code> methods that are equivalent to these, and they can be useful in special circumstances such as retrieving a value from an array-based field without first retrieving the entire array:</p>
<p><code>item = view.get(&#39;item(10)&#39;)</code></p>
<h4 id="objectgetkey-objectsetkey">object.getKey(), object.setKey()</h4>
<p>Some classes support key-value pairs in cases where custom string names need to be associated with an object. The <code>getKey()</code> and <code>setKey()</code> methods are provided to manage these fields. For example:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="va">surface</span><span class="op">.</span>setKey<span class="op">(</span><span class="st">&#39;Title&#39;</span><span class="op">,</span> <span class="st">&#39;My Window&#39;</span><span class="op">)</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="va">title</span> <span class="op">=</span> <span class="va">surface</span><span class="op">.</span>getKey<span class="op">(</span><span class="st">&#39;Title&#39;</span><span class="op">,</span> <span class="st">&#39;UNDEFINED&#39;</span><span class="op">)</span></span></code></pre></div>
<h4 id="object_state">object._state()</h4>
<p>The <code>_state()</code> method is a special accessor that attaches a table to the object and returns it. This allows you to store custom data with the object that is seperate to its definition. The table will be removed when the object is destroyed.</p>
<h3 id="bit-fields">Bit Fields</h3>
<p>To test for the presence of a bit in a flag-based field, the following template supported by <code>get()</code> can be used:</p>
<p><code>state = object.get(&#39;flagfield.flagname&#39;)</code></p>
<p>For example:</p>
<p><code>state = surface.get(&#39;flags.visible&#39;)</code></p>
<p>If the named flag is set, a value of 1 is returned, otherwise 0.</p>
<p>To get the value of a flag or lookup field in string format, prefix the name of the field with a <code>$</code> symbol when using the <code>get()</code> method as follows:</p>
<p><code>name = object.get(&#39;$flags&#39;)</code></p>
<hr>
<h2 id="action--method-subscriptions">Action &amp; Method Subscriptions</h2>
<p>Parasol allows clients to monitor the calls made to an object by subscribing to its actions and methods. One commonly used strategy involves subscribing to the <code>free()</code> action of an object so that the client is notified of object termination.</p>
<p>Subscription is enabled via the <code>subscribe()</code> method. The following example illustrates the creation of an HTTP object that performs a download and calls <code>my_function()</code> on completion of the download process. Note that <code>Args</code> is a table that contains named arguments for the action that was subscribed to. The <code>CustomRef</code> is an optional value that will be passed to the subscriber.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> my_function<span class="op">(</span><span class="cn">UID</span><span class="op">,</span> <span class="va">Args</span><span class="op">,</span> <span class="va">CustomRef</span><span class="op">)</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Download complete.&#39;</span><span class="op">)</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="va">http</span> <span class="op">=</span> <span class="va">obj</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;http&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="op">...</span> <span class="op">}</span> <span class="op">)</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="va">http</span><span class="op">.</span>acActivate<span class="op">()</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="va">handle</span> <span class="op">=</span> <span class="va">http</span><span class="op">.</span>subscribe<span class="op">(</span><span class="st">&#39;deactivate&#39;</span><span class="op">,</span> <span class="va">my_function</span><span class="op">,</span> <span class="va">customref</span><span class="op">)</span></span></code></pre></div>
<p>To unsubscribe from an action, call <code>unsubscribe()</code> with the action/method name. Doing so will allow the garbage collector to remove associated resources that are no longer required.</p>
<hr>
<h2 id="processing-interface">Processing Interface</h2>
<p>The processing interface assists with the management of your program&#39;s idle state and reaction to signals. Its most basic feature is the commonly used <code>sleep()</code> function, as follows:</p>
<p><code>processing.sleep([Timeout], [WakeOnSignal=true])</code></p>
<p>Calling <code>sleep()</code> in this way will put the script to sleep until a message is received to awaken it. Typically this means that the function won&#39;t return until a <code>QUIT</code> message is received, which would be delivered if the user opts to close the main window.</p>
<p><code>sleep()</code> can also return early if a <code>Timeout</code> in seconds is specified in the first parameter. Waking on signal can be disabled by setting the second parameter to <code>false</code>.</p>
<h3 id="signals">Signals</h3>
<p>If a Fluid script is utilising threads, synchronisation can be an important issue that requires careful management. The processing interface makes it possible to put the main thread to sleep and wake it once a series of signals has been triggered. In the following working example, we create a basic thread that prints a message and then signals two XML objects in order to wake the main thread. This might be plausible if we were asking the thread to process XML data for instance:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> testSignals<span class="op">()</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">signal_a</span> <span class="op">=</span> <span class="va">obj</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;xml&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="va">flags</span><span class="op">=</span><span class="st">&#39;NEW&#39;</span> <span class="op">})</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">signal_b</span> <span class="op">=</span> <span class="va">obj</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;xml&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="va">flags</span><span class="op">=</span><span class="st">&#39;NEW&#39;</span> <span class="op">})</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Note that the thread code is parsed as a string and can&#39;t see any variables without a call to obj.find().</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- The termination handler on the other hand has access to signal the objects directly.</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>   <span class="va">thread</span><span class="op">.</span>script<span class="op">(</span><span class="vs">[[</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="vs">      msg(&#39;Thread is now in session.&#39;)</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="vs">   ]]</span><span class="op">,</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>   <span class="kw">function</span><span class="op">()</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>      msg<span class="op">(</span><span class="st">&#39;Thread has been executed.&#39;</span><span class="op">)</span></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a>      <span class="va">signal_a</span><span class="op">.</span>acSignal<span class="op">()</span></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a>      <span class="va">signal_b</span><span class="op">.</span>acSignal<span class="op">()</span></span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span><span class="op">)</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a>   <span class="va">proc</span> <span class="op">=</span> <span class="va">processing</span><span class="op">.</span>new<span class="op">({</span> <span class="va">timeout</span><span class="op">=</span><span class="dv">1.0</span><span class="op">,</span> <span class="va">signals</span> <span class="op">=</span> <span class="op">{</span> <span class="va">signal_a</span><span class="op">,</span> <span class="va">signal_b</span> <span class="op">}</span> <span class="op">})</span></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a>   msg<span class="op">(</span><span class="st">&#39;Sleeping....&#39;</span><span class="op">)</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a>   <span class="va">err</span> <span class="op">=</span> <span class="va">proc</span><span class="op">.</span>sleep<span class="op">()</span></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">assert</span><span class="op">(</span><span class="va">err</span> <span class="va">is</span> <span class="va">ERR_Okay</span><span class="op">,</span> <span class="st">&quot;Unexpected error: &quot;</span> <span class="op">..</span> <span class="va">mSys</span><span class="op">.</span>GetErrorMsg<span class="op">(</span><span class="va">err</span><span class="op">))</span></span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Notice that we called <code>processing.new()</code> to create a dedicated interface for signal management. The two objects that will be signalled are passed in via the <code>signals</code> field. When the thread completes, it calls <code>acSignal()</code> on the objects to change their signal state. It is necessary for both objects to change state in order to wake the main thread.</p>
<h4 id="signal">signal()</h4>
<p>If no signal objects are listed in a call to <code>processing.new()</code>, it is possible to manually call the <code>signal()</code> method to wake the sleeping thread instead. This simple technique is sometimes used in passive event systems, e.g. the user clicking a mouse button could result in a <code>signal()</code> call that wakes the main thread.</p>
<h4 id="flush">flush()</h4>
<p>The <code>flush()</code> method will clear pending signals associated with the script and processing object.</p>
<p>Using <code>flush()</code> is rarely necessary expect in special circumstances. For instance if a prior call to <code>sleep()</code> resulted in a timeout, clearing pending signals guarantees a fresh start.</p>
<h4 id="task">task()</h4>
<p>The <code>task()</code> function returns a Fluid object that references the current task:</p>
<p><code>currentTask = processing.task()</code></p>
<p>This function provides access to the task object representing your script&#39;s execution context. The returned object can be used to modify task properties such as process priority, which is useful for applications requiring consistent performance:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="va">task</span> <span class="op">=</span> <span class="va">processing</span><span class="op">.</span>task<span class="op">()</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">task</span> <span class="cf">then</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">task</span><span class="op">.</span>set<span class="op">(</span><span class="st">&#39;Priority&#39;</span><span class="op">,</span> <span class="dv">15</span><span class="op">)</span>  <span class="co">-- Set high priority for time-critical operations</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h4 id="delayedcall">delayedCall()</h4>
<p>Use <code>delayedCall()</code> to call a function on the next message processing cycle inside <code>processing.sleep()</code>. This is useful in situations where calling a function is necessary, but to do so immediately would cause logistical issues with the order of execution.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="va">processing</span><span class="op">.</span>delayedCall<span class="op">(</span><span class="kw">function</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;This message is appearing after being delayed.&#39;</span><span class="op">)</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span><span class="op">)</span></span></code></pre></div>
<h3 id="garbage-collector">Garbage Collector</h3>
<h4 id="processingcollect">processing.collect()</h4>
<p><code>processing.collect([Mode], [Options])</code></p>
<p>Controls the garbage collector. The optional <code>Mode</code> parameter specifies the collection mode:</p>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>full</code></td>
<td>Performs a full garbage collection cycle (default).</td>
</tr>
<tr>
<td><code>step</code></td>
<td>Performs an incremental collection step.</td>
</tr>
</tbody>
</table>
<p>The optional <code>Options</code> table supports the following fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stepSize</code></td>
<td>integer</td>
<td>Step size for incremental collection (only used with <code>&quot;step&quot;</code> mode).</td>
</tr>
</tbody>
</table>
<p>Returns an integer result from the underlying GC operation. The meaning varies by mode:</p>
<ul>
<li>For <code>&quot;step&quot;</code> mode: returns <code>1</code> if collection is not finished, <code>0</code> if finished</li>
<li>For other modes: returns <code>0</code> on success</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Full collection (default)</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="va">processing</span><span class="op">.</span>collect<span class="op">()</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="va">processing</span><span class="op">.</span>collect<span class="op">(</span><span class="st">&quot;full&quot;</span><span class="op">)</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Incremental step collection</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">processing</span><span class="op">.</span>collect<span class="op">(</span><span class="st">&quot;step&quot;</span><span class="op">,</span> <span class="op">{</span> <span class="va">stepSize</span> <span class="op">=</span> <span class="dv">100</span> <span class="op">})</span></span></code></pre></div>
<h4 id="processingstartcollector">processing.startCollector()</h4>
<p>Starts the automatic garbage collector if it is not already running. The garbage collector runs in the background and will periodically reclaim memory used by unreferenced objects.</p>
<h4 id="processingstopcollector">processing.stopCollector()</h4>
<p>Stops the automatic garbage collector. When called, it will cease to reclaim memory until <code>startCollector()</code> is called again.</p>
<h4 id="processinggcstats">processing.gcStats()</h4>
<p><code>stats = processing.gcStats()</code></p>
<p>Returns a table containing garbage collector statistics. This is useful for monitoring memory usage and GC behaviour.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>memoryKB</code></td>
<td>integer</td>
<td>Memory usage in kilobytes.</td>
</tr>
<tr>
<td><code>memoryBytes</code></td>
<td>integer</td>
<td>Remainder bytes (total bytes = memoryKB × 1024 + memoryBytes).</td>
</tr>
<tr>
<td><code>memoryMB</code></td>
<td>number</td>
<td>Total memory usage in megabytes (convenience field).</td>
</tr>
<tr>
<td><code>isRunning</code></td>
<td>boolean</td>
<td><code>true</code> if the garbage collector is currently running.</td>
</tr>
<tr>
<td><code>pause</code></td>
<td>integer</td>
<td>Current pause multiplier (controls GC frequency, default 200).</td>
</tr>
<tr>
<td><code>stepMul</code></td>
<td>integer</td>
<td>Current step multiplier (controls GC speed, default 200).</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="va">stats</span> <span class="op">=</span> <span class="va">processing</span><span class="op">.</span>gcStats<span class="op">()</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;Memory: {stats.memoryMB} MB&quot;</span><span class="op">)</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;GC Running: {stats.isRunning}&quot;</span><span class="op">)</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;Pause: {stats.pause}, StepMul: {stats.stepMul}&quot;</span><span class="op">)</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Monitor memory before and after allocation</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="va">before</span> <span class="op">=</span> <span class="va">processing</span><span class="op">.</span>gcStats<span class="op">().</span><span class="va">memoryMB</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="op">{}</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="kw">in</span> <span class="op">{</span><span class="dv">0..10000</span><span class="op">}</span> <span class="cf">do</span> <span class="va">t</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu">string.rep</span><span class="op">(</span><span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="dv">100</span><span class="op">)</span> <span class="cf">end</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="va">after</span> <span class="op">=</span> <span class="va">processing</span><span class="op">.</span>gcStats<span class="op">().</span><span class="va">memoryMB</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;Allocated: {after - before} MB&quot;</span><span class="op">)</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Clean up and verify</span></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="kw">nil</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="va">processing</span><span class="op">.</span>collect<span class="op">()</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="va">final</span> <span class="op">=</span> <span class="va">processing</span><span class="op">.</span>gcStats<span class="op">().</span><span class="va">memoryMB</span></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;After collection: {final} MB&quot;</span><span class="op">)</span></span></code></pre></div>
<hr>
<h2 id="math-interface">Math Interface</h2>
<h3 id="mathround">math.round()</h3>
<p><code>math.round(Num, [DecimalPlaces])</code></p>
<p>Round floating point <code>Num</code> to the nearest integer. If <code>DecimalPlaces</code> is specified then the function will round to the place indicated. For example <code>math.round(8.2468,2)</code> rounds to <code>8.25</code>.</p>
<hr>
<h2 id="strings-interface">Strings Interface</h2>
<p>The Lua-based strings interface is extended with a number of useful functions that are commonly required in programming. The following functions are included:</p>
<h3 id="stringalloc">string.alloc()</h3>
<p><code>str = string.alloc(Size)</code></p>
<p>Create a string of a given size in bytes. This feature is intended for creating sized data buffers that can be passed to Parasol interfaces.</p>
<h3 id="stringcap">string.cap()</h3>
<p><code>str:cap()</code></p>
<p>Recreate a string with the first character in upper case.</p>
<h3 id="stringdecap">string.decap()</h3>
<p><code>str:decap()</code></p>
<p>Recreate a string with the first character in lower case.</p>
<h3 id="stringescxml">string.escXML()</h3>
<p><code>str:escXML()</code></p>
<p>Escape <code>str</code> for an XML attribute value or content.</p>
<h3 id="stringhash">string.hash()</h3>
<p><code>hash = str:hash([CaseSensitive])</code></p>
<p>Return a hash value for the string. The <code>CaseSensitive</code> parameter is optional and defaults to <code>false</code>.</p>
<h3 id="stringjoin">string.join()</h3>
<p><code>str:join(Table, Separator)</code></p>
<p>Join the contents of <code>Table</code> into a single string, using <code>Separator</code> between each item. If <code>Separator</code> is not specified, the items are joined consecutively.</p>
<h3 id="stringtrim">string.trim()</h3>
<p><code>str:trim()</code></p>
<p>Trims whitespace from the left and right sides of a string.</p>
<h3 id="stringrtrim">string.rtrim()</h3>
<p><code>str:rtrim()</code></p>
<p>Trims whitespace from the right side of a string.</p>
<h3 id="stringsplit">string.split()</h3>
<p><code>str:split([Pattern])</code></p>
<p>Split a string using <code>Pattern</code> to identify each valid word. If Pattern is not specified, it defaults to <code>%s</code>.</p>
<h3 id="stringstartswith">string.startsWith()</h3>
<p><code>str:startsWith(Cmp)</code></p>
<p>Returns <code>true</code> if the string starts with <code>Cmp</code>.</p>
<h3 id="stringendswith">string.endsWith()</h3>
<p><code>str:endsWith(Cmp)</code></p>
<p>Returns <code>true</code> if the string ends with <code>Cmp</code>.</p>
<hr>
<h2 id="thread-interface">Thread Interface</h2>
<p>Fluid supports a simplified threading model so as to minimise the potential problems occurring from their use. The functionality is as follows:</p>
<h3 id="threadscriptstatement-callback">thread.script(Statement, Callback)</h3>
<p>The <code>script()</code> method compiles a statement string and executes it in a separate script state. The code may not directly share variables with its creator, but it can find existing objects and interact with them by calling <code>obj.find()</code>.</p>
<p>The <code>Callback</code> parameter is a function that will be executed once the threaded script has returned. It executes in the space of the caller and not the thread itself, which means it can access local variables safely.</p>
<pre><code>thread.script([[
   print(&#39;Thread is now in session.&#39;)
]],
function()
   print(&#39;Thread has finished executing.&#39;)
end)</code></pre>
<h3 id="threadactionmethodobject-action-callback-key-args">thread.action|method(Object, Action, Callback, Key, Args...)</h3>
<p>The <code>thread.action()</code> and <code>thread.method()</code> interfaces provide a convenient means of executing an object function in a separate thread. There is some overhead in executing a new thread, but this strategy becomes highly effective when used to perform lengthy processes such as the loading and parsing of data.</p>
<p>Here&#39;s an example that reads the first 1Kb of data from a file and prints the content:</p>
<pre><code>function on_complete(Action, File, Error, Buffer)
   print(&#39;Read string: &#39; .. Buffer)
   File.free()
end

str_buffer = string.rep(1024)
thread.action(file, AC_Read, on_complete, str_buffer, str_buffer)
processing.sleep()</code></pre>
<p>The <code>Action</code> parameter is accepted as an action ID (fast) or a string (slower). The <code>Key</code> makes it possible to pass a custom parameter to the callback, and can be used to pass multiple parameters if a table is used.</p>
<p>The <code>Callback</code> routine receives notification of the thread&#39;s completion, and in this example uses this as an opportunity to free the file object. This is a recommended pattern, and ensures that the target object is not destroyed while the thread is executing. Never declare the object value as <code>local</code>.</p>
<p>Internally, callbacks are executed on the next message processing cycle and this is why a call to <code>processing.sleep()</code> is used in this example.</p>
<p>The <code>Error</code> parameter in the callback reflects the <code>ERR</code> code returned by the action - but bear in mind the possibility that if thread preparation fails, the callback will never be executed and an exception will be thrown instead.</p>
<hr>
<h2 id="structure-interface">Structure Interface</h2>
<p>The structure interface is provided so that Fluid can use C/C++ structures declared in the Parasol API. You will find that many class and module API&#39;s use structures for returning condensed information.</p>
<h3 id="creating-a-structure">Creating a Structure</h3>
<p>Structures are created using the struct interface&#39;s <code>new()</code> method. The prototype is as follows:</p>
<p><code>newstruct = struct.new(struct_def, [address])</code></p>
<p>The struct_def is a reference to a named structure definition declared in the Parasol API, or one returned from <code>MAKESTRUCT()</code>. The address is an optional setting for linking a struct to an existing pointer rather than allocating an empty memory block for the structure. Example:</p>
<p><code>xmltag = struct.new(&#39;XMLTag&#39;, address)</code></p>
<p>It is possible to manually change the address pointer that is assigned to a struct - this saves on having to create a struct object for every address to be processed. Example:</p>
<p><code>oldaddress = xmltag.ptr(NewAddress)</code></p>
<p>To retrieve the current address:</p>
<p><code>address = xmltag.ptr()</code></p>
<p>Note that nil is returned if the address is set to zero.</p>
<h3 id="additional-functionality">Additional Functionality</h3>
<p>The byte size of a structure can be retrieved with the <code>structsize()</code> method, for example:</p>
<p><code>print(&#39;The size of the structure is &#39; .. xmltag.structsize())</code></p>
<p>To get the total number of fields in the structure, use <code>#</code>, e.g. <code>#xmltag</code>.</p>
<h3 id="custom-structures">Custom Structures</h3>
<p>The <code>MAKESTRUCT()</code> function is used to build structure definitions. A structure definition is a single string that defines all fields in a structure, matched in the order in which they appear in the structure. Consider the following C structure:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="va">struct</span> XMLTag <span class="op">{</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">int</span>    <span class="va">Index</span><span class="op">;</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">int</span>    <span class="cn">ID</span><span class="op">;</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>   <span class="va">XMLTag</span> <span class="op">*</span><span class="va">Child</span><span class="op">;</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>   <span class="va">XMLTag</span> <span class="op">*</span><span class="va">Prev</span><span class="op">;</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>   <span class="va">XMLTag</span> <span class="op">*</span><span class="va">Next</span><span class="op">;</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>   <span class="cn">APTR</span>   <span class="va">Private</span><span class="op">;</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>   <span class="va">XMLAttrib</span> <span class="op">*</span><span class="va">Attrib</span><span class="op">;</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>   <span class="va">int16_t</span>  <span class="va">TotalAttrib</span><span class="op">;</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>   <span class="va">uint16_t</span> <span class="va">Nest</span><span class="op">;</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>To define this structure in Fluid we would use the following code:</p>
<p><code>MAKESTRUCT(&#39;XMLTag&#39;, &#39;lIndex,lID,pChild,pPrev:XMLTag,pNext:XMLTag,pPrivate,pAttrib,wTotalAttrib,uwNest&#39;)</code></p>
<p>Notice that each field name is defined using the same order and names as identified in the structure. Each name is prefixed with a lower-case character that indicates the field type. Using the correct field types is the most crucial part of the structure definition and each must be chosen from the following table:</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>Field Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>l</td>
<td>Integer (32-bit)</td>
</tr>
<tr>
<td>d</td>
<td>Double (64-bit)</td>
</tr>
<tr>
<td>x</td>
<td>Integer (64-bit)</td>
</tr>
<tr>
<td>f</td>
<td>Float (32-bit)</td>
</tr>
<tr>
<td>w</td>
<td>Integer (16-bit)</td>
</tr>
<tr>
<td>c</td>
<td>Char (8-bit)</td>
</tr>
<tr>
<td>p</td>
<td>Pointer. You can use &#39;:StructName&#39; as a suffix to reference other structures.</td>
</tr>
<tr>
<td>s</td>
<td>String</td>
</tr>
<tr>
<td>o</td>
<td>Object (Pointer)</td>
</tr>
<tr>
<td>u</td>
<td>Unsigned (Use in conjunction with a type)</td>
</tr>
</tbody>
</table>
<p>Fixed arrays are also permitted in the structure definition if a field name is followed with enclosed square brackets that contain the array size, e.g. <code>[12]</code>.</p>
<hr>
<h2 id="regular-expression-interface">Regular Expression Interface</h2>
<p>The regular expression interface provides compiled regex objects for high-performance pattern matching and text manipulation. Unlike Lua&#39;s basic pattern matching, the regex interface offers full PCRE-compatible regular expression support through compiled objects that can be created once and reused multiple times.</p>
<p>For more information on our regex implementation, please refer to our <a href="./Regex-Manual">Regex Manual</a>.</p>
<h3 id="creating-a-regex">Creating a Regex</h3>
<p>To create a compiled regex object, use the <code>new()</code> method with the following prototype:</p>
<p><code>myregex = regex.new(Pattern, [Flags])</code></p>
<p>The <code>Pattern</code> is a string containing the regular expression pattern to compile. The optional <code>Flags</code> parameter can be used to modify regex behaviour using the flag constants described below.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Simple pattern</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="va">digits</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;</span><span class="sc">\\</span><span class="st">d+&#39;</span><span class="op">)</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Case insensitive pattern</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="va">email</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;[</span><span class="sc">\\</span><span class="st">w._%+-]+@[</span><span class="sc">\\</span><span class="st">w.-]+</span><span class="sc">\\</span><span class="st">.[A-Za-z]{2,}&#39;</span><span class="op">,</span> <span class="va">regex</span><span class="op">.</span><span class="cn">ICASE</span><span class="op">)</span></span></code></pre></div>
<p>If the provided pattern is invalid, an error will be raised. For this reason it is advisable to use <code>try</code> when creating regex objects that use untested patterns, e.g. from user input.</p>
<h3 id="flag-constants">Flag Constants</h3>
<h4 id="compilation-flags">Compilation Flags</h4>
<p>The following flags can be combined to modify regex compilation:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>regex.ICASE</code></td>
<td>Case insensitive matching</td>
</tr>
<tr>
<td><code>regex.MULTILINE</code></td>
<td>^ and $ match line boundaries</td>
</tr>
<tr>
<td><code>regex.DOTALL</code></td>
<td>. matches newlines</td>
</tr>
</tbody>
</table>
<p>Flags can be combined using addition: <code>regex.ICASE + regex.MULTILINE</code>.</p>
<h4 id="match-flags">Match Flags</h4>
<p>The following flags can be used with the optional <code>flags</code> parameter in <code>test()</code>, <code>match()</code>, <code>search()</code>, <code>replace()</code>, and <code>split()</code> methods:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>regex.NOT_BEGIN_OF_LINE</code></td>
<td>Do not treat the beginning of text as start of line</td>
</tr>
<tr>
<td><code>regex.NOT_END_OF_LINE</code></td>
<td>Do not treat the end of text as end of line</td>
</tr>
<tr>
<td><code>regex.NOT_BEGIN_OF_WORD</code></td>
<td>Do not treat the beginning of text as start of word</td>
</tr>
<tr>
<td><code>regex.NOT_END_OF_WORD</code></td>
<td>Do not treat the end of text as end of word</td>
</tr>
<tr>
<td><code>regex.NOT_NULL</code></td>
<td>Do not match empty sequences</td>
</tr>
<tr>
<td><code>regex.CONTINUOUS</code></td>
<td>Only match at the beginning of text</td>
</tr>
<tr>
<td><code>regex.PREV_AVAILABLE</code></td>
<td>Previous character is available for look-behind</td>
</tr>
<tr>
<td><code>regex.REPLACE_NO_COPY</code></td>
<td>Do not copy non-matching parts in replace operations</td>
</tr>
<tr>
<td><code>regex.REPLACE_FIRST_ONLY</code></td>
<td>Replace only the first occurrence</td>
</tr>
</tbody>
</table>
<p>Example usage:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="va">wordRegex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;</span><span class="sc">\\</span><span class="st">w+&#39;</span><span class="op">)</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- Replace only the first word</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">wordRegex</span><span class="op">.</span>replace<span class="op">(</span><span class="st">&#39;hello world&#39;</span><span class="op">,</span> <span class="st">&#39;goodbye&#39;</span><span class="op">,</span> <span class="va">regex</span><span class="op">.</span><span class="cn">REPLACE_FIRST_ONLY</span><span class="op">)</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Result: &#39;goodbye world&#39;</span></span></code></pre></div>
<h3 id="pattern-testing">Pattern Testing</h3>
<p>Use the <code>test()</code> method to perform boolean pattern matching:</p>
<p><code>result = myregex.test(text, [flags])</code></p>
<p>This returns <code>true</code> if the pattern matches anywhere in the text, <code>false</code> otherwise.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="va">phoneRegex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;</span><span class="sc">\\</span><span class="st">d{3}-</span><span class="sc">\\</span><span class="st">d{3}-</span><span class="sc">\\</span><span class="st">d{4}&#39;</span><span class="op">)</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">phoneRegex</span><span class="op">.</span>test<span class="op">(</span><span class="va">userInput</span><span class="op">)</span> <span class="cf">then</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Valid phone number format&#39;</span><span class="op">)</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h3 id="pattern-matching-with-capture-groups">Pattern Matching with Capture Groups</h3>
<p>Use the <code>match()</code> method to perform a whole-string match and return capture groups:</p>
<p><code>matches = myregex.match(text, [flags])</code></p>
<p>Returns an array containing the full match and any capture groups, or <code>nil</code> if no match is found. Array indices start at 1 (full match), with capture groups at indices 2, 3, etc.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="va">urlRegex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;(https?)://([^/]+)(.*)&#39;</span><span class="op">)</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="va">matches</span> <span class="op">=</span> <span class="va">urlRegex</span><span class="op">.</span>match<span class="op">(</span><span class="st">&#39;https://example.com/path&#39;</span><span class="op">)</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- matches[1] = &#39;https://example.com/path&#39; (full match)</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- matches[2] = &#39;https&#39; (first capture group)</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- matches[3] = &#39;example.com&#39; (second capture group)</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- matches[4] = &#39;/path&#39; (third capture group)</span></span></code></pre></div>
<h3 id="global-matching">Global Matching</h3>
<p>Use the <code>search()</code> method to find all matches in the text:</p>
<p><code>allMatches = myregex.search(text, [flags])</code></p>
<p>Returns an array where each element is a match array (as returned by <code>match()</code>), or <code>nil</code> if no matches are found.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="va">wordRegex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;(</span><span class="sc">\\</span><span class="st">w+)&#39;</span><span class="op">)</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="va">allWords</span> <span class="op">=</span> <span class="va">wordRegex</span><span class="op">.</span>search<span class="op">(</span><span class="st">&#39;hello world test&#39;</span><span class="op">)</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- allWords[1][1] = &#39;hello&#39;, allWords[1][2] = &#39;hello&#39;</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- allWords[2][1] = &#39;world&#39;, allWords[2][2] = &#39;world&#39;</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- allWords[3][1] = &#39;test&#39;, allWords[3][2] = &#39;test&#39;</span></span></code></pre></div>
<h3 id="string-replacement">String Replacement</h3>
<p>Use the <code>replace()</code> method to replace all occurrences of a pattern:</p>
<p><code>result = myregex.replace(text, replacement, [flags])</code></p>
<p>Replacement strings support backreferences using <code>$1</code>, <code>$2</code>, etc., to reference capture groups.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="va">phoneRegex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;(</span><span class="sc">\\</span><span class="st">d{3})-(</span><span class="sc">\\</span><span class="st">d{3})-(</span><span class="sc">\\</span><span class="st">d{4})&#39;</span><span class="op">)</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="va">formatted</span> <span class="op">=</span> <span class="va">phoneRegex</span><span class="op">.</span>replace<span class="op">(</span><span class="st">&#39;555-123-4567&#39;</span><span class="op">,</span> <span class="st">&#39;($1) $2-$3&#39;</span><span class="op">)</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Result: &#39;(555) 123-4567&#39;</span></span></code></pre></div>
<h3 id="pattern-based-splitting">Pattern-Based Splitting</h3>
<p>Use the <code>split()</code> method to split text using the regex pattern as a delimiter:</p>
<p><code>parts = myregex.split(text, [flags])</code></p>
<p>Returns an array containing the split parts (empty strings are excluded).</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="va">csvRegex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;</span><span class="sc">\\</span><span class="st">s*,</span><span class="sc">\\</span><span class="st">s*&#39;</span><span class="op">)</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="va">fields</span> <span class="op">=</span> <span class="va">csvRegex</span><span class="op">.</span>split<span class="op">(</span><span class="st">&#39;apple, banana,  cherry&#39;</span><span class="op">)</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- fields[1] = &#39;apple&#39;, fields[2] = &#39;banana&#39;, fields[3] = &#39;cherry&#39;</span></span></code></pre></div>
<h3 id="regex-properties">Regex Properties</h3>
<p>Compiled regex objects provide the following read-only properties:</p>
<ul>
<li><code>pattern</code>: The original pattern string</li>
<li><code>flags</code>: The compilation flags used</li>
<li><code>error</code>: Error message if compilation failed (only available in internal error states)</li>
</ul>
<div class="sourceCode" id="cb157"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="va">myregex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;</span><span class="sc">\\</span><span class="st">d+&#39;</span><span class="op">)</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">&#39;Pattern: &#39;</span> <span class="op">..</span> <span class="va">myregex</span><span class="op">.</span><span class="va">pattern</span><span class="op">)</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">&#39;Flags: &#39;</span> <span class="op">..</span> <span class="va">myregex</span><span class="op">.</span><span class="va">flags</span><span class="op">)</span></span></code></pre></div>
<p><strong>Note</strong>: Invalid regex patterns will raise an error during construction. Use <code>try</code> to handle potential compilation errors:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">myregex</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="va">try</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">myregex</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;[invalid&#39;</span><span class="op">)</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="va">except</span> <span class="va">ex</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Regex compilation failed: &#39;</span> <span class="op">..</span> <span class="va">ex</span><span class="op">.</span><span class="va">message</span><span class="op">)</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h3 id="performance-considerations">Performance Considerations</h3>
<p>Regex objects are compiled once and can be reused many times, making them significantly more efficient than traditional string matching for complex patterns. Store frequently used regex objects in variables rather than recreating them:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Efficient: compile once, use many times</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="va">emailValidator</span> <span class="op">=</span> <span class="va">regex</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;^[</span><span class="sc">\\</span><span class="st">w._%+-]+@[</span><span class="sc">\\</span><span class="st">w.-]+</span><span class="sc">\\</span><span class="st">.[A-Za-z]{2,}$&#39;</span><span class="op">)</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="cn">_</span><span class="op">,</span> <span class="va">email</span> <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span><span class="va">emailList</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">emailValidator</span><span class="op">.</span>test<span class="op">(</span><span class="va">email</span><span class="op">)</span> <span class="cf">then</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>      processEmail<span class="op">(</span><span class="va">email</span><span class="op">)</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<hr>
<h2 id="array-interface">Array Interface</h2>
<p>Fluid includes a native array interface that is fully integrated with the JIT compiler. We strongly recommend its use for the storage of sequentially arranged data, and that tables are avoided for that use case.</p>
<p>Arrays are typed containers that store elements of a single primitive type. They provide efficient storage and direct memory access, making them ideal for numerical computations, buffer management, and interoperability with C/C++ APIs.</p>
<h3 id="table-compatibility">Table Compatibility</h3>
<p>Arrays are largely compatible with tables so that they may be used interchangeably in code. In particular the <code>ipairs()</code>, <code>pairs()</code> and <code>values()</code> functions behave identically for both types. Numeric indexes on tables and arrays function identically.</p>
<h3 id="array-syntax">Array Syntax</h3>
<p>Fluid provides concise syntax for creating typed arrays using the <code>array&lt;type&gt;</code> pattern:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="fu">type</span><span class="op">&gt;</span>                         <span class="co">-- Empty array of specified type</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="fu">type</span><span class="op">,</span> <span class="va">size</span><span class="op">&gt;</span>                   <span class="co">-- Pre-allocated array with size elements</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="fu">type</span><span class="op">&gt;</span> <span class="op">{</span> <span class="va">v1</span><span class="op">,</span> <span class="va">v2</span><span class="op">,</span> <span class="op">...</span> <span class="op">}</span>         <span class="co">-- Array initialised with values</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="fu">type</span><span class="op">,</span> <span class="va">size</span><span class="op">&gt;</span> <span class="op">{</span> <span class="va">v1</span><span class="op">,</span> <span class="va">v2</span><span class="op">,</span> <span class="op">...</span> <span class="op">}</span>   <span class="co">-- Pre-allocated with initial values</span></span></code></pre></div>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb161"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create typed arrays with concise syntax</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="va">numbers</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="va">names</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">,</span> <span class="dv">100</span><span class="op">&gt;</span>  <span class="co">-- Pre-allocate 100 string slots</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="va">points</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">table</span><span class="op">&gt;</span> <span class="op">{</span> <span class="op">{</span><span class="va">x</span><span class="op">=</span><span class="dv">0</span><span class="op">,</span> <span class="va">y</span><span class="op">=</span><span class="dv">0</span><span class="op">},</span> <span class="op">{</span><span class="va">x</span><span class="op">=</span><span class="dv">1</span><span class="op">,</span> <span class="va">y</span><span class="op">=</span><span class="dv">1</span><span class="op">}</span> <span class="op">}</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Chain methods directly on the result</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span> <span class="op">}:</span><span class="fu">concat</span><span class="op">(</span><span class="st">&#39;%d&#39;</span><span class="op">,</span> <span class="st">&#39;, &#39;</span><span class="op">)</span>  <span class="co">-- Returns &#39;1, 2, 3&#39;</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Pre-allocated with initial values (size &gt; values count)</span></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a><span class="va">buffer</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">10</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span> <span class="op">}</span>  <span class="co">-- {1, 2, 3, 0, 0, 0, 0, 0, 0, 0}</span></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- Dynamic size expression with variables and functions</span></span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a><span class="va">n</span> <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="va">n</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">200</span> <span class="op">}</span>  <span class="co">-- {100, 200, 0, 0, 0, 0, 0, 0}</span></span></code></pre></div>
<p>When both a size and initial values are provided, the array is first initialised with the values, then resized to the specified size. If the size is larger than the number of values, the remaining elements are zero-initialised (or <code>nil</code> for reference types like strings and tables). If the size is smaller than the number of values, the values take precedence and the size is effectively ignored.</p>
<p><strong>Supported Element Types:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Size</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>byte</code></td>
<td>1</td>
<td>Unsigned 8-bit integer (0-255)</td>
</tr>
<tr>
<td><code>int16</code></td>
<td>2</td>
<td>Signed 16-bit integer</td>
</tr>
<tr>
<td><code>int</code></td>
<td>4</td>
<td>Signed 32-bit integer</td>
</tr>
<tr>
<td><code>int64</code></td>
<td>8</td>
<td>Signed 64-bit integer</td>
</tr>
<tr>
<td><code>float</code></td>
<td>4</td>
<td>32-bit floating point</td>
</tr>
<tr>
<td><code>double</code></td>
<td>8</td>
<td>64-bit floating point</td>
</tr>
<tr>
<td><code>string</code></td>
<td>8</td>
<td>String reference</td>
</tr>
<tr>
<td><code>struct</code></td>
<td>varies</td>
<td>Structure reference</td>
</tr>
<tr>
<td><code>table</code></td>
<td>varies</td>
<td>Table reference</td>
</tr>
<tr>
<td><code>array</code></td>
<td>varies</td>
<td>Array reference (use for creating multi-dimensional arrays)</td>
</tr>
<tr>
<td><code>any</code></td>
<td>16</td>
<td>Any type from the above (note: convenience comes at a cost of efficiency)</td>
</tr>
<tr>
<td><code>pointer</code></td>
<td>8</td>
<td>Memory pointer (unavailable for client use)</td>
</tr>
</tbody>
</table>
<h3 id="arraynew">array.new()</h3>
<div class="sourceCode" id="cb162"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>new<span class="op">(</span><span class="va">Size</span><span class="op">,</span> <span class="va">Type</span><span class="op">)</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>new<span class="op">(</span><span class="va">String</span><span class="op">)</span></span></code></pre></div>
<p>The traditional <code>array &lt;&gt;</code> syntax is syntactic sugar that desugars to <code>array.new()</code> and <code>array.of()</code> calls. We recommend against calling <code>array.new()</code> directly unless an edge case makes it necessary. There is however, one unique feature in that passing a string to <code>array.new()</code> will create a byte array from the string&#39;s contents.</p>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a 100-element integer array</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="va">int_arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>new<span class="op">(</span><span class="dv">100</span><span class="op">,</span> <span class="st">&#39;int&#39;</span><span class="op">)</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create an array from a string (each byte becomes an element)</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="va">byte_arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;Hello World&#39;</span><span class="op">)</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create an empty array (useful for dynamic filling)</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="va">empty_arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>new<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="st">&#39;double&#39;</span><span class="op">)</span></span></code></pre></div>
<h3 id="arrayof">array.of()</h3>
<div class="sourceCode" id="cb164"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>of<span class="op">(</span><span class="va">Type</span><span class="op">,</span> <span class="va">Value1</span><span class="op">,</span> <span class="va">Value2</span><span class="op">,</span> <span class="op">...)</span></span></code></pre></div>
<p>As for <code>array.new()</code>, calling <code>array.of()</code> is not recommended unless an edge case requires it. Calling <code>array.of()</code> will populate a new array with the given values. <code>Type</code> is the element type. The remaining arguments are the values to populate the array with. At least one value must be provided.</p>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create a string array with two domain names</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="va">domains</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>of<span class="op">(</span><span class="st">&#39;string&#39;</span><span class="op">,</span> <span class="st">&#39;google.com&#39;</span><span class="op">,</span> <span class="st">&#39;amazon.co.uk&#39;</span><span class="op">)</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Mixed types</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>of<span class="op">(</span><span class="st">&#39;any&#39;</span><span class="op">,</span> <span class="dv">42</span><span class="op">,</span> <span class="st">&#39;hello&#39;</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="kw">nil</span><span class="op">,</span> <span class="op">{</span> <span class="va">x</span> <span class="op">=</span> <span class="dv">10</span> <span class="op">})</span></span></code></pre></div>
<h3 id="array-indexes">Array Indexes</h3>
<p>Array elements are accessed using zero-based indexing:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">10</span><span class="op">&gt;</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">100</span>    <span class="co">-- Set first element</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="dv">999</span>    <span class="co">-- Set last element</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="va">value</span> <span class="op">=</span> <span class="va">arr</span><span class="op">[</span><span class="dv">5</span><span class="op">]</span>  <span class="co">-- Read element at index 5</span></span></code></pre></div>
<p>The <code>#</code> operator returns the array length:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="va">total</span> <span class="op">=</span> <span class="op">#</span><span class="va">arr</span>    <span class="co">-- Returns 10</span></span></code></pre></div>
<h3 id="arraytype">array.type()</h3>
<p>Returns the element type of the array as a string.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">float</span><span class="op">,</span> <span class="dv">10</span><span class="op">&gt;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">arr</span><span class="op">:</span><span class="fu">type</span><span class="op">())</span>  <span class="co">-- Prints &#39;float&#39;</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="va">byte_arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;test&#39;</span><span class="op">)</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">byte_arr</span><span class="op">:</span><span class="fu">type</span><span class="op">())</span>  <span class="co">-- Prints &#39;char&#39;</span></span></code></pre></div>
<h3 id="arrayreadonly">array.readOnly()</h3>
<p>Returns <code>true</code> if the array is read-only, <code>false</code> otherwise. Read-only arrays are typically created by the system when wrapping external memory buffers.</p>
<h3 id="arraytable">array.table()</h3>
<p>Returns a copy of the array in table format.</p>
<h3 id="array-manipulation-methods">Array Manipulation Methods</h3>
<h4 id="arraypush">array.push()</h4>
<p><code>length = arr:push(Value, ...)</code></p>
<p>Appends one or more elements to the end of the array, growing capacity as needed. Returns the new length of the array. Arrays grow automatically when pushing beyond current capacity.</p>
<p>External arrays (wrapping C/C++ memory) cannot grow and will raise an error. Type validation is performed; pushing incompatible types raises an error. Calling <code>push()</code> with no arguments returns the current length without modification.</p>
<h4 id="arraypop">array.pop()</h4>
<p><code>value = arr:pop([Count])</code></p>
<p>Removes and returns the last element(s) from the array. <code>Count</code> indicates the number of elements to pop (defaults to 1). Returns <code>nil</code> if the array is empty.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">,</span> <span class="va">b</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>pop<span class="op">(</span><span class="dv">2</span><span class="op">)</span>  <span class="co">-- a = 5, b = 4, arr = {1, 2, 3}</span></span></code></pre></div>
<p>Pop returns <code>nil</code> if used on an empty array. When popping GC-tracked types (strings, tables), the reference is cleared to allow garbage collection. Read-only arrays cannot be popped.</p>
<h4 id="arrayclear">array.clear()</h4>
<p><code>arr:clear()</code></p>
<p>Resets the array length to zero without deallocating storage. The capacity is preserved for efficient reuse.</p>
<p>For GC-tracked types (strings, tables), references are nullified to allow garbage collection. Read-only arrays cannot be cleared. Use <code>fill(0)</code> if the intention is to clear a newly allocated array.</p>
<h4 id="arrayresize">array.resize()</h4>
<p><code>new_length = arr:resize(NewSize)</code></p>
<p>Resizes an array to the specified length, growing or shrinking as needed. Returns the new length of the array.</p>
<p>When growing, new elements are zero-initialised for numeric types, or set to <code>nil</code> for reference types (strings, tables). When shrinking, excess elements are discarded and references are cleared for garbage collection.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span> <span class="op">}</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="va">array</span><span class="op">.</span>resize<span class="op">(</span><span class="va">arr</span><span class="op">,</span> <span class="dv">7</span><span class="op">)</span>  <span class="co">-- arr = {1, 2, 3, 0, 0, 0, 0}</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="va">array</span><span class="op">.</span>resize<span class="op">(</span><span class="va">arr</span><span class="op">,</span> <span class="dv">2</span><span class="op">)</span>  <span class="co">-- arr = {1, 2}</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="va">array</span><span class="op">.</span>resize<span class="op">(</span><span class="va">arr</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span>  <span class="co">-- arr = {} (equivalent to clear)</span></span></code></pre></div>
<p>External arrays (wrapping C/C++ memory) and cached string arrays cannot grow and will raise an error. Read-only arrays cannot be resized.</p>
<h4 id="arrayfill">array.fill()</h4>
<pre><code>arr:fill(Value, [Start], [Count])
arr:fill(Value, Range)</code></pre>
<p>Fills array elements with a value. <code>Value</code> is the value to fill with. <code>Start</code> is a starting index (default: 0). <code>Count</code> is the number of elements to fill (default: all remaining). <code>Range</code> is a range object specifying which elements to fill.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">10</span><span class="op">&gt;</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>fill<span class="op">(</span><span class="dv">0</span><span class="op">)</span> <span class="co">-- Fill entire array with zeros</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>fill<span class="op">(</span><span class="dv">99</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">)</span> <span class="co">-- Fill elements 3-7 with value 99</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>fill<span class="op">(</span><span class="dv">42</span><span class="op">,</span> <span class="op">{</span><span class="dv">2..6</span><span class="op">})</span>   <span class="co">-- Fills indices 2, 3, 4, 5</span></span></code></pre></div>
<h4 id="arrayinsert">array.insert()</h4>
<p><code>newLength = arr:insert(Index, Value, ...)</code></p>
<p>Inserts one or more values at the specified index, shifting subsequent elements to make room. The array grows automatically if needed.
<code>Index</code> refers to the position to insert at. Must be between 0 and the array length (inclusive). <code>Value</code> is one or more values to insert, which must match the array&#39;s element type.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Insert multiple values</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span><span class="fu">insert</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">)</span>  <span class="co">-- arr = {1, 2, 3, 4, 5}</span></span></code></pre></div>
<h4 id="arrayremove">array.remove()</h4>
<p><code>newLength = arr:remove(Index [, Count])</code></p>
<p>Removes one or more elements at the specified <code>Index</code>, shifting subsequent elements down. Count is the number of elements to remove (defaults to 1) and is automatically limited to available elements.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Remove multiple elements</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span><span class="fu">remove</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">)</span>  <span class="co">-- arr = {1, 5}, returns 2</span></span></code></pre></div>
<p>A <code>Count</code> of 0 does nothing and returns the current length. Negative <code>Count</code> values raise an error.</p>
<h4 id="arrayreverse">array.reverse()</h4>
<p><code>arr:reverse()</code></p>
<p>Reverses the array elements in place.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">5</span><span class="op">&gt;</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">4</span> <span class="cf">do</span> <span class="va">arr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">i</span> <span class="cf">end</span>  <span class="co">-- {0, 1, 2, 3, 4}</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span><span class="fu">reverse</span><span class="op">()</span>                   <span class="co">-- {4, 3, 2, 1, 0}</span></span></code></pre></div>
<h3 id="arraysort">array.sort()</h3>
<p><code>arr:sort([Descending])</code></p>
<p>Sorts the array elements in place. If <code>Descending</code> is <code>true</code>, sort in descending order (default: <code>false</code> for ascending).</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">5</span><span class="op">&gt;</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">30</span><span class="op">;</span> <span class="va">arr</span><span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> <span class="va">arr</span><span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="dv">50</span><span class="op">;</span> <span class="va">arr</span><span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> <span class="va">arr</span><span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="dv">40</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span><span class="fu">sort</span><span class="op">()</span>  <span class="co">-- {10, 20, 30, 40, 50}</span></span></code></pre></div>
<h3 id="array-navigation-methods">Array Navigation Methods</h3>
<h4 id="arraycontains">array.contains()</h4>
<p><code>bool = arr:contains(Value)</code></p>
<p>Returns <code>true</code> if the specified value exists in the array, <code>false</code> otherwise. This is a convenience wrapper around <code>find()</code> that returns a boolean instead of an index. String comparisons are case-sensitive.</p>
<h4 id="arrayfirst">array.first()</h4>
<p><code>value = arr:first()</code></p>
<p>Returns the first element of the array, or <code>nil</code> if the array is empty. Provides bounds-safe access without risking
index-out-of-bounds errors.</p>
<p>This method is equivalent to <code>arr[0]</code> but returns <code>nil</code> for empty arrays instead of raising an error.</p>
<h4 id="arraylast">array.last()</h4>
<p><code>value = arr:last()</code></p>
<p>Returns the last element of the array, or <code>nil</code> if the array is empty. Provides bounds-safe access without risking
index-out-of-bounds errors.</p>
<p>This method is equivalent to <code>arr[#arr - 1]</code> but returns <code>nil</code> for empty arrays instead of raising an error.</p>
<h4 id="arrayfind">array.find()</h4>
<pre><code>index = arr:find(Value, [Start], [End])
index = arr:find(Value, Range)</code></pre>
<p>Searches for a <code>Value</code> in the array. <code>Start</code> is a starting index for search (defaults to 0). <code>End</code> is an ending index, exclusive (defaults to array length). <code>Range</code> is a range object specifying the search bounds. The index where the value was found is returned, or <code>nil</code> if not found.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">10</span><span class="op">&gt;</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">9</span> <span class="cf">do</span> <span class="va">arr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">i</span> <span class="op">*</span> <span class="dv">10</span> <span class="cf">end</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Search starting from index 6</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="va">idx</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span><span class="fu">find</span><span class="op">(</span><span class="dv">50</span><span class="op">,</span> <span class="dv">6</span><span class="op">)</span>     <span class="co">-- Returns nil (50 is at index 5)</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Search within a range</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a><span class="va">idx</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span><span class="fu">find</span><span class="op">(</span><span class="dv">30</span><span class="op">,</span> <span class="op">{</span><span class="dv">0..5</span><span class="op">})</span>   <span class="co">-- Returns 3</span></span></code></pre></div>
<h3 id="array-data-extraction-methods">Array Data Extraction Methods</h3>
<h4 id="arraycopy">array.copy()</h4>
<p><code>arr:copy(Source, [DestIndex], [SrcIndex], [Count])</code></p>
<p>Copies data from a source into the array. <code>Source</code> is an array, string or table. <code>DestIndex</code> is a starting index in destination array (default: 0). <code>SrcIndex</code> is a starting index in source (default: 0). <code>Count</code> is the number of elements to copy (default: all remaining).</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Copy from another array</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="va">src</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">10</span><span class="op">&gt;</span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="va">dst</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">20</span><span class="op">&gt;</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="va">dst</span><span class="op">:</span>copy<span class="op">(</span><span class="va">src</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">)</span>  <span class="co">-- Copy 10 elements from src[0] to dst[5]</span></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Copy from a string</span></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="va">bytes</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="fu">byte</span><span class="op">,</span> <span class="dv">100</span><span class="op">&gt;</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a><span class="va">bytes</span><span class="op">:</span>copy<span class="op">(</span><span class="st">&#39;Hello&#39;</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- Copy from a table</span></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">5</span><span class="op">&gt;</span></span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>copy<span class="op">({</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span><span class="op">})</span></span></code></pre></div>
<h4 id="arraygetstring">array.getString()</h4>
<p><code>str = arr:getString([Start], [Length])</code></p>
<p>Extracts a substring from a byte/char array. <code>Start</code> is the starting byte index (0-based). <code>Length</code> is the number of bytes to extract (defaults to all).</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.</span>new<span class="op">(</span><span class="st">&#39;Hello World&#39;</span><span class="op">)</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">arr</span><span class="op">:</span>getString<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">))</span>   <span class="co">-- Prints &#39;Hello&#39;</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">arr</span><span class="op">:</span>getString<span class="op">(</span><span class="dv">6</span><span class="op">))</span>      <span class="co">-- Prints &#39;World&#39;</span></span></code></pre></div>
<h4 id="arraysetstring">array.setString()</h4>
<p><code>count = arr:setString(String, [Start])</code></p>
<p>Copy <code>String</code> content into a byte array. <code>Start</code> is a starting index in the array (default: 0). The number of bytes written is returned.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="fu">byte</span><span class="op">,</span> <span class="dv">20</span><span class="op">&gt;</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>setString<span class="op">(</span><span class="st">&#39;Hello&#39;</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>setString<span class="op">(</span><span class="st">&#39; World&#39;</span><span class="op">,</span> <span class="dv">5</span><span class="op">)</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">arr</span><span class="op">:</span>getString<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">11</span><span class="op">))</span>  <span class="co">-- Prints &#39;Hello World&#39;</span></span></code></pre></div>
<h4 id="arrayslice">array.slice()</h4>
<p><code>new_arr = arr:slice(Range)</code></p>
<p>Creates a new array containing a subset of elements. <code>Range</code> is a range object specifying which elements to extract. A new array containing the selected elements is returned.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">10</span><span class="op">&gt;</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">9</span> <span class="cf">do</span> <span class="va">arr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">i</span> <span class="op">*</span> <span class="dv">10</span> <span class="cf">end</span>  <span class="co">-- {0, 10, 20, 30, 40, 50, 60, 70, 80, 90}</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>slice<span class="op">({</span><span class="dv">2..5</span><span class="op">})</span>   <span class="co">-- {20, 30, 40}</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>slice<span class="op">({</span><span class="dv">5.</span><span class="op">.</span><span class="dv">.2</span><span class="op">})</span>  <span class="co">-- {50, 40, 30, 20} Reverse slice</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>slice<span class="op">({-</span><span class="dv">3.</span><span class="op">.-</span><span class="dv">1</span><span class="op">})</span> <span class="co">-- {70, 80, 90}  Negative indices (from end)</span></span></code></pre></div>
<h4 id="arrayconcat">array.concat()</h4>
<p><code>str = arr:concat(Format, [Separator])</code></p>
<p>Concatenates array elements into a string. <code>Format</code> is a printf-style format string for each element (e.g., <code>&#39;%d&#39;</code>, <code>&#39;%.2f&#39;</code>). <code>Separator</code> is a string to insert between elements (default: empty string). A string containing all formatted elements is returned.</p>
<p>Note that for simple string concatenation (unformatted), use <code>array.join()</code> instead in order to maximise performance.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">,</span> <span class="dv">5</span><span class="op">&gt;</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">4</span> <span class="cf">do</span> <span class="va">arr</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">i</span> <span class="op">*</span> <span class="dv">10</span> <span class="cf">end</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="va">str</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span><span class="fu">concat</span><span class="op">(</span><span class="st">&#39;%d&#39;</span><span class="op">,</span> <span class="st">&#39;, &#39;</span><span class="op">)</span> <span class="co">-- Result: &#39;0, 10, 20, 30, 40&#39;</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="va">farr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">double</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1.5</span><span class="op">,</span> <span class="dv">2.75</span><span class="op">,</span> <span class="dv">3.125</span> <span class="op">}</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="va">str</span> <span class="op">=</span> <span class="va">farr</span><span class="op">:</span><span class="fu">concat</span><span class="op">(</span><span class="st">&#39;%.2f&#39;</span><span class="op">,</span> <span class="st">&#39; | &#39;</span><span class="op">)</span> <span class="co">-- Result: &#39;1.50 | 2.75 | 3.13&#39;</span></span></code></pre></div>
<h4 id="arrayjoin">array.join()</h4>
<p><code>str = arr:join([Separator])</code></p>
<p>Concatenates array elements into a string, inserting an optional separator between elements. This is the complement to
<code>string.split()</code> which returns arrays, and is simpler than <code>concat()</code> as it doesn&#39;t require a format string.</p>
<p>For string arrays, elements are concatenated directly. For non-string types (integers, floats, etc.), elements are
converted to their string representation automatically.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- String array joining</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="va">parts</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">&#39;hello&#39;</span><span class="op">,</span> <span class="st">&#39;world&#39;</span><span class="op">,</span> <span class="st">&#39;!&#39;</span> <span class="op">}</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="va">str</span> <span class="op">=</span> <span class="va">parts</span><span class="op">:</span>join<span class="op">(</span><span class="st">&#39; &#39;</span><span class="op">)</span> <span class="co">-- Result: &#39;hello world !&#39;</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Join with comma separator</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a><span class="va">names</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">&#39;apple&#39;</span><span class="op">,</span> <span class="st">&#39;banana&#39;</span><span class="op">,</span> <span class="st">&#39;cherry&#39;</span> <span class="op">}</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="va">str</span> <span class="op">=</span> <span class="va">names</span><span class="op">:</span>join<span class="op">(</span><span class="st">&#39;, &#39;</span><span class="op">)</span> <span class="co">-- Result: &#39;apple, banana, cherry&#39;</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Integer array (automatic conversion)</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a><span class="va">numbers</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a><span class="va">str</span> <span class="op">=</span> <span class="va">numbers</span><span class="op">:</span>join<span class="op">(</span><span class="st">&#39;-&#39;</span><span class="op">)</span> <span class="co">-- Result: &#39;1-2-3-4-5&#39;</span></span></code></pre></div>
<h4 id="arrayclone">array.clone()</h4>
<p><code>copy = arr:clone()</code></p>
<p>Creates a copy of the array. For primitive types (int, float, etc.), this is a deep copy. For reference types (strings, tables), the references are copied (shallow copy).</p>
<h3 id="array-functional-methods">Array Functional Methods</h3>
<h4 id="arrayeach">array.each()</h4>
<p><code>arr:each(Callback)</code></p>
<p>Iterates over array elements, calling the <code>Callback</code> function for each element. The callback receives <code>(value, index)</code> as arguments. Returns the original array for method chaining.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Basic iteration</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span> <span class="op">}</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>each<span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Index &#39;</span> <span class="op">..</span> <span class="va">i</span> <span class="op">..</span> <span class="st">&#39;: &#39;</span> <span class="op">..</span> <span class="va">v</span><span class="op">)</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span><span class="op">)</span></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Output: Index 0: 10, Index 1: 20, Index 2: 30</span></span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Using arrow function syntax</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>each<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="fu">print</span><span class="op">(</span><span class="va">v</span><span class="op">))</span></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Chaining</span></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>each<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Processing:&#39;</span><span class="op">,</span> <span class="va">v</span><span class="op">))</span></span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a>   <span class="op">:</span>each<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> log<span class="op">(</span><span class="st">&#39;Logged:&#39;</span><span class="op">,</span> <span class="va">v</span><span class="op">))</span></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- With statements in arrow function body</span></span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a><span class="va">total</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>each<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="cf">do</span> <span class="va">total</span> <span class="er">+=</span> <span class="va">v</span> <span class="cf">end</span><span class="op">)</span></span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">total</span><span class="op">)</span>  <span class="co">-- 60</span></span></code></pre></div>
<h3 id="arraymap">array.map()</h3>
<p><code>new_array = arr:map(Transform)</code></p>
<p>Returns a new array with each element transformed by the given <code>Transform</code> function. The original array is not modified.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Double all values</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="va">doubled</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>map<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">*</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- String transformation</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="va">names</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">&#39;hello&#39;</span><span class="op">,</span> <span class="st">&#39;world&#39;</span> <span class="op">}</span></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="fu">upper</span> <span class="op">=</span> <span class="va">names</span><span class="op">:</span>map<span class="op">(</span><span class="va">s</span> <span class="op">=&gt;</span> <span class="va">s</span><span class="op">:</span><span class="fu">upper</span><span class="op">())</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Chaining map operations</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>map<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">*</span> <span class="dv">2</span><span class="op">):</span>map<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">+</span> <span class="dv">1</span><span class="op">)</span></span></code></pre></div>
<h3 id="arrayfilter">array.filter()</h3>
<p><code>new_array = arr:filter(predicate)</code></p>
<p>Returns a new array containing only elements that satisfy the <code>Predicate</code> function. Elements for which the predicate returns a <code>true</code> value are included.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Filter even numbers</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span> <span class="op">}</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="va">evens</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>filter<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span><span class="op">)</span> <span class="co">-- evens = {2, 4, 6}</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Filter by index</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">50</span> <span class="op">}</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="va">odd_indices</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>filter<span class="op">((</span><span class="va">v</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">i</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">1</span><span class="op">)</span> <span class="co">-- odd_indices = {20, 40}</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- String filtering</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="va">names</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">&#39;apple&#39;</span><span class="op">,</span> <span class="st">&#39;banana&#39;</span><span class="op">,</span> <span class="st">&#39;apricot&#39;</span><span class="op">,</span> <span class="st">&#39;cherry&#39;</span> <span class="op">}</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a><span class="va">a_words</span> <span class="op">=</span> <span class="va">names</span><span class="op">:</span>filter<span class="op">(</span><span class="va">s</span> <span class="op">=&gt;</span> <span class="va">s</span><span class="op">:</span>startsWith<span class="op">(</span><span class="st">&#39;a&#39;</span><span class="op">))</span> <span class="co">-- a_words = {&#39;apple&#39;, &#39;apricot&#39;}</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Chained filtering</span></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="va">large_evens</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>filter<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span><span class="op">):</span>filter<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">&gt;</span> <span class="dv">10</span><span class="op">)</span></span></code></pre></div>
<h3 id="arrayreduce">array.reduce()</h3>
<p><code>result = arr:reduce(Initial, Reducer)</code></p>
<p>Folds all array elements into a single accumulated value. The reducer function is called for each element, receiving the current accumulator, the element value, and the element index. <code>Initial</code> is the initial value for the accumulator (any type). <code>Reducer</code> is a function receiving <code>(accumulator, value, index)</code> and returning the new accumulator.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sum all elements</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="va">sum</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>reduce<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">v</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">acc</span> <span class="op">+</span> <span class="va">v</span><span class="op">)</span> <span class="co">-- sum = 15</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Product of elements</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="va">product</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>reduce<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">v</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">acc</span> <span class="op">*</span> <span class="va">v</span><span class="op">)</span> <span class="co">-- product = 120</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- String concatenation</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a><span class="va">parts</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">&#39;a&#39;</span><span class="op">,</span> <span class="st">&#39;b&#39;</span><span class="op">,</span> <span class="st">&#39;c&#39;</span> <span class="op">}</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">parts</span><span class="op">:</span>reduce<span class="op">(</span><span class="st">&#39;&#39;</span><span class="op">,</span> <span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">v</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">acc</span> <span class="op">..</span> <span class="va">v</span><span class="op">)</span> <span class="co">-- result = &#39;abc&#39;</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- Build a table</span></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">.&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span> <span class="op">}</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a><span class="va">squares</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>reduce<span class="op">({},</span> <span class="kw">function</span><span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">v</span><span class="op">,</span> <span class="va">i</span><span class="op">)</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>   <span class="va">acc</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">v</span> <span class="op">*</span> <span class="va">v</span></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="va">acc</span></span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span><span class="op">)</span></span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a><span class="co">-- squares = {[0]=1, [1]=4, [2]=9}</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a><span class="co">-- Find maximum</span></span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">6</span> <span class="op">}</span></span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a><span class="va">max</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>reduce<span class="op">(</span><span class="va">arr</span><span class="op">:</span>first<span class="op">(),</span> <span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">v</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">&gt;</span> <span class="va">acc</span> ? <span class="va">v</span> <span class="op">:&gt;</span> <span class="va">acc</span><span class="op">)</span> <span class="co">-- max = 9</span></span></code></pre></div>
<h3 id="arrayany">array.any()</h3>
<p><code>bool = arr:any(Predicate)</code></p>
<p>Returns <code>true</code> if any element in the array satisfies the <code>Predicate</code> function. Short-circuits on the first match, returning immediately without checking remaining elements. The <code>Predicate</code> arguments are <code>(value, index)</code> and must return a boolean.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check if any element is even</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span> <span class="op">}</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="va">has_even</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>any<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span><span class="op">)</span> <span class="co">-- has_even = true (found 6)</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check if any element is negative</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="va">has_negative</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>any<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="co">-- has_negative = false</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- String array</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="va">names</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">&#39;apple&#39;</span><span class="op">,</span> <span class="st">&#39;banana&#39;</span><span class="op">,</span> <span class="st">&#39;cherry&#39;</span> <span class="op">}</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="va">has_long</span> <span class="op">=</span> <span class="va">names</span><span class="op">:</span>any<span class="op">(</span><span class="va">s</span> <span class="op">=&gt;</span> <span class="op">#</span><span class="va">s</span> <span class="op">&gt;</span> <span class="dv">6</span><span class="op">)</span> <span class="co">-- has_long = true (banana, cherry)</span></span></code></pre></div>
<h3 id="arrayall">array.all()</h3>
<p><code>bool = arr:all(Predicate)</code></p>
<p>Returns <code>true</code> if all elements in the array satisfy the <code>Predicate</code> function. Short-circuits on the first failure, returning immediately without checking remaining elements. The <code>Predicate</code> arguments are <code>(value, index)</code> and must return a boolean.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check if all elements are positive</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="va">all_positive</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>all<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="co">-- all_positive = true</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- String validation</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="va">names</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">string</span><span class="op">&gt;</span> <span class="op">{</span> <span class="st">&#39;abc&#39;</span><span class="op">,</span> <span class="st">&#39;def&#39;</span><span class="op">,</span> <span class="st">&#39;ghi&#39;</span> <span class="op">}</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="va">all_short</span> <span class="op">=</span> <span class="va">names</span><span class="op">:</span>all<span class="op">(</span><span class="va">s</span> <span class="op">=&gt;</span> <span class="op">#</span><span class="va">s</span> <span class="va">is</span> <span class="dv">3</span><span class="op">)</span> <span class="co">-- all_short = true</span></span></code></pre></div>
<h3 id="chaining-functional-methods">Chaining Functional Methods</h3>
<p>The functional methods can be chained together to create data processing pipelines:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Filter, then map, then reduce</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span> <span class="op">=</span> <span class="va">array</span><span class="op">&lt;</span><span class="va">int</span><span class="op">&gt;</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">10</span> <span class="op">}</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="va">result</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>filter<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">%</span> <span class="dv">2</span> <span class="va">is</span> <span class="dv">0</span><span class="op">)</span>   <span class="co">-- {2, 4, 6, 8, 10}</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>map<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">*</span> <span class="dv">10</span><span class="op">)</span>          <span class="co">-- {20, 40, 60, 80, 100}</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span>reduce<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="op">(</span><span class="va">acc</span><span class="op">,</span> <span class="va">v</span><span class="op">)</span> <span class="op">=&gt;</span> <span class="va">acc</span> <span class="op">+</span> <span class="va">v</span><span class="op">)</span>  <span class="co">-- 300</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check conditions on transformed data</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="va">has_large</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>map<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">*</span> <span class="dv">2</span><span class="op">):</span>any<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">&gt;</span> <span class="dv">15</span><span class="op">)</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="va">all_small</span> <span class="op">=</span> <span class="va">arr</span><span class="op">:</span>filter<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">&lt;</span> <span class="dv">5</span><span class="op">):</span>all<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use each() in a chain (returns original array)</span></span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a><span class="va">arr</span><span class="op">:</span>each<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> log<span class="op">(</span><span class="st">&#39;Before:&#39;</span><span class="op">,</span> <span class="va">v</span><span class="op">))</span></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>   <span class="op">:</span>map<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> <span class="va">v</span> <span class="op">*</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>   <span class="op">:</span>each<span class="op">(</span><span class="va">v</span> <span class="op">=&gt;</span> log<span class="op">(</span><span class="st">&#39;After:&#39;</span><span class="op">,</span> <span class="va">v</span><span class="op">))</span></span></code></pre></div>
<hr>
<h2 id="logging">Logging</h2>
<p>The following functions are included as standard so that messages can be logged to the console.</p>
<h3 id="msg">msg()</h3>
<p><code>msg()</code> accepts a single string parameter and prints it to the debug log. The log level must be set to <code>api</code> or higher in order to be visible.</p>
<p>If the log-level is not high enough to display the message, the call is silently discarded during parsing to maximise efficiency.</p>
<h3 id="print">print()</h3>
<p><code>print()</code> accepts a single string parameter and prints it to <code>stdout</code>. If <code>stdout</code> is unavailable on a system like Android, the message is printed to the debug log instead.</p>
<p><em>For targeted printing, use <code>io.write()</code> and target <code>stderr</code> or <code>stdout</code> instead of the <code>print()</code> function.</em></p>
<hr>
<h2 id="annotations">Annotations</h2>
<p>Fluid supports function annotations that attach metadata to functions at parse time. Annotations provide a declarative way to mark functions with attributes that can be queried at runtime, enabling features like test discovery, deprecation warnings, and capability requirements.</p>
<h3 id="annotation-syntax">Annotation Syntax</h3>
<p>Annotations use the <code>@</code> prefix and are placed immediately before a function declaration:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>@<span class="va">AnnotationName</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> myFunction<span class="op">()</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- function body</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Annotations can include named arguments in parentheses:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>@Test<span class="op">(</span><span class="va">name</span><span class="op">=</span><span class="st">&quot;My Test Case&quot;</span><span class="op">,</span> <span class="va">timeout</span><span class="op">=</span><span class="dv">5</span><span class="op">)</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> testSomething<span class="op">()</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- test body</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><strong>Supported Argument Types:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td><code>name=&#39;Test Name&#39;</code></td>
</tr>
<tr>
<td>Number</td>
<td><code>timeout=5.0</code>, <code>priority=1</code></td>
</tr>
<tr>
<td>Boolean</td>
<td><code>enabled=true</code>, <code>network=false</code></td>
</tr>
<tr>
<td>Array</td>
<td><code>labels=[&#39;unit&#39;, &#39;smoke&#39;, &#39;critical&#39;]</code></td>
</tr>
<tr>
<td>Bare Identifier</td>
<td><code>deprecated</code> (equivalent to <code>deprecated=true</code>)</td>
</tr>
</tbody>
</table>
<p><strong>Multiple Annotations:</strong></p>
<p>Multiple annotations can be stacked on a single function:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>@Test<span class="op">(</span><span class="va">name</span><span class="op">=</span><span class="st">&#39;Network Test&#39;</span><span class="op">)</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>@Requires<span class="op">(</span><span class="va">network</span><span class="op">=</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> testNetworkFeature<span class="op">()</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- test body</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Annotations can also be placed on the same line using semicolons:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>@<span class="va">BeforeEach</span><span class="op">;</span> @Requires<span class="op">(</span><span class="va">network</span><span class="op">=</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> setupNetwork<span class="op">()</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- setup body</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p><strong>Function Types:</strong></p>
<p>Annotations work with all function declaration styles:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Regular functions</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>@<span class="va">Test</span> <span class="kw">function</span> regularFunc<span class="op">()</span> <span class="kw">end</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Local functions</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>@<span class="va">Test</span> <span class="kw">local</span> <span class="kw">function</span> localFunc<span class="op">()</span> <span class="kw">end</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Global functions</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>@<span class="va">Test</span> <span class="va">global</span> <span class="kw">function</span> globalFunc<span class="op">()</span> <span class="kw">end</span></span></code></pre></div>
<h3 id="compile-time-pre-processor">Compile-Time Pre-Processor</h3>
<p>The <code>@if ... @end</code> construct provides a compile-time pre-processor, allowing code to be included or excluded based on conditions evaluated during parsing. This allows you to quickly eliminate the compilation of bytecode that the program doesn&#39;t need.</p>
<p><strong>Basic Syntax:</strong></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>@if<span class="op">(</span><span class="va">condition</span><span class="op">=</span><span class="va">value</span><span class="op">)</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Code included only when condition matches</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>@<span class="va">end</span></span></code></pre></div>
<p><strong>Supported Conditions:</strong></p>
<table>
<thead>
<tr>
<th>Condition</th>
<th>Value Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>imported</code></td>
<td>boolean</td>
<td><code>true</code> when file is being imported; <code>false</code> when file is the main script.</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>boolean</td>
<td><code>true</code> when log level is higher than &#39;warning&#39;; <code>false</code> otherwise.</td>
</tr>
<tr>
<td><code>platform</code></td>
<td>string</td>
<td>Matches against current platform: <code>&quot;windows&quot;</code>, <code>&quot;linux&quot;</code>, <code>&quot;osx&quot;</code>, <code>&quot;native&quot;</code>.</td>
</tr>
<tr>
<td><code>exists</code></td>
<td>string</td>
<td>Checks for existence of a file at compile time: <code>exists=&#39;path/to/file&#39;</code>. The path is calculated relative to the script.</td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Platform-specific code</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>@if<span class="op">(</span><span class="va">platform</span><span class="op">=</span><span class="st">&quot;windows&quot;</span><span class="op">)</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">path_separator</span> <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">&quot;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>@<span class="va">end</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>@if<span class="op">(</span><span class="va">platform</span><span class="op">=</span><span class="st">&quot;linux&quot;</span><span class="op">)</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>   <span class="va">path_separator</span> <span class="op">=</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>@<span class="va">end</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- Debug-only code (only included when logging is enabled)</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>@if<span class="op">(</span><span class="va">debug</span><span class="op">=</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Debug: Entering critical section&quot;</span><span class="op">)</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>@<span class="va">end</span></span></code></pre></div>
<p><strong>Nesting:</strong></p>
<p>Compile-time conditionals can be nested:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>@if<span class="op">(</span><span class="va">imported</span><span class="op">=</span><span class="kw">false</span><span class="op">)</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>   @if<span class="op">(</span><span class="va">platform</span><span class="op">=</span><span class="st">&quot;windows&quot;</span><span class="op">)</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span><span class="st">&quot;Running as main script on Windows&quot;</span><span class="op">)</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>   @<span class="va">end</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>@<span class="va">end</span></span></code></pre></div>
<h3 id="standard-annotations">Standard Annotations</h3>
<p>The following annotations are recommended for general-purpose code organisation:</p>
<table>
<thead>
<tr>
<th>Annotation</th>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Deprecated</code></td>
<td><code>message:str</code>, <code>since:str</code></td>
<td>Marks a function as deprecated. Tools may emit warnings when deprecated functions are called.</td>
</tr>
<tr>
<td><code>@Override</code></td>
<td>(none)</td>
<td>Indicates that a function overrides a parent implementation. Useful for documentation and tooling.</td>
</tr>
<tr>
<td><code>@SuppressWarnings</code></td>
<td><code>&lt;flags&gt;</code></td>
<td>Suppresses specific warnings. Flags are bare identifiers: <code>@SuppressWarnings(unused, deprecated)</code></td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb200"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>@Deprecated<span class="op">(</span><span class="va">message</span><span class="op">=</span><span class="st">&#39;Use newApi() instead&#39;</span><span class="op">,</span> <span class="va">since</span><span class="op">=</span><span class="st">&#39;2.0&#39;</span><span class="op">)</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> oldApi<span class="op">()</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> newApi<span class="op">()</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>@<span class="va">Override</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> customBehaviour<span class="op">()</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Override parent implementation</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>@SuppressWarnings<span class="op">(</span><span class="va">unused</span><span class="op">,</span> <span class="va">experimental</span><span class="op">)</span></span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> internalHelper<span class="op">()</span></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Implementation</span></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h3 id="test-framework-annotations">Test Framework Annotations</h3>
<p>The Flute test framework recognises the following annotations for test discovery and configuration:</p>
<table>
<thead>
<tr>
<th>Annotation</th>
<th>Arguments</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@Test</code></td>
<td><code>name:str</code>, <code>timeout:num</code>, <code>priority:num</code>, <code>labels:array</code></td>
<td>Marks a function as a test case</td>
</tr>
<tr>
<td><code>@BeforeEach</code></td>
<td>(none)</td>
<td>Runs before each test in the file</td>
</tr>
<tr>
<td><code>@AfterEach</code></td>
<td>(none)</td>
<td>Runs after each test in the file</td>
</tr>
<tr>
<td><code>@BeforeAll</code></td>
<td>(none)</td>
<td>Runs once before all tests in the file</td>
</tr>
<tr>
<td><code>@AfterAll</code></td>
<td>(none)</td>
<td>Runs once after all tests in the file</td>
</tr>
<tr>
<td><code>@Disabled</code></td>
<td><code>reason:str</code></td>
<td>Skips the test with an optional reason</td>
</tr>
<tr>
<td><code>@Requires</code></td>
<td><code>display:bool</code>, <code>network:bool</code>, <code>audio:bool</code></td>
<td>Specifies runtime requirements; test is skipped if requirements are not met</td>
</tr>
</tbody>
</table>
<p><strong>Test Argument Reference:</strong></p>
<table>
<thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>function name</td>
<td>Display name for the test</td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>number</td>
<td>3.0</td>
<td>Maximum execution time in seconds</td>
</tr>
<tr>
<td><code>priority</code></td>
<td>number</td>
<td>0</td>
<td>Execution order (lower runs first)</td>
</tr>
<tr>
<td><code>labels</code></td>
<td>array</td>
<td><code>[]</code></td>
<td>Tags for filtering tests (e.g., <code>[&#39;unit&#39;, &#39;smoke&#39;]</code>)</td>
</tr>
</tbody>
</table>
<p><strong>Requirements Reference:</strong></p>
<table>
<thead>
<tr>
<th>Requirement</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>audio</code></td>
<td>Requires working audio module</td>
</tr>
<tr>
<td><code>display</code></td>
<td>Requires working display module</td>
</tr>
<tr>
<td><code>font</code></td>
<td>Requires working font module</td>
</tr>
<tr>
<td><code>network</code></td>
<td>Requires working network module</td>
</tr>
<tr>
<td><code>ssl</code></td>
<td>Requires SSL to be built-in to network module</td>
</tr>
</tbody>
</table>
<p><strong>Examples:</strong></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>@Test<span class="op">(</span><span class="va">name</span><span class="op">=</span><span class="st">&#39;User Login&#39;</span><span class="op">,</span> <span class="va">labels</span><span class="op">=[</span><span class="st">&#39;integration&#39;</span><span class="op">,</span> <span class="st">&#39;auth&#39;</span><span class="op">])</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>@Requires<span class="op">(</span><span class="va">network</span><span class="op">=</span><span class="kw">true</span><span class="op">)</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> testUserLogin<span class="op">()</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Test implementation</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>@<span class="va">BeforeEach</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> setupTestEnvironment<span class="op">()</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Runs before each test</span></span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a>@Disabled<span class="op">(</span><span class="va">reason</span><span class="op">=</span><span class="st">&#39;Pending implementation&#39;</span><span class="op">)</span></span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a>@<span class="va">Test</span></span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> testFutureFeature<span class="op">()</span></span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a>   <span class="co">-- Will be skipped</span></span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<h3 id="debugfilesources-interface">debug.fileSources Interface</h3>
<p>The <code>debug.fileSources()</code> function provides access to the file source tracking system, which maintains metadata about all source files involved in the current script execution. This is particularly useful for debugging, tooling, and understanding import hierarchies.</p>
<h4 id="debugfilesources">debug.fileSources()</h4>
<p><code>array = debug.fileSources()</code></p>
<p>Returns an array of all registered file sources for the current script execution. Each entry in the returned array contains the following fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td>number</td>
<td>File index (0 = main file, 255 = overflow fallback)</td>
</tr>
<tr>
<td><code>path</code></td>
<td>string</td>
<td>Full resolved path to the source file</td>
</tr>
<tr>
<td><code>filename</code></td>
<td>string</td>
<td>Short filename for error display</td>
</tr>
<tr>
<td><code>namespace</code></td>
<td>string</td>
<td>Declared namespace (empty string if none)</td>
</tr>
<tr>
<td><code>firstLine</code></td>
<td>number</td>
<td>First line number in unified line space</td>
</tr>
<tr>
<td><code>sourceLines</code></td>
<td>number</td>
<td>Total number of lines in the source file</td>
</tr>
<tr>
<td><code>parentIndex</code></td>
<td>number</td>
<td>Index of the file that imported this one (0 for main)</td>
</tr>
<tr>
<td><code>importLine</code></td>
<td>number</td>
<td>Line number in parent where import occurred (0 for main)</td>
</tr>
<tr>
<td><code>isOverflow</code></td>
<td>boolean</td>
<td>True if this is the overflow fallback entry (index 255)</td>
</tr>
</tbody>
</table>
<p><strong>Example - List All File Sources:</strong></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="va">sources</span> <span class="op">=</span> <span class="va">debug</span><span class="op">.</span>fileSources<span class="op">()</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">&quot;File sources:&quot;</span><span class="op">)</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">i</span> <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> <span class="op">#</span><span class="va">sources</span> <span class="op">-</span> <span class="dv">1</span> <span class="cf">do</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>   <span class="va">src</span> <span class="op">=</span> <span class="va">sources</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;  [{src.index}] {src.filename}&quot;</span><span class="op">)</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;      path: {src.path}&quot;</span><span class="op">)</span></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">src</span><span class="op">.</span><span class="va">namespace</span> <span class="er">!=</span> <span class="st">&quot;&quot;</span> <span class="cf">then</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;      namespace: {src.namespace}&quot;</span><span class="op">)</span></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> <span class="va">src</span><span class="op">.</span><span class="va">parentIndex</span> <span class="er">!=</span> <span class="dv">0</span> <span class="kw">or</span> <span class="va">src</span><span class="op">.</span><span class="va">importLine</span> <span class="er">!=</span> <span class="dv">0</span> <span class="cf">then</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;      imported from [{src.parentIndex}] at line {src.importLine}&quot;</span><span class="op">)</span></span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Example - Correlate with debug.getInfo():</strong></p>
<p>The <code>debug.getInfo()</code> function returns a <code>fileIndex</code> field when the &#39;S&#39; option is used. This index can be used to look up the corresponding file source:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="va">sources</span> <span class="op">=</span> <span class="va">debug</span><span class="op">.</span>fileSources<span class="op">()</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="va">info</span> <span class="op">=</span> <span class="va">debug</span><span class="op">.</span>getInfo<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="st">&quot;S&quot;</span><span class="op">)</span>  <span class="co">-- Get info about current function</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">info</span><span class="op">.</span><span class="va">fileIndex</span> <span class="cf">then</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">local</span> <span class="va">src</span> <span class="op">=</span> <span class="va">sources</span><span class="op">[</span><span class="va">info</span><span class="op">.</span><span class="va">fileIndex</span><span class="op">]</span></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;Current function is in: {src.filename}&quot;</span><span class="op">)</span></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span>f<span class="st">&quot;Full path: {src.path}&quot;</span><span class="op">)</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>The main script file is always at index 0</li>
<li>Imported files are assigned indices 1-254 in the order they are first encountered</li>
<li>Index 255 is reserved as an overflow fallback when the file limit is exceeded</li>
<li>File sources are deduplicated; importing the same file multiple times returns the same index</li>
<li>The <code>fileIndex</code> field in <code>debug.getInfo()</code> results corresponds to indices in this array</li>
</ul>
<h3 id="debuganno-interface">debug.anno Interface</h3>
<p>The <code>debug.anno</code> interface provides programmatic access to function annotations at runtime.</p>
<h4 id="debugannosetfunc-annotations-source-name">debug.anno.set(func, annotations, [source], [name])</h4>
<p>Registers annotations for a function. Returns the created entry table.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>func</code></td>
<td>function</td>
<td>The function to annotate</td>
</tr>
<tr>
<td><code>annotations</code></td>
<td>string or table</td>
<td>Annotation data (see below)</td>
</tr>
<tr>
<td><code>source</code></td>
<td>string</td>
<td>Source file path (default: <code>&#39;&lt;runtime&gt;&#39;</code>)</td>
</tr>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>Function name (default: inferred or <code>&#39;&lt;anonymous&gt;&#39;</code>)</td>
</tr>
</tbody>
</table>
<p><strong>Annotation Formats:</strong></p>
<p><em>Table format:</em></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="va">debug</span><span class="op">.</span><span class="va">anno</span><span class="op">.</span>set<span class="op">(</span><span class="va">myFunc</span><span class="op">,</span> <span class="op">{</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span> <span class="va">name</span> <span class="op">=</span> <span class="st">&#39;Test&#39;</span><span class="op">,</span> <span class="va">args</span> <span class="op">=</span> <span class="op">{</span> <span class="va">name</span> <span class="op">=</span> <span class="st">&#39;My Test&#39;</span><span class="op">,</span> <span class="va">labels</span> <span class="op">=</span> <span class="op">{</span> <span class="st">&#39;unit&#39;</span> <span class="op">}</span> <span class="op">}</span> <span class="op">},</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span> <span class="va">name</span> <span class="op">=</span> <span class="st">&#39;Requires&#39;</span><span class="op">,</span> <span class="va">args</span> <span class="op">=</span> <span class="op">{</span> <span class="va">network</span> <span class="op">=</span> <span class="kw">true</span> <span class="op">}</span> <span class="op">}</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="op">},</span> <span class="st">&#39;myfile.fluid&#39;</span><span class="op">,</span> <span class="st">&#39;myFunc&#39;</span><span class="op">)</span></span></code></pre></div>
<p><em>String format (parsed):</em></p>
<div class="sourceCode" id="cb205"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="va">debug</span><span class="op">.</span><span class="va">anno</span><span class="op">.</span>set<span class="op">(</span><span class="va">myFunc</span><span class="op">,</span> <span class="st">&#39;@Test(name=&#39;</span><span class="va">My</span> Test<span class="st">&#39;); @Requires(network=true)&#39;</span><span class="op">)</span></span></code></pre></div>
<p><strong>Returns:</strong> Entry table with fields:</p>
<ul>
<li><code>name</code>: Function name</li>
<li><code>source</code>: Source file path</li>
<li><code>annotations</code>: Array of annotation tables</li>
</ul>
<h4 id="debugannogetfunc">debug.anno.get(func)</h4>
<p>Retrieves the annotation entry for a function.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>func</code></td>
<td>function</td>
<td>The function to query</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong> Entry table if the function is annotated, <code>nil</code> otherwise.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>@Test<span class="op">(</span><span class="va">name</span><span class="op">=</span><span class="st">&#39;Example&#39;</span><span class="op">)</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> exampleFunc<span class="op">()</span> <span class="kw">end</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="va">entry</span> <span class="op">=</span> <span class="va">debug</span><span class="op">.</span><span class="va">anno</span><span class="op">.</span>get<span class="op">(</span><span class="va">exampleFunc</span><span class="op">)</span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">entry</span> <span class="cf">then</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Function: &#39;</span> <span class="op">..</span> <span class="va">entry</span><span class="op">.</span><span class="va">name</span><span class="op">)</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Source: &#39;</span> <span class="op">..</span> <span class="va">entry</span><span class="op">.</span><span class="va">source</span><span class="op">)</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> <span class="va">i</span><span class="op">,</span> <span class="va">anno</span> <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span><span class="va">entry</span><span class="op">.</span><span class="va">annotations</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span><span class="op">(</span><span class="st">&#39;Annotation: &#39;</span> <span class="op">..</span> <span class="va">anno</span><span class="op">.</span><span class="va">name</span><span class="op">)</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">end</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<h4 id="debugannolist">debug.anno.list()</h4>
<p>Returns a shallow copy of all registered annotations.</p>
<p><strong>Returns:</strong> Table mapping function references to their entry tables.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="va">all</span> <span class="op">=</span> <span class="va">debug</span><span class="op">.</span><span class="va">anno</span><span class="op">.</span>list<span class="op">()</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="va">func</span><span class="op">,</span> <span class="va">entry</span> <span class="kw">in</span> <span class="fu">pairs</span><span class="op">(</span><span class="va">all</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span><span class="op">(</span><span class="va">entry</span><span class="op">.</span><span class="va">name</span> <span class="op">..</span> <span class="st">&#39; has &#39;</span> <span class="op">..</span> <span class="op">#</span><span class="va">entry</span><span class="op">.</span><span class="va">annotations</span> <span class="op">..</span> <span class="st">&#39; annotations&#39;</span><span class="op">)</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p><strong>Entry Table Structure:</strong></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode lua"><code class="sourceCode lua"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>   <span class="va">name</span> <span class="op">=</span> <span class="st">&#39;functionName&#39;</span><span class="op">,</span>           <span class="co">-- Function name</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>   <span class="va">source</span> <span class="op">=</span> <span class="st">&#39;path/to/file.fluid&#39;</span><span class="op">,</span>   <span class="co">-- Source file</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>   <span class="va">annotations</span> <span class="op">=</span> <span class="op">{</span>                  <span class="co">-- Array of annotations</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">{</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>         <span class="va">name</span> <span class="op">=</span> <span class="st">&#39;Test&#39;</span><span class="op">,</span>             <span class="co">-- Annotation name</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>         <span class="va">args</span> <span class="op">=</span> <span class="op">{</span>                   <span class="co">-- Named arguments</span></span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>            <span class="va">name</span> <span class="op">=</span> <span class="st">&#39;Test Name&#39;</span><span class="op">,</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>            <span class="va">timeout</span> <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>            <span class="va">labels</span> <span class="op">=</span> <span class="op">{</span> <span class="st">&#39;unit&#39;</span><span class="op">,</span> <span class="st">&#39;smoke&#39;</span> <span class="op">}</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr>
<h2 id="event-subsystem">Event Subsystem</h2>
<p>Fluid programs can receive system-wide events whenever they are broadcast. Two functions are provided for the purpose of event management. The first is subscribeEvent(), which will connect a Fluid function to a specific event:</p>
<p><code>error, handle = subscribeEvent(eventname, function)</code></p>
<p>The <code>eventname</code> is a string that must follow the format <code>group.subgroup.name</code>, for example <code>system.task.created</code>. Valid event strings are described in full detail in the Events Manual of the Parasol SDK. A single asterisk wildcard is allowed in the subgroup and/or name if listening to multiple events is desirable, for example <code>system.*.*</code> would listen for all system events. The referenced function will receive two arguments if the event is signalled - <code>EventID</code> and <code>Args</code>. The <code>Args</code> parameter is a table containing named parameters - if the event does not include any parameters then the table will be empty.</p>
<p>To unsubscribe from an event, call unsubscribeEvent() with the event handle that was returned by the initial subscribeEvent() call:</p>
<p><code>unsubscribeEvent(handle)</code></p>
<hr>
<h2 id="credits">Credits</h2>
<p>Fluid is developed by Paul Manias and runs on Mike Pall&#39;s <a href="https://luajit.org/">LuaJIT</a> framework, which in turn is based on the <a href="https://lua.org/">Lua</a> programming language.</p>
<p>Lua is designed and implemented by a team at PUC-Rio, the Pontifical Catholic University of Rio de Janeiro in Brazil. Lua was born and raised at Tecgraf, the Computer Graphics Technology Group of PUC-Rio, and is now housed at Lua.org. Both Tecgraf and Lua.org are laboratories of the Department of Computer Science.</p>
</div></div></div></div>

<script src="../js/bootstrap.bundle.min.js"></script>
<script src="../js/base.js"></script>
<script>

   // Auto-open the relevant sidebar branch

   var url = window.location.pathname;
   var filename = url.substring(url.lastIndexOf('/')+1);
   var el = document.querySelector('li[class="api-ref"] > a[href="' + filename + '"]');
   if (el) {
      var parent = getParentNode(el, '[class="collapse"]');
      if (parent) new bootstrap.Collapse(parent, { show: true }); // Causes animation

      el.style.backgroundColor = '#d2f4ea';
   }

   cancelAnimations();
    </script>
  </body>
</html>
